<!DOCTYPE HTML>
<html lang="zh-CN">


<head>
    <meta charset="utf-8">
    <meta name="keywords" content="spring boot, daily">
    <meta name="description" content="日常">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <!-- Global site tag (gtag.js) - Google Analytics -->


    <title>spring boot | 水兽的Blog</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/all.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">

    <script src="/libs/jquery/jquery.min.js"></script>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
<meta name="generator" content="Hexo 5.4.0"></head>




<body>
    <canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" ></canvas> 
    <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script> 
    <script type="text/javascript" src="/js/fireworks.js"></script>
    <script type="text/javascript">
        //只在桌面版网页启用特效
        var windowWidth = $(window).width();
        if (windowWidth > 768) {
            document.write('<script type="text/javascript" src="/js/sakura.js"><\/script>');
        }
        </script>
        <script src="/js/cursor.js"></script>
    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">水兽的Blog</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a>
<ul class="right nav-menu">
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/" class="waves-effect waves-light">
      
      <i class="fas fa-home" style="zoom: 0.6;"></i>
      
      <span>首页</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/tags" class="waves-effect waves-light">
      
      <i class="fas fa-tags" style="zoom: 0.6;"></i>
      
      <span>标签</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/categories" class="waves-effect waves-light">
      
      <i class="fas fa-bookmark" style="zoom: 0.6;"></i>
      
      <span>分类</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/archives" class="waves-effect waves-light">
      
      <i class="fas fa-archive" style="zoom: 0.6;"></i>
      
      <span>归档</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/about" class="waves-effect waves-light">
      
      <i class="fas fa-user-circle" style="zoom: 0.6;"></i>
      
      <span>关于</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/contact" class="waves-effect waves-light">
      
      <i class="fas fa-comments" style="zoom: 0.6;"></i>
      
      <span>留言板</span>
    </a>
    
  </li>
  
  <li class="hide-on-med-and-down nav-item">
    
    <a href="/friends" class="waves-effect waves-light">
      
      <i class="fas fa-address-book" style="zoom: 0.6;"></i>
      
      <span>友情链接</span>
    </a>
    
  </li>
  
  <li>
    <a href="#searchModal" class="modal-trigger waves-effect waves-light">
      <i id="searchIcon" class="fas fa-search" title="搜索" style="zoom: 0.85;"></i>
    </a>
  </li>
</ul>


<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">水兽的Blog</div>
        <div class="logo-desc">
            
            日常
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li class="m-nav-item">
	  
		<a href="/" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-home"></i>
			
			首页
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/tags" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-tags"></i>
			
			标签
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/categories" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-bookmark"></i>
			
			分类
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/archives" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-archive"></i>
			
			归档
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/about" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-user-circle"></i>
			
			关于
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/contact" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-comments"></i>
			
			留言板
		</a>
          
        </li>
        
        <li class="m-nav-item">
	  
		<a href="/friends" class="waves-effect waves-light">
			
			    <i class="fa-fw fas fa-address-book"></i>
			
			友情链接
		</a>
          
        </li>
        
        
    </ul>
</div>


        </div>

        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/19.jpg')">
    <div class="container" style="right: 0px;left: 0px;">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <h1 class="description center-align post-title">spring boot</h1>
                </div>
            </div>
        </div>
    </div>
</div>




<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        width: 345px;
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        padding: 35px 0 15px 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        padding-bottom: 30px;
        overflow: auto;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;

        position: absolute;
        right: 23.5vw;
        display: block;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 15px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/note/">
                                <span class="chip bg-color">note</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-minus fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2022-05-03
                </div>
                

                
                <div class="post-date info-break-policy">
                    <i class="far fa-calendar-check fa-fw"></i>更新日期:&nbsp;&nbsp;
                    2022-08-09
                </div>
                

                
                <div class="info-break-policy">
                    <i class="far fa-file-word fa-fw"></i>文章字数:&nbsp;&nbsp;
                    24.6k
                </div>
                

                

                
                    <div id="busuanzi_container_page_pv" class="info-break-policy">
                        <i class="far fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv"></span>
                    </div>
				
            </div>
        </div>
        <hr class="clearfix">

        

        
        <!-- 代码块折行 -->
        <style type="text/css">
            code[class*="language-"], pre[class*="language-"] { white-space: pre-wrap !important; }
        </style>
        

        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="基础篇"><a href="#基础篇" class="headerlink" title="基础篇"></a>基础篇</h1><h2 id="快速上手-SpringBoot"><a href="#快速上手-SpringBoot" class="headerlink" title="快速上手 SpringBoot"></a>快速上手 SpringBoot</h2><h3 id="SpringBoot-入门程序开发"><a href="#SpringBoot-入门程序开发" class="headerlink" title="SpringBoot 入门程序开发"></a>SpringBoot 入门程序开发</h3><ul>
<li>SpringBoot 是由 Pivotal 团队提供的全新框架，其设计目的是用来简化 Spring 应用的初始搭建以及开发过程<ul>
<li>Spring 程序缺点<ul>
<li>依赖设置繁琐</li>
<li>配置繁琐</li>
</ul>
</li>
<li>SpringBoot 程序优点<ul>
<li>起步依赖（简化依赖配置）</li>
<li>自动配置（简化常用工程相关配置）</li>
<li>辅助功能（内置服务器，…）</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="快速上手-SpringBoot-1"><a href="#快速上手-SpringBoot-1" class="headerlink" title="快速上手 SpringBoot"></a>快速上手 SpringBoot</h4><ul>
<li><p>1.创建新模块，选择 Spring Initializr，并配置模块相关基础信息</p>
</li>
<li><p>2.选择当前模块需要使用的技术集（比如 web 里的 Spring Web）</p>
</li>
<li><p>3.开发控制器类（controller 类）</p>
<ul>
<li>```java<br>package com.itheima.controller;import org.springframework.web.bind.annotation.GetMapping;<br>import org.springframework.web.bind.annotation.RequestMapping;<br>import org.springframework.web.bind.annotation.RestController;// Rest 模式<br>@RestController<br>@RequestMapping(“/books”)<br>public class BookController {<pre><code>@GetMapping
public String getById() &#123;
    System.out.println(&quot;springboot is running&quot;);
    return &quot;springboot is running&quot;;
&#125;
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 4.运行自动生成的 Application 类</span><br><span class="line"></span><br><span class="line">#### 入门案例</span><br><span class="line"></span><br><span class="line">* 基于 SpringBoot 官网创建项目，地址：https:&#x2F;&#x2F;start.spring.io&#x2F;（官网版）</span><br><span class="line"></span><br><span class="line">* 基于阿里云创建项目，地址：https:&#x2F;&#x2F;start.aliyun.com</span><br><span class="line"></span><br><span class="line">  * **注意：**阿里云提供的版本较低，如果需要使用高版本，进入工程后手工切换 SpringBoot 版本，阿里云提供的工程模板与 Spring 官网提供的工程模板略有不同</span><br><span class="line"></span><br><span class="line">* 手工创建项目（手工导入坐标）</span><br><span class="line"></span><br><span class="line">  * 1.创建普通 Maven 工程</span><br><span class="line"></span><br><span class="line">  * 2.继承 spring-boot-starter-parent</span><br><span class="line"></span><br><span class="line">  * 3.添加依赖 spring-boot-start-web</span><br><span class="line"></span><br><span class="line">  * 4.制作引导类 Application</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;xml</span><br><span class="line">    &lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">    &lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot; xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">             xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 https:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">        &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">        &lt;parent&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;version&gt;2.7.1&lt;&#x2F;version&gt;</span><br><span class="line">            &lt;relativePath&#x2F;&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">        &lt;&#x2F;parent&gt;</span><br><span class="line">        &lt;groupId&gt;com.itheima&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;springboot_01_01_quickstart&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;0.0.1-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;dependencies&gt;</span><br><span class="line">            &lt;dependency&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;&#x2F;dependency&gt;</span><br><span class="line">        &lt;&#x2F;dependencies&gt;</span><br><span class="line">    &lt;&#x2F;project&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>最简 SpringBoot 程序所包含的基础文件</p>
<ul>
<li>pom.xml 文件</li>
<li>Application 类</li>
</ul>
</li>
<li><p>Spring 程序与 SpringBoot 程序对比</p>
</li>
</ul>
<p><img src="C:\Users\15135\AppData\Roaming\Typora\typora-user-images\image-20220719161719782.png" alt="image-20220719161719782"></p>
<p><strong>注意：</strong>基于idea 开发 SpringBoot 程序需要确保联网且能够加载到程序框架结构</p>
<h5 id="入门案例解析"><a href="#入门案例解析" class="headerlink" title="入门案例解析"></a>入门案例解析</h5><ul>
<li><p>parent（解决配置问题）</p>
<ul>
<li>1.开发 SpringBoot 程序要继承 spring-boot-starter-parent</li>
<li>2.spring-boot-starter-parent 中定义了若干个依赖管理</li>
<li>3.继承 parent 模块可以避免多个依赖使用相同技术时出现依赖版本冲突</li>
<li>4.继承 parent 的形式也可以采用引入依赖的形式实现效果</li>
<li>5.所有 SpringBoot 项目要继承的项目，定义了若干个坐标版本号（依赖管理、而非依赖），以达到减少依赖冲突的目的</li>
<li>6.spring-boot-starter-parent 各坂本间存在着诸多坐标版本不同</li>
</ul>
</li>
<li><p>starter（解决配置问题）</p>
<ul>
<li>spring-boot-starter-web</li>
<li>SpringBoot 中常见项目名称，定义了当前项目使用的所有依赖坐标，以达到减少配置的目的</li>
</ul>
</li>
<li><p>引导类</p>
<ul>
<li><p>启动方式</p>
<ul>
<li>```java<br>@SpringBootApplication<br>public class Springboot0101QuickstartApplication {<pre><code>public static void main(String[] args) &#123;
    SpringApplication.run(Springboot0101QuickstartApplication.class, args);
&#125;
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">    * SpringBoot 的引导类是 SpringBoot 工程的执行入口，运行 main 方法就可以启动项目</span><br><span class="line"></span><br><span class="line">    * SpringBoot 工程运行后初始化 Spring 容器，扫描引导类所在包加载 bean</span><br><span class="line"></span><br><span class="line">* 内嵌 tomcat</span><br><span class="line"></span><br><span class="line">  * 使用 maven 依赖管理变更起步依赖项</span><br><span class="line"></span><br><span class="line">    * &#96;&#96;&#96;xml</span><br><span class="line">      &lt;dependencies&gt;</span><br><span class="line">      	&lt;dependency&gt;</span><br><span class="line">      		&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">      		&lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">      		&lt;!-- web 起步依赖环境中，排除 Tomcat 起步依赖 --&gt;</span><br><span class="line">      		&lt;exclusions&gt;</span><br><span class="line">              	&lt;exclusion&gt;</span><br><span class="line">                  	&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">      				&lt;artifactId&gt;spring-boot-starter-tomcat&lt;&#x2F;artifactId&gt;</span><br><span class="line">                  &lt;&#x2F;exclusion&gt;</span><br><span class="line">              &lt;&#x2F;exclusions&gt;</span><br><span class="line">      	&lt;&#x2F;dependency&gt;</span><br><span class="line">          &lt;!-- 添加 Jetty 起步依赖，版本由 SpringBoot 的 starter 控制 --&gt;</span><br><span class="line">          &lt;dependency&gt;</span><br><span class="line">          	&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">      		&lt;artifactId&gt;spring-boot-starter-jetty&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;&#x2F;dependency&gt;</span><br><span class="line">      &lt;&#x2F;dependencies&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>Jetty 比 Tomcat 更轻量级，可拓展性更强（相较于 Tomcat），谷歌应用引擎（GAE）已经全面切换为 Jetty</p>
</li>
<li><p>内置服务器</p>
<ul>
<li><p>tomcat（默认）：apache 出品，粉丝多，应用面广，负载了若干较重的组件</p>
</li>
<li><p>jetty：更轻量级，负载性能远不及 tomcat</p>
</li>
<li><p>undertow：undertow，负载性能勉强跑赢 tomcat</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>实际开发</p>
<ul>
<li>使用任意坐标时，仅书写 GAV 中的 G 和 A，V 由 SpringBoot 提供，除非SpringBoot 未提供对应版本 V</li>
<li>如发生错误，再指定 Version（小心版本冲突）</li>
</ul>
</li>
</ul>
<h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h4><ul>
<li>1.开发 SpringBoot 程序可以根据向导进行联网快速制作</li>
<li>2.SpringBoot 程序需要基于 JDK8 进行制作</li>
<li>3.SpringBoot 程序中需要使用何种功能通过勾选选择技术</li>
<li>4.运行 SpringBoot 程序通过运行 Application 程序入口进行</li>
</ul>
<hr>
<ul>
<li>1.Idea 中隐藏指定文件或指定类型文件<ul>
<li>Setting -&gt; File Types -&gt; Ignored Files and Folders</li>
<li>输入要隐藏的文件名，支持 * 号通配符</li>
<li>回车确认添加</li>
</ul>
</li>
</ul>
<h2 id="REST-风格"><a href="#REST-风格" class="headerlink" title="REST 风格"></a>REST 风格</h2><h3 id="REST-简介"><a href="#REST-简介" class="headerlink" title="REST 简介"></a>REST 简介</h3><ul>
<li><strong>REST</strong>（Representational State Transfer），表现形式状态转换<ul>
<li>传统风格资源描述形式<ul>
<li><a target="_blank" rel="noopener" href="http://localhost/user/getById?id=1">http://localhost/user/getById?id=1</a></li>
<li><a target="_blank" rel="noopener" href="http://localhost/user/saveUser">http://localhost/user/saveUser</a></li>
</ul>
</li>
<li>REST 风格描述形式<ul>
<li><a target="_blank" rel="noopener" href="http://localhost/user/1">http://localhost/user/1</a></li>
<li><a target="_blank" rel="noopener" href="http://localhost/user">http://localhost/user</a></li>
</ul>
</li>
</ul>
</li>
<li>优点：<ul>
<li>隐藏资源的访问行为，无法通过地址得知对资源是何种操作</li>
<li>书写简化</li>
</ul>
</li>
<li>按照 REST 风格访问资源时使用行为动作区分对资源进行了何种操作<ul>
<li><a target="_blank" rel="noopener" href="http://localhost/users">http://localhost/users</a>        查询全部用户信息   GET（查询）</li>
<li><a target="_blank" rel="noopener" href="http://localhost/users/1">http://localhost/users/1</a>    查询指定用户信息   GET（查询）</li>
<li><a target="_blank" rel="noopener" href="http://localhost/users">http://localhost/users</a>        添加用户信息          POST（新增/保存）</li>
<li><a target="_blank" rel="noopener" href="http://localhost/users">http://localhost/users</a>        修改用户信息          PUT（修改/更新）</li>
<li><a target="_blank" rel="noopener" href="http://localhost/users/1">http://localhost/users/1</a>     删除用户信息         DELETE（删除）</li>
<li><strong>注意事项：</strong>上述行为是约定方式，约定不是规范，可以打破，所以称 REST 风格，而不是 REST 规范。描述模块的名称通常使用复数，也就是加 s 的格式描述，表示此类资源，而非单个资源，例如：users、books、accounts……</li>
</ul>
</li>
<li>根据 REST 风格对资源进行访问称为 RESTful</li>
</ul>
<h3 id="RESTful-入门案例"><a href="#RESTful-入门案例" class="headerlink" title="RESTful 入门案例"></a>RESTful 入门案例</h3><h4 id="RequestMapping"><a href="#RequestMapping" class="headerlink" title="@RequestMapping"></a>@RequestMapping</h4><ul>
<li>名称：@RequestMapping</li>
<li>类型：方法注解</li>
<li>位置：SpringMVC 控制器方法定义上方</li>
<li>作用：设置当前控制器方法请求访问路径</li>
<li>属性<ul>
<li>value（默认）：请求访问路径</li>
<li>method：http 请求动作，标准动作（GET/POST/PUT/DELETE）</li>
</ul>
</li>
</ul>
<h4 id="PathVariable"><a href="#PathVariable" class="headerlink" title="@PathVariable"></a>@PathVariable</h4><ul>
<li>名称：@PathVariable</li>
<li>类型：形参注解</li>
<li>位置：SpringMVC 控制器方法形参定义前面</li>
<li>作用：绑定路径参数与处理器方法形参之间的关系，要求路径参数名与形参名一一对应</li>
</ul>
<h4 id="RequestBody、-RequestParam、-PathVariable"><a href="#RequestBody、-RequestParam、-PathVariable" class="headerlink" title="@RequestBody、@RequestParam、@PathVariable"></a>@RequestBody、@RequestParam、@PathVariable</h4><ul>
<li><p>区别</p>
<ul>
<li>@RequestParam 用于接收 url 地址传参或表单传参</li>
<li>@RequestBody 用于接收 json 数据</li>
<li>@PathVariable 用于接收路径参数，使用{参数名称}描述路径参数</li>
</ul>
</li>
<li><p>应用</p>
<ul>
<li>后期开发中，发送请求参数超过 1 个时，以 json 格式为主，@RequestBody 应用较广</li>
<li>如果发送非 json 数据格式，选用@RequestParam 接收请求参数</li>
<li>采用 RESTful 进行开发，当参数较少时，例如 1 个，可以采用 @PathVariable 接收请求路径变量，通常用于传 id 值</li>
</ul>
</li>
</ul>
<h4 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h4><ul>
<li>1.设定 http 请求动作（动词）</li>
<li>2.设定请求参数（路径变量）</li>
</ul>
<h4 id="Controller-类示例代码"><a href="#Controller-类示例代码" class="headerlink" title="Controller 类示例代码"></a>Controller 类示例代码</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 保存</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/users&quot;, method = RequestMethod.POST)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user save...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;module&#x27;: &#x27;user save&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 删除</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/users/&#123;id&#125;&quot;, method = RequestMethod.DELETE)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user delete...&quot;</span> + id);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;module&#x27;: &#x27;user delete&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 条件查询</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/users/&#123;id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user getById...&quot;</span> + id);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;module&#x27;: &#x27;user getById&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="RESTful-快速开发"><a href="#RESTful-快速开发" class="headerlink" title="RESTful 快速开发"></a>RESTful 快速开发</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RESTController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 保存</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">save</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user save...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;module&#x27;: &#x27;user save&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 删除</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user delete...&quot;</span> + id);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;module&#x27;: &#x27;user delete&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 条件查询</span></span><br><span class="line"> 	<span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getById</span><span class="params">(<span class="meta">@PathVariable</span> Integer id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;user getById...&quot;</span> + id);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;&#x27;module&#x27;: &#x27;user getById&#x27;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="RestController"><a href="#RestController" class="headerlink" title="@RestController"></a>@RestController</h4><ul>
<li>名称：@RestController</li>
<li>类型：类注解</li>
<li>位置：基于 SpringMVC 的 RESTful 开发控制器类定义上方</li>
<li>作用：设置当前控制器类为 RESTful 风格，等同于 @Controller 与 @ResponseBody 两个注解组合功能</li>
</ul>
<h4 id="GetMapping、-PostMapping、-PutMapping、-DeleteMapping"><a href="#GetMapping、-PostMapping、-PutMapping、-DeleteMapping" class="headerlink" title="@GetMapping、@PostMapping、@PutMapping、@DeleteMapping"></a>@GetMapping、@PostMapping、@PutMapping、@DeleteMapping</h4><ul>
<li>名称：@GetMapping、@PostMapping、@PutMapping、@DeleteMapping</li>
<li>类型：方法注解</li>
<li>位置：基于 SpringMVC 的 RESTful 开发控制器方法定义上方</li>
<li>作用：设置当前控制器方法请求访问路径与请求动作，每种对应一个请求动作，例如 @GetMapping 对应 GET 请求</li>
<li>属性：value（默认）：请求访问路径</li>
</ul>
<h2 id="基础配置"><a href="#基础配置" class="headerlink" title="基础配置"></a>基础配置</h2><h3 id="复制工程"><a href="#复制工程" class="headerlink" title="复制工程"></a>复制工程</h3><ul>
<li>原则<ul>
<li>保留工程基础结构</li>
<li>抹掉原始工程痕迹</li>
</ul>
</li>
<li>小结<ul>
<li>1.在工作空间中复制对应工程，并修改工程名称</li>
<li>2.删除与 idea 相关配置文件，仅保留 src 目录与 pom.xml 文件</li>
<li>3.修改 pom.xml 文件中的 artifactId 与新工程/模块名相同</li>
<li>4.删除 name 标签（可选）</li>
<li>5.保留工程供后期使用</li>
</ul>
</li>
</ul>
<h3 id="属性配置"><a href="#属性配置" class="headerlink" title="属性配置"></a>属性配置</h3><ul>
<li><p>SpringBoot 默认配置文件 application.properties，通过键值对配置对应属性</p>
</li>
<li><p>修改配置</p>
<ul>
<li><p>修改服务器端口</p>
<ul>
<li>```properties<br>server.port=80<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 多种配置</span><br><span class="line"></span><br><span class="line">##### 修改 banner</span><br><span class="line"></span><br><span class="line">* spring.main.banner-mode&#x3D;off（关闭 banner）</span><br><span class="line">* spring.banner.image.location&#x3D;图片地址（更换 banner）</span><br><span class="line"></span><br><span class="line">##### 日志</span><br><span class="line"></span><br><span class="line">* logging.level.root&#x3D;debug（debug 级别的日志）</span><br><span class="line"></span><br><span class="line">更多查看官网：application-properties</span><br><span class="line"></span><br><span class="line">#### 配置方式</span><br><span class="line"></span><br><span class="line">* SpringBoot 提供了多种属性配置方式</span><br><span class="line"></span><br><span class="line">  * application.properties（传统格式&#x2F;默认格式）</span><br><span class="line"></span><br><span class="line">    * &#96;&#96;&#96;properties</span><br><span class="line">      server.port&#x3D;80</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>application.yml（主流格式）</p>
<ul>
<li>```yml<br>server:<br>  port: 81<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* application.yaml</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;yaml</span><br><span class="line">    server:</span><br><span class="line">      port:82</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="SpringBoot-配置文件加载顺序"><a href="#SpringBoot-配置文件加载顺序" class="headerlink" title="SpringBoot 配置文件加载顺序"></a>SpringBoot 配置文件加载顺序</h4><ul>
<li><p>application.properties &gt; application.yml（常用） &gt; application.yaml</p>
</li>
<li><p>不同配置文件中相同配置按加载优先级相互覆盖，不同配置文件中不同配置全部保留</p>
</li>
</ul>
<h4 id="指定-SpringBoot-配置文件"><a href="#指定-SpringBoot-配置文件" class="headerlink" title="指定 SpringBoot 配置文件"></a>指定 SpringBoot 配置文件</h4><ul>
<li>1.setting -&gt; Project Structure -&gt; facets</li>
<li>2.选中对应项目</li>
<li>3.Customize Spring Boot</li>
<li>4.选择配置文件</li>
</ul>
<h3 id="配置文件分类"><a href="#配置文件分类" class="headerlink" title="配置文件分类"></a>配置文件分类</h3><p>properties、yml、yaml</p>
<h3 id="yaml-文件"><a href="#yaml-文件" class="headerlink" title="yaml 文件"></a>yaml 文件</h3><ul>
<li>YAML（YAML Ain’t Markup Language），一种数据序列化格式</li>
<li>优点：<ul>
<li>容易阅读</li>
<li>容易与脚本语言交互</li>
<li>以数据为核心，重数据轻格式</li>
</ul>
</li>
<li>YAML 文件拓展名<ul>
<li>.yml（主流）</li>
<li>.yaml</li>
</ul>
</li>
</ul>
<h4 id="yaml-语法规则"><a href="#yaml-语法规则" class="headerlink" title="yaml 语法规则"></a>yaml 语法规则</h4><ul>
<li><p>大小写敏感</p>
</li>
<li><p>属性层级关系使用多行描述，每行结尾都使用冒号结束</p>
</li>
<li><p>使用缩进表示层级关系，同层级左侧对齐，只允许使用空格（不允许使用 Tab 键）</p>
</li>
<li><p>属性值前面添加空格（属性名与属性值之间使用冒号 ＋ 空格作为分隔）</p>
</li>
<li><p># 表示注释</p>
</li>
<li><p>有数组以及对象</p>
</li>
<li><p><strong>核心规则：</strong>数据前面要加空格与冒号隔开</p>
</li>
<li><p>字面值表示方式</p>
<ul>
<li>```yaml<br>boolean: TRUE                         # TRUE,true,True,FALSE,false,False 均可<br>float: 3.14                           # 6.8523015e+5 支持科学计数法<br>int: 123                              # 0b1010_0111_0100_1010_1110 支持二进制、八进制、十六进制<br>null: ~                               # 使用 ~ 表示 null<br>String: HelloWorld                    # 字符串可以直接书写<br>String2: “Hello World”                # 可以使用双冒号包裹特殊字符<br>date: 2018-02-17                      # 日期必须使用 yyyy-MM-dd 格式<br>datetime: 2018-02-17T15:02:31+08:00   # 日期和事件之间使用 T 连接，最后用 + 代表时区<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 数组表示方式：在属性名书写位置的下方使用减号作为数据开始符号，每行书写一个数据，减号与数据间空格分隔</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;yaml</span><br><span class="line">    subject: </span><br><span class="line">      - Java</span><br><span class="line">      - 前端</span><br><span class="line">      - 大数据</span><br><span class="line">    enterprise: </span><br><span class="line">      name: itcast</span><br><span class="line">      age: 16</span><br><span class="line">      subject:</span><br><span class="line">        - Java</span><br><span class="line">        - 前端</span><br><span class="line">        - 大数据</span><br><span class="line">    likes: [game,music] #数组书写略缩格式</span><br><span class="line">    </span><br><span class="line">    users:              # 对象数组格式</span><br><span class="line">      - name: Tom</span><br><span class="line">        age: 4</span><br><span class="line">      - name: Jerry</span><br><span class="line">        age: 5</span><br><span class="line">        </span><br><span class="line">    users:              # 对象数组格式二</span><br><span class="line">      -</span><br><span class="line">        name: Tom</span><br><span class="line">        age: 4</span><br><span class="line">      - </span><br><span class="line">        name: Jerry</span><br><span class="line">        age: 5</span><br><span class="line">    users2: [ &#123; name:Tom, age:4 &#125;, &#123; name:Jerry, age:5 &#125; ]</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="yaml-数据读取"><a href="#yaml-数据读取" class="headerlink" title="yaml 数据读取"></a>yaml 数据读取</h3><ul>
<li><p>使用 @Value 读取单个数据，属性名引用方式：${一级属性名.二级属性名……}</p>
<ul>
<li>```java<br>// 读取 yaml 数据中的单一数据<br>@Value(“${country}”)<br>private String country1;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 在配置文件中可以使用属性名引用方式引用属性</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;yaml</span><br><span class="line">    baseDir: &#x2F;user&#x2F;local&#x2F;fire</span><br><span class="line">    </span><br><span class="line">    center:</span><br><span class="line">      dataDir: $&#123;baseDir&#125;&#x2F;data</span><br><span class="line">      tempDir: $&#123;baseDir&#125;&#x2F;tmp</span><br><span class="line">      logDir: $&#123;baseDir&#125;&#x2F;log</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>属性值中如果出现转义字符，需要使用双引号包裹</p>
<ul>
<li><p>```yaml<br>lesson: “Spring\tboot\nlesson”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 封装全部数据到 Environment 对象</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    package com.itheima.controller;</span><br><span class="line">    </span><br><span class="line">    import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">    import org.springframework.beans.factory.annotation.Value;</span><br><span class="line">    import org.springframework.core.env.Environment;</span><br><span class="line">    import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">    import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">    import org.springframework.web.bind.annotation.RestController;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; Rest 模式</span><br><span class="line">    @RestController</span><br><span class="line">    @RequestMapping(&quot;&#x2F;books&quot;)</span><br><span class="line">    public class BookController &#123;</span><br><span class="line">    </span><br><span class="line">        &#x2F;&#x2F; 读取 yaml 数据中的单一数据</span><br><span class="line">        @Value(&quot;$&#123;country&#125;&quot;)</span><br><span class="line">        private String country1;</span><br><span class="line">    </span><br><span class="line">        @Value(&quot;$&#123;user.name&#125;&quot;)</span><br><span class="line">        private String name;</span><br><span class="line">    </span><br><span class="line">        @Value(&quot;$&#123;tempDir&#125;&quot;)</span><br><span class="line">        private String tempDir;</span><br><span class="line">        &#x2F;&#x2F; 使用自动装配将所有的数据封装到一个 Environment 对象中</span><br><span class="line">        @Autowired</span><br><span class="line">        private Environment env;</span><br><span class="line">    </span><br><span class="line">        @GetMapping</span><br><span class="line">        public String getById() &#123;</span><br><span class="line">            System.out.println(&quot;springboot is running&quot;);</span><br><span class="line">            System.out.println(&quot;country1 &#x3D;&#x3D;&#x3D;&#x3D;&gt;&quot; + country1);</span><br><span class="line">            System.out.println(&quot;name1 &#x3D;&#x3D;&#x3D;&#x3D;&gt;&quot; + name);</span><br><span class="line">            System.out.println(tempDir);</span><br><span class="line">            System.out.println(&quot;---------------&quot;);</span><br><span class="line">            System.out.println(env.getProperty(&quot;user.name&quot;));</span><br><span class="line">            return &quot;springboot is running&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>```yaml</p>
<h1 id="application-yml"><a href="#application-yml" class="headerlink" title="application.yml"></a>application.yml</h1><p>country: china<br>province: beijing<br>user:<br>  name: zhangsan<br>  age: 20<br>baseDir: /user/local/fire</p>
<p>center:<br>  dataDir: ${baseDir}/data<br>  tempDir: ${baseDir}/tmp<br>  logDir: ${baseDir}/log</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 自定义对象封装指定数据</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    &#x2F;&#x2F; MyDataSource.java</span><br><span class="line">    package com.itheima;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    import org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line">    import org.springframework.stereotype.Component;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F; 1.定义数据模型封装 yaml 文件中对应的数据</span><br><span class="line">    &#x2F;&#x2F; 2.定义为 Spring 管控的 bean</span><br><span class="line">    @Component</span><br><span class="line">    &#x2F;&#x2F; 3.指定加载的数据</span><br><span class="line">    @ConfigurationProperties(prefix &#x3D; &quot;datasource&quot;)</span><br><span class="line">    public class MyDataSource &#123;</span><br><span class="line">        private String driver;</span><br><span class="line">        private String url;</span><br><span class="line">        private String username;</span><br><span class="line">        private String password;</span><br><span class="line">    </span><br><span class="line">        public MyDataSource() &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        public MyDataSource(String driver, String url, String username, String password) &#123;</span><br><span class="line">            this.driver &#x3D; driver;</span><br><span class="line">            this.url &#x3D; url;</span><br><span class="line">            this.username &#x3D; username;</span><br><span class="line">            this.password &#x3D; password;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        @Override</span><br><span class="line">        public String toString() &#123;</span><br><span class="line">            return &quot;MyDataSource&#123;&quot; +</span><br><span class="line">                    &quot;driver&#x3D;&#39;&quot; + driver + &#39;\&#39;&#39; +</span><br><span class="line">                    &quot;, url&#x3D;&#39;&quot; + url + &#39;\&#39;&#39; +</span><br><span class="line">                    &quot;, username&#x3D;&#39;&quot; + username + &#39;\&#39;&#39; +</span><br><span class="line">                    &quot;, password&#x3D;&#39;&quot; + password + &#39;\&#39;&#39; +</span><br><span class="line">                    &#39;&#125;&#39;;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        public String getDriver() &#123;</span><br><span class="line">            return driver;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        public void setDriver(String driver) &#123;</span><br><span class="line">            this.driver &#x3D; driver;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        public String getUrl() &#123;</span><br><span class="line">            return url;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        public void setUrl(String url) &#123;</span><br><span class="line">            this.url &#x3D; url;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        public String getUsername() &#123;</span><br><span class="line">            return username;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        public void setUsername(String username) &#123;</span><br><span class="line">            this.username &#x3D; username;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        public String getPassword() &#123;</span><br><span class="line">            return password;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        public void setPassword(String password) &#123;</span><br><span class="line">            this.password &#x3D; password;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>```yaml</p>
<h1 id="application-yml-1"><a href="#application-yml-1" class="headerlink" title="application.yml"></a>application.yml</h1><h1 id="创建类，用于封装下面的数据"><a href="#创建类，用于封装下面的数据" class="headerlink" title="创建类，用于封装下面的数据"></a>创建类，用于封装下面的数据</h1><h1 id="由-spring-帮我们去加载数据到对象中，一定要告诉-spring-加载这组信息"><a href="#由-spring-帮我们去加载数据到对象中，一定要告诉-spring-加载这组信息" class="headerlink" title="由 spring 帮我们去加载数据到对象中，一定要告诉 spring 加载这组信息"></a>由 spring 帮我们去加载数据到对象中，一定要告诉 spring 加载这组信息</h1><h1 id="使用的时候，从-spring-中直接获取信息使用"><a href="#使用的时候，从-spring-中直接获取信息使用" class="headerlink" title="使用的时候，从 spring 中直接获取信息使用"></a>使用的时候，从 spring 中直接获取信息使用</h1><p>datasource:<br>  driver: com.mysql.jdbs.Driver<br>  url: jdbc:mysql://localhost/springboot_db<br>  username: root<br>  password: root666</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* &#96;&#96;&#96;java</span><br><span class="line">  &#x2F;&#x2F; controller 类</span><br><span class="line">  package com.itheima.controller;</span><br><span class="line">  </span><br><span class="line">  import com.itheima.MyDataSource;</span><br><span class="line">  import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">  import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">  import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">  import org.springframework.web.bind.annotation.RestController;</span><br><span class="line">  </span><br><span class="line">  &#x2F;&#x2F; Rest 模式</span><br><span class="line">  @RestController</span><br><span class="line">  @RequestMapping(&quot;&#x2F;books&quot;)</span><br><span class="line">  public class BookController &#123;</span><br><span class="line">  </span><br><span class="line">      @Autowired</span><br><span class="line">      private MyDataSource myDataSource;</span><br><span class="line">  </span><br><span class="line">      @GetMapping</span><br><span class="line">      public String getById() &#123;</span><br><span class="line">          System.out.println(&quot;springboot is running&quot;);</span><br><span class="line">          System.out.println(myDataSource);</span><br><span class="line">          return &quot;springboot is running&quot;;</span><br><span class="line">      &#125;</span><br><span class="line">  </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h2 id="整合第三方技术"><a href="#整合第三方技术" class="headerlink" title="整合第三方技术"></a>整合第三方技术</h2><h3 id="整合-JUnit"><a href="#整合-JUnit" class="headerlink" title="整合 JUnit"></a>整合 JUnit</h3><h4 id="SpringBoot-整合-JUnit"><a href="#SpringBoot-整合-JUnit" class="headerlink" title="SpringBoot 整合 JUnit"></a>SpringBoot 整合 JUnit</h4><ul>
<li><p>SpringBootTest 整合 JUnit</p>
<ul>
<li>```java<br>package com.itheima;import com.itheima.dao.BookDao;<br>import org.junit.jupiter.api.Test;<br>import org.springframework.beans.factory.annotation.Autowired;<br>import org.springframework.boot.test.context.SpringBootTest;@SpringBootTest<br>class Springboot04JunitApplicationTests {//    1.注入你要测试的对象<pre><code>@Autowired
private BookDao bookDao;

@Test
void contextLoads() &#123;
    //    2.执行要测试的对象对应的方法
    bookDao.save();
&#125;
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 名称：@SpringBootTest</span><br><span class="line"></span><br><span class="line">* 类型：**测试类注解**</span><br><span class="line"></span><br><span class="line">* 位置：测试类定义上方</span><br><span class="line"></span><br><span class="line">* 作用：设置 JUnit 加载的 SpringBoot 启动类</span><br><span class="line"></span><br><span class="line">* 范例：</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    @SpringBootTest</span><br><span class="line">    class Springboot04JunitApplicationTests &#123;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>相关属性：</p>
<ul>
<li>classes：设置 SpringBoot 启动类</li>
</ul>
</li>
<li><p><strong>注意事项：</strong>如果测试类在 SpringBoot 启动类的包或子包中，可以省略启动类的设置，也就是省略 classes 的设定</p>
</li>
<li><p>详细步骤：</p>
<ul>
<li>1.导入测试对应的 starter</li>
<li>2.测试类使用 @SpringBootTest</li>
<li>3.使用自动装配的形式添加要测试的对象</li>
</ul>
</li>
</ul>
<h3 id="整合-MyBatis"><a href="#整合-MyBatis" class="headerlink" title="整合 MyBatis"></a>整合 MyBatis</h3><ul>
<li>核心配置：数据库连接相关信息（练什么？连谁？什么权限？）</li>
<li>映射配置：SQL 映射（XML / 注解）</li>
</ul>
<h4 id="步骤："><a href="#步骤：" class="headerlink" title="步骤："></a>步骤：</h4><ul>
<li><p>1.创建新模块，选择 Spring 初始化，并配置模块相关基础信息</p>
</li>
<li><p>2.选择当前模块需要使用的技术集（MyBatis、MySQL）</p>
</li>
<li><p>3.设置数据源参数</p>
<ul>
<li>```yaml<h1 id="应用名称"><a href="#应用名称" class="headerlink" title="应用名称"></a>应用名称</h1>spring:<br>  datasource:<pre><code>driver-class-name: com.mysql.cj.jdbc.Driver
url: jdbc:mysql://localhost:3306/dorm_management?serverTimezone=GMT
username: root
password: root
</code></pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 4.定义数据层接口与映射配置</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    package com.itheima.dao;</span><br><span class="line">    </span><br><span class="line">    import com.itheima.domain.Book;</span><br><span class="line">    import org.apache.ibatis.annotations.Mapper;</span><br><span class="line">    import org.apache.ibatis.annotations.Select;</span><br><span class="line">    </span><br><span class="line">    @Mapper</span><br><span class="line">    public interface BookDao &#123;</span><br><span class="line">        @Select(&quot;select * from admin where aid &#x3D; #&#123;id&#125;&quot;)</span><br><span class="line">        public Book getById(Integer id);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>5.测试类中注入 dao 接口，测试功能</p>
<ul>
<li><p>```java<br>package com.itheima;</p>
<p>import com.itheima.dao.BookDao;<br>import org.junit.jupiter.api.Test;<br>import org.springframework.beans.factory.annotation.Autowired;<br>import org.springframework.boot.test.context.SpringBootTest;</p>
<p>@SpringBootTest<br>class Springboot05MybatisApplicationTests {</p>
<pre><code>@Autowired
private BookDao bookDao;

@Test
void contextLoads() &#123;
    System.out.println(bookDao.getById(1));
&#125;
</code></pre>
<p>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 常见问题以及处理方式</span><br><span class="line"></span><br><span class="line">时区问题：在url后面加上 **?serverTimezone&#x3D;GMT**</span><br><span class="line"></span><br><span class="line">### 整合 MyBatis-Plus</span><br><span class="line"></span><br><span class="line">* MyBatis-Plus 与 MyBatis 区别</span><br><span class="line">  * 导入坐标不同</span><br><span class="line">  * 数据层实现简化</span><br><span class="line"></span><br><span class="line">#### 步骤：</span><br><span class="line"></span><br><span class="line">* 1.手动添加 SpringBoot 整合 MyBatis-Plus 的坐标，可以通过 mvnrepository 获取</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;xml</span><br><span class="line">    &lt;!-- https:&#x2F;&#x2F;mvnrepository.com&#x2F;artifact&#x2F;com.baomidou&#x2F;mybatis-plus-boot-starter --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;com.baomidou&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;mybatis-plus-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;3.4.3&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>注意事项：</strong>由于 SpringBoot 中未收录 MyBatis-Plus 的坐标版本，需要指定对应的 version</p>
</li>
</ul>
</li>
</ul>
<h3 id="整合-Druid"><a href="#整合-Druid" class="headerlink" title="整合 Druid"></a>整合 Druid</h3><h4 id="步骤：-1"><a href="#步骤：-1" class="headerlink" title="步骤："></a>步骤：</h4><ul>
<li><p>1.导入 Druid 对应的 starter</p>
<ul>
<li>```xml<!-- https://mvnrepository.com/artifact/com.alibaba/druid-spring-boot-starter -->
<dependency>
    <groupId>com.alibaba</groupId>
    <artifactId>druid-spring-boot-starter</artifactId>
    <version>1.2.6</version>
</dependency>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 2.变更 Druid 的配置方式</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;yaml</span><br><span class="line">    spring:</span><br><span class="line">      datasource:</span><br><span class="line">        druid:</span><br><span class="line">            driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">            url: jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;dorm_management?serverTimezone&#x3D;GMT</span><br><span class="line">            username: root</span><br><span class="line">            password: zt20020806</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="整合任意第三方技术"><a href="#整合任意第三方技术" class="headerlink" title="整合任意第三方技术"></a>整合任意第三方技术</h3><ul>
<li>导入对应的 starter</li>
<li>配置对应的设置或采用默认配置</li>
</ul>
<h3 id="基于-SpringBoot-的-SSMP-整合案例"><a href="#基于-SpringBoot-的-SSMP-整合案例" class="headerlink" title="基于 SpringBoot 的 SSMP 整合案例"></a>基于 SpringBoot 的 SSMP 整合案例</h3><ul>
<li>案例实现方案分析<ul>
<li>实体类开发——使用 LomBok 快速制作实体类</li>
<li>Dao 开发——整合 MyBatisPlus，制作数据层测试类</li>
<li>Service 开发——基于 MyBatisPlus 进行增量开发，制作业务层测试类</li>
<li>Controller 开发——基于 Restful 开发，使用 PostMan 测试接口功能</li>
<li>Controller 开发——前后端开发协议制作</li>
<li>页面开发——基于 Vue + ElementUI 制作，前后端联调，页面数据处理，页面消息处理<ul>
<li>列表、新增、修改、删除、分页、查询</li>
</ul>
</li>
<li>项目异常处理</li>
<li>按条件查询——页面功能调整、Controller 修正功能、Service 修正功能</li>
</ul>
</li>
</ul>
<h4 id="1-创建模块"><a href="#1-创建模块" class="headerlink" title="1.创建模块"></a>1.创建模块</h4><ul>
<li>1.勾选 SpringMVC 和 MySQL 坐标</li>
<li>2.修改配置文件为 yml 格式</li>
<li>3.设置端口为 80 方便访问</li>
</ul>
<h4 id="2-实体类开发"><a href="#2-实体类开发" class="headerlink" title="2.实体类开发"></a>2.实体类开发</h4><h5 id="Lombok"><a href="#Lombok" class="headerlink" title="Lombok"></a>Lombok</h5><ul>
<li><p>Lombok，一个 Java 类库，提供了一组注解，简化 POJO 实体类开发</p>
</li>
<li><p>常用注解：@Data</p>
<ul>
<li>```java<br>@Data<br>public class Book {<pre><code>private Integer id;
private String type;
private String name;
private String descript;
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 为当前实体类在编译期间设置对应的 getter&#x2F;setter 方法，toString 方法，hashCode 方法，equals 方法等</span><br><span class="line"></span><br><span class="line">#### 3.数据层开发</span><br><span class="line"></span><br><span class="line">* 技术实现方案</span><br><span class="line"></span><br><span class="line">  * MyBatisPlus</span><br><span class="line">  * Druid</span><br><span class="line"></span><br><span class="line">* 导入 MyBatisPlus 与 Druid 对应的 starter</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;xml</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;com.baomidou&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;mybatis-plus-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;3.4.3&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;com.alibaba&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;druid-spring-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.2.6&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>配置数据源与 MyBatisPlus 对应的基础配置（id 生成策略使用数据库自增策略）</p>
<ul>
<li>```yaml<br>server:<br>  port: 80<br>spring:<br>  datasource:<pre><code>driver-class-name: com.mysql.cj.jdbc.Driver
url: jdbc:mysql://localhost:3306/ssm_db?serverTimezone=UTC
username: root
password: zt20020806
</code></pre>
mybatis-plus:<br>  global-config:<pre><code>db-config:
  table-prefix: tb_
  id-type: auto
</code></pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 继承 BaseMapper 并指定泛型</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    package com.itheima.dao;</span><br><span class="line">    </span><br><span class="line">    import com.baomidou.mybatisplus.core.mapper.BaseMapper;</span><br><span class="line">    import com.itheima.domain.Book;</span><br><span class="line">    import org.apache.ibatis.annotations.Mapper;</span><br><span class="line">    </span><br><span class="line">    @Mapper</span><br><span class="line">    public interface BookDao extends BaseMapper&lt;Book&gt; &#123;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>制作测试类测试结果</p>
<ul>
<li>```java<br>package com.itheima.dao;import com.itheima.domain.Book;<br>import org.junit.jupiter.api.Test;<br>import org.springframework.beans.factory.annotation.Autowired;<br>import org.springframework.boot.test.context.SpringBootTest;@SpringBootTest<br>public class BookDaoTestCase {<pre><code>@Autowired
private BookDao bookDao;

@Test
void TestGetById() &#123;
    System.out.println(bookDao.selectById(1));
&#125;

@Test
void TestSave() &#123;
    Book book = new Book();
    book.setType(&quot;测试数据123&quot;);
    book.setName(&quot;测试数据123&quot;);
    book.setDescription(&quot;测试数据123&quot;);
    bookDao.insert(book);
&#125;
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 为方便调试可以开启 MyBatisPlus 的日志</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;yaml</span><br><span class="line">    mybatis-plus:</span><br><span class="line">      configuration:</span><br><span class="line">        log-impl: org.apache.ibatis.logging.stdout.StdOutImpl</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h5 id="数据层开发——分页功能"><a href="#数据层开发——分页功能" class="headerlink" title="数据层开发——分页功能"></a>数据层开发——分页功能</h5><ul>
<li><p>分页操作需要设定分页对象 IPage</p>
<ul>
<li>```java<br>@Test<br>void testGetPage() {<pre><code>IPage page = new Page(1,1);
bookDao.selectPage(page, null);
List records = page.getRecords();
System.out.println(records);
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* IPage 对象中封装了分页操作中的所有数据</span><br><span class="line"></span><br><span class="line">  * 数据</span><br><span class="line">  * 当前页码值</span><br><span class="line">  * 每页数据总量</span><br><span class="line">  * 最大页码值</span><br><span class="line">  * 数据总量</span><br><span class="line"></span><br><span class="line">* 分页操作是在 MyBatisPlus 的常规操作基础上增强得到，内部是动态的拼写 SQL 语句，因此需要增强对应的功能，使用 MyBatisPlus 拦截器实现</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    &#x2F;&#x2F; 配置类</span><br><span class="line">    @Configuration</span><br><span class="line">    public class MPConfig &#123;</span><br><span class="line">        @Bean</span><br><span class="line">        public MybatisPlusInterceptor mybatisPlusInterceptor() &#123;</span><br><span class="line">    &#x2F;&#x2F;        1.定义 Mp 拦截器</span><br><span class="line">            MybatisPlusInterceptor interceptor &#x3D; new MybatisPlusInterceptor();</span><br><span class="line">    &#x2F;&#x2F;        添加具体的拦截器</span><br><span class="line">            interceptor.addInnerInterceptor(new PaginationInnerInterceptor());</span><br><span class="line">            return interceptor;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h5 id="数据层开发——条件查询功能"><a href="#数据层开发——条件查询功能" class="headerlink" title="数据层开发——条件查询功能"></a>数据层开发——条件查询功能</h5><ul>
<li><p>使用 QueryWrapper 对象封装查询条件，推荐使用 LambdaQueryWrapper 对象，所有查询操作封装成方法调用</p>
<ul>
<li>```java<br>// QueryWrapper<br>@Test<br>void testGetBy() {<pre><code>QueryWrapper&lt;Book&gt; qw = new QueryWrapper&lt;&gt;();
qw.like(&quot;name&quot;,&quot;测试&quot;);
bookDao.selectList(qw);
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* &#96;&#96;&#96;java</span><br><span class="line">  &#x2F;&#x2F; LambdaQueryWrapper</span><br><span class="line">  @Test</span><br><span class="line">  void testGetBy2() &#123;</span><br><span class="line">      String name &#x3D; null;</span><br><span class="line">      LambdaQueryWrapper&lt;Book&gt; lqw &#x3D; new LambdaQueryWrapper&lt;&gt;();</span><br><span class="line">      lqw.like(name !&#x3D; null, Book::getName,name);</span><br><span class="line">      bookDao.selectList(lqw);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>查询条件支持动态条件拼装</p>
</li>
</ul>
<h4 id="4-业务层开发"><a href="#4-业务层开发" class="headerlink" title="4.业务层开发"></a>4.业务层开发</h4><ul>
<li><p>Service 层接口定义与数据层接口定义具有较大区别，不要混用</p>
<ul>
<li>selectByUserNameAndPassword(String username,String password);（数据层）</li>
<li>login(String username, String password);（业务层）</li>
</ul>
</li>
<li><p>实现类定义</p>
<ul>
<li><p>```java<br>@Service<br>public class BookServiceImpl implements BookService {</p>
<pre><code>@Autowired
private BookDao bookDao;

@Override
public boolean save(Book book) &#123;
    return bookDao.insert(book) &gt; 0;
&#125;

@Override
public boolean update(Book book) &#123;
    return bookDao.updateById(book) &gt; 0;
&#125;

@Override
public boolean delete(Integer id) &#123;
    return bookDao.deleteById(id) &gt; 0;
&#125;

@Override
public Book getById(Integer id) &#123;
    return bookDao.selectById(id);
&#125;

@Override
public List&lt;Book&gt; getAll() &#123;
    return bookDao.selectList(null);
&#125;

@Override
public IPage&lt;Book&gt; getPage(int currentPage, int pageSize) &#123;
    IPage page = new Page(currentPage, pageSize);
    return bookDao.selectPage(page, null);
&#125;
</code></pre>
<p>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### 业务层开发——快速开发</span><br><span class="line"></span><br><span class="line">* 快速开发方案</span><br><span class="line"></span><br><span class="line">  * 使用 MyBatisPlus 提供有业务层通用接口（IService&lt;T&gt;）与业务层通用实现类 (ServiceImpl&lt;M, T&gt;)</span><br><span class="line">  * 在通用类基础上做功能重载或功能追加</span><br><span class="line">  * 注意重载时不要覆盖原始操作，避免原始提供的功能丢失</span><br><span class="line"></span><br><span class="line">* 接口定义</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    public interface IBookService extends IService&lt;Book&gt; &#123;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>```java<br>public interface IBookService extends IService<Book> {</p>
<pre><code>// 追加的操作与原始操作通过名称区分，功能类似
boolean delete(Integer id);
boolean insert(Book book);
</code></pre>
<p>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 实现类定义</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    @Service</span><br><span class="line">    public class BookServiceImpl extends ServiceImpl&lt;BookDao, Book&gt; implements IBookService &#123;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>```java<br> @Service<br> public class BookServiceImpl extends ServiceImpl&lt;BookDao, Book&gt; implements IBookService {</p>
<pre><code> // 实现类实现追加
 @Autowired
 private BookDao bookDao;
 
 public boolean delete(Integer id) &#123;
     return bookDao.deleteById(id) &gt; 0;
 &#125;
 
 public boolean insert(Book book) &#123;
     return bookDao.insert(book) &gt; 0;
 &#125;
</code></pre>
<p> }</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 表现层开发</span><br><span class="line"></span><br><span class="line">  * 基于 Restful 进行表现层接口开发</span><br><span class="line">  * 使用 Postman 测试表现层接口功能</span><br><span class="line"></span><br><span class="line">* 功能测试</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    @RestController</span><br><span class="line">    @RequestMapping(&quot;&#x2F;books&quot;)</span><br><span class="line">    public class BookController &#123;</span><br><span class="line">    </span><br><span class="line">        @Autowired</span><br><span class="line">        private IBookService bookService;</span><br><span class="line">    </span><br><span class="line">        @GetMapping</span><br><span class="line">        public List&lt;Book&gt; getAll() &#123;</span><br><span class="line">            return bookService.list();</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        @PostMapping</span><br><span class="line">        public boolean save(@RequestBody Book book) &#123;</span><br><span class="line">            return bookService.save(book);</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        @PutMapping</span><br><span class="line">        public boolean update(@RequestBody Book book) &#123;</span><br><span class="line">            return bookService.updateById(book);</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        @DeleteMapping(&quot;&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">        public boolean delete(@PathVariable Integer id) &#123;</span><br><span class="line">            return bookService.removeById(id);</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        @GetMapping(&quot;&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">        public Book getById(@PathVariable Integer id) &#123;</span><br><span class="line">            return bookService.getById(id);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h5 id="表现层消息一致性处理"><a href="#表现层消息一致性处理" class="headerlink" title="表现层消息一致性处理"></a>表现层消息一致性处理</h5><ul>
<li><p>增删改：boolean 值</p>
</li>
<li><p>查单条：JSON</p>
</li>
<li><p>查全部：数组</p>
</li>
<li><p>不存在：null</p>
</li>
<li><p>查询过程中抛出异常，catch 中返回 null</p>
</li>
<li><p>设计表现层返回结果的模型类，用于后端与前端进行数据格式统一，也称为<strong>前后端数据协议</strong></p>
<ul>
<li>```java<br>@Data<br>public class R {<pre><code>private boolean flag;
private Object data;

    public R() &#123;
&#125;

public R(Boolean flag) &#123;
    this.flag = flag;
&#125;

public R(boolean flag, Object data) &#123;
    this.flag = flag;
    this.data = data;
&#125;
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 表现层接口统一返回值类型结果</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    @RestController</span><br><span class="line">    @RequestMapping(&quot;&#x2F;books&quot;)</span><br><span class="line">    public class BookController &#123;</span><br><span class="line">    </span><br><span class="line">        @Autowired</span><br><span class="line">        private IBookService bookService;</span><br><span class="line">    </span><br><span class="line">        @GetMapping</span><br><span class="line">        public R getAll() &#123;</span><br><span class="line">            return new R(true,bookService.list());</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        @PostMapping</span><br><span class="line">        public R save(@RequestBody Book book) &#123;</span><br><span class="line">            return new R(bookService.save(book));</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        @PutMapping</span><br><span class="line">        public R update(@RequestBody Book book) &#123;</span><br><span class="line">            return new R(bookService.updateById(book));</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        @DeleteMapping(&quot;&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">        public R delete(@PathVariable Integer id) &#123;</span><br><span class="line">            return new R(bookService.removeById(id));</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        @GetMapping(&quot;&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">        public R getById(@PathVariable Integer id) &#123;</span><br><span class="line">            return new R(true, bookService.getById(id));</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        @GetMapping(&quot;&#123;currentPage&#125;&#x2F;&#123;pageSize&#125;&quot;)</span><br><span class="line">        public R getPage(@PathVariable int currentPage,@PathVariable int pageSize) &#123;</span><br><span class="line">            return new R(true, bookService.getPage(currentPage, pageSize));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h5 id="小结："><a href="#小结：" class="headerlink" title="小结："></a>小结：</h5><ul>
<li>1.设计统一的返回值结果类型便于前端开发读取数据</li>
<li>2.返回值结果类型可以根据需求自行设定，没有固定格式</li>
<li>3.返回值结果模型用于后端与前端进行数据格式统一，也成为前后端数据协议</li>
</ul>
<h4 id="5-前后端协议联调"><a href="#5-前后端协议联调" class="headerlink" title="5.前后端协议联调"></a>5.前后端协议联调</h4><ul>
<li><p>前后端分离结构设计中页面归属前端服务器</p>
</li>
<li><p>单体工程中页面放置在 resources 目录下的 static 目录中（建议执行 clean）</p>
</li>
<li><p>前端发送异步请求，调用后端接口</p>
<ul>
<li>```js<br>// 列表<br>getAll() {<pre><code>axios.get(&quot;/books&quot;).then(res =&gt; &#123;
    console.log(res.data);
&#125;)
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">###### 小结：</span><br><span class="line"></span><br><span class="line">* 1.单体项目中页面放置在 resources&#x2F;static 目录下</span><br><span class="line">* 2.created 钩子函数用于初始化页面时发起调用</span><br><span class="line">* 3.页面使用 axios 发送异步请求获取数据后确认前后端是否联通</span><br><span class="line"></span><br><span class="line">#### 6.列表页</span><br><span class="line"></span><br><span class="line">将查询的数据返回到页面，利用前端数据双向绑定进行数据展示</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;js</span><br><span class="line">&#x2F;&#x2F; 列表</span><br><span class="line">getAll() &#123;</span><br><span class="line">    axios.get(&quot;&#x2F;books&quot;).then(res &#x3D;&gt; &#123;</span><br><span class="line">        console.log(res.data);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="7-添加功能"><a href="#7-添加功能" class="headerlink" title="7.添加功能"></a>7.添加功能</h4><ul>
<li><p>弹出添加窗口</p>
<ul>
<li><p>```js<br>//弹出添加窗口<br>handleCreate() {</p>
<pre><code>this.dialogFormVisible = true;
this.resetForm();
</code></pre>
<p>},</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 清除数据</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;js</span><br><span class="line">    &#x2F;&#x2F;重置表单</span><br><span class="line">    resetForm() &#123;</span><br><span class="line">        this.formData &#x3D; &#123;&#125;;</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure></li>
<li><p>```js<br>//弹出添加窗口<br>handleCreate() {</p>
<pre><code>this.dialogFormVisible = true;
this.resetForm();
</code></pre>
<p>},</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 添加</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;js</span><br><span class="line">    &#x2F;&#x2F;添加</span><br><span class="line">    handleAdd () &#123;</span><br><span class="line">        axios.post(&quot;&#x2F;books&quot;, this.formData).then(res &#x3D;&gt; &#123;</span><br><span class="line">            if(res.data.flag) &#123;</span><br><span class="line">                &#x2F;&#x2F;    1.关闭弹窗</span><br><span class="line">                this.dialogFormVisible &#x3D; false;</span><br><span class="line">                this.$message.success(&quot;添加成功&quot;)</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                this.$message.error(&quot;添加失败&quot;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).finally(() &#x3D;&gt; &#123;</span><br><span class="line">            &#x2F;&#x2F;    2.重新加载数据</span><br><span class="line">            this.getAll();</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    </span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>取消添加</p>
<ul>
<li>```js<br>//取消<br>cancel(){<pre><code>this.dialogFormVisible = false;
this.$message.info(&quot;当前操作取消&quot;);
</code></pre>
},<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 8.删除</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;js</span><br><span class="line">&#x2F;&#x2F; 删除</span><br><span class="line">handleDelete(row) &#123;</span><br><span class="line">    this.$confirm(&quot;此操作永久删除当前信息，是否继续？&quot;, &quot;提示&quot;, &#123;type: &quot;info&quot;&#125;).then(() &#x3D;&gt; &#123;</span><br><span class="line">        axios.delete(&quot;&#x2F;books&#x2F;&quot; + row.id).then(res &#x3D;&gt; &#123;</span><br><span class="line">            if(res.data.flag) &#123;</span><br><span class="line">                this.$message.success(&quot;删除成功&quot;)</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                this.$message.error(&quot;删除失败&quot;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).finally(() &#x3D;&gt; &#123;</span><br><span class="line">            &#x2F;&#x2F;    重新加载数据</span><br><span class="line">            this.getAll();</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;).catch(() &#x3D;&gt; &#123;</span><br><span class="line">        this.$message.info(&quot;取消操作&quot;);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="9-修改功能"><a href="#9-修改功能" class="headerlink" title="9.修改功能"></a>9.修改功能</h4><ul>
<li><p>弹出修改窗口</p>
<ul>
<li>```js<br>//弹出编辑窗口<br>handleUpdate(row) {<pre><code>axios.get(&quot;/books/&quot; + row.id).then(res =&gt; &#123;
    if(res.data.flag &amp;&amp;  res.data.data != null) &#123;
        this.dialogFormVisible4Edit = true;
        this.formData = res.data.data;
    &#125; else &#123;
        this.$message.error(&quot;数据同步失败，自动刷新&quot;)
    &#125;
&#125;).finally(() =&gt; &#123;
    this.getAll();
&#125;)
</code></pre>
},<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 修改</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;js</span><br><span class="line">    &#x2F;&#x2F;修改</span><br><span class="line">    handleEdit() &#123;</span><br><span class="line">        axios.put(&quot;&#x2F;books&quot;, this.formData).then(res &#x3D;&gt; &#123;</span><br><span class="line">            if(res.data.flag) &#123;</span><br><span class="line">                &#x2F;&#x2F;    1.关闭弹窗</span><br><span class="line">                this.dialogFormVisible4Edit &#x3D; false;</span><br><span class="line">                this.$message.success(&quot;修改成功&quot;)</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                this.$message.error(&quot;修改失败&quot;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).finally(() &#x3D;&gt; &#123;</span><br><span class="line">            &#x2F;&#x2F;    2.重新加载数据</span><br><span class="line">            this.getAll();</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="10-异常消息处理"><a href="#10-异常消息处理" class="headerlink" title="10.异常消息处理"></a>10.异常消息处理</h4><h5 id="业务操作成功"><a href="#业务操作成功" class="headerlink" title="业务操作成功"></a>业务操作成功</h5><ul>
<li><p>业务操作成功或失败返回数据格式</p>
<ul>
<li>```json<br>{<pre><code>&quot;flag&quot;: true,
&quot;data&quot;: null
</code></pre>
}<br>{<pre><code>&quot;flag&quot;: true,
&quot;data&quot;: null
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 后台代码 BUG 导致数据格式不统一</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;json</span><br><span class="line">    &#123;</span><br><span class="line">    	&quot;timestamp&quot;: &quot;2022-07-25T03:27:31.038+00:00&quot;,</span><br><span class="line">        &quot;status&quot;: 500,</span><br><span class="line">        &quot;error&quot;: &quot;Internal Server Error&quot;,</span><br><span class="line">        &quot;path&quot;: &quot;&#x2F;books&quot;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>对异常进行统一处理，出现异常后，返回指定信息</p>
<ul>
<li>```java<br>// 作为 springmvc 的异常处理器<br>@RestControllerAdvice<br>public class ProjectExceptionAdvice {<br>//        拦截所有异常信息<pre><code>@ExceptionHandler(Exception.class)
public R doException(Exception e) &#123;
</code></pre>
//        记录日志<br>//        通知运维<br>//        通知开发<pre><code>    e.printStackTrace();
    return new R(&quot;服务器故障，请稍后再试&quot;);
&#125;
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 可以在表现层 Controller 中进行消息统一处理</span><br><span class="line"></span><br><span class="line">* 目的：国际化</span><br><span class="line"></span><br><span class="line">#### 11.分页功能</span><br><span class="line"></span><br><span class="line">* 页面使用 el 分页组件添加分页功能</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;vue</span><br><span class="line">    &lt;div class&#x3D;&quot;pagination-container&quot;&gt;</span><br><span class="line">    </span><br><span class="line">        &lt;el-pagination</span><br><span class="line">                       class&#x3D;&quot;pagiantion&quot;</span><br><span class="line">    </span><br><span class="line">                       @current-change&#x3D;&quot;handleCurrentChange&quot;</span><br><span class="line">    </span><br><span class="line">                       :current-page&#x3D;&quot;pagination.currentPage&quot;</span><br><span class="line">    </span><br><span class="line">                       :page-size&#x3D;&quot;pagination.pageSize&quot;</span><br><span class="line">    </span><br><span class="line">                       layout&#x3D;&quot;total, prev, pager, next, jumper&quot;</span><br><span class="line">    </span><br><span class="line">                       :total&#x3D;&quot;pagination.total&quot;&gt;</span><br><span class="line">    </span><br><span class="line">        &lt;&#x2F;el-pagination&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>定义分页组件需要使用的数据并将数据绑定到分页组件</p>
<ul>
<li>```js<br>data: {<pre><code>pagination: &#123;//分页相关模型数据
    currentPage: 1,//当前页码
    pageSize:10,//每页显示的记录数
    total:0//总记录数
&#125;
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 替换查询全部功能为分页功能</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;js</span><br><span class="line">    getAll() &#123;</span><br><span class="line">        &#x2F;&#x2F;    发送异步请求</span><br><span class="line">        axios.get(&quot;&#x2F;books&#x2F;&quot; + this.pagination.currentPage + &quot;&#x2F;&quot; + this.pagination.pageSize).then(res &#x3D;&gt; &#123;</span><br><span class="line">            this.pagination.pageSize &#x3D; res.data.data.size;</span><br><span class="line">            this.pagination.currentPage &#x3D; res.data.data.current;</span><br><span class="line">            this.pagination.total &#x3D; res.data.data.total;</span><br><span class="line">            this.dataList &#x3D; res.data.data.records;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>页码值切换</p>
<ul>
<li>```js<br>//切换页码<br>handleCurrentChange(currentPage) {<pre><code>//    修改页码值为当前选中的页码值
this.pagination.currentPage = currentPage;
//    执行查询
this.getAll();
</code></pre>
},<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### 12.删除功能维护</span><br><span class="line"></span><br><span class="line">* 对查询结果进行校验，如果当前页码值大于最大页码值，使用最大页码值作为当前页码值重新查询</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    @GetMapping(&quot;&#123;currentPage&#125;&#x2F;&#123;pageSize&#125;&quot;)</span><br><span class="line">    public R getPage(@PathVariable int currentPage,@PathVariable int pageSize) &#123;</span><br><span class="line">        IPage&lt;Book&gt; page &#x3D; bookService.getPage(currentPage, pageSize);</span><br><span class="line">        &#x2F;&#x2F;        如果当前页码值大于总页码值，那么重新执行查询操作，使用最大页码值作为当前页码值</span><br><span class="line">        if(currentPage &gt; page.getPages()) &#123;</span><br><span class="line">            page &#x3D; bookService.getPage((int)page.getPages(), pageSize);</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        return new R(true, page);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="13-条件查询功能"><a href="#13-条件查询功能" class="headerlink" title="13.条件查询功能"></a>13.条件查询功能</h4><ul>
<li><p>查询条件数据封装</p>
<ul>
<li><p>单独封装</p>
</li>
<li><p>与分页操作混合封装</p>
</li>
<li><p>```js<br>pagination: {//分页相关模型数据</p>
<pre><code>currentPage: 1,//当前页码
pageSize:10,//每页显示的记录数
total:0,//总记录数
type: &quot;&quot;,
name: &quot;&quot;,
description: &quot;&quot;
</code></pre>
<p>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 组织数据成为 get 请求发送的数据</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;js</span><br><span class="line">    getAll() &#123;</span><br><span class="line">        &#x2F;&#x2F;    组织参数，拼接 url 请求地址</span><br><span class="line">        param &#x3D; &quot;?type&#x3D;&quot; + this.pagination.type;</span><br><span class="line">        param +&#x3D; &quot;&amp;name&#x3D;&quot; + this.pagination.name;</span><br><span class="line">        param +&#x3D; &quot;&amp;description&#x3D;&quot; + this.pagination.description;</span><br><span class="line">        &#x2F;&#x2F;    发送异步请求</span><br><span class="line">        axios.get(&quot;&#x2F;books&#x2F;&quot; + this.pagination.currentPage + &quot;&#x2F;&quot; + this.pagination.pageSize + param).then(res &#x3D;&gt; &#123;</span><br><span class="line">            this.pagination.pageSize &#x3D; res.data.data.size;</span><br><span class="line">            this.pagination.currentPage &#x3D; res.data.data.current;</span><br><span class="line">            this.pagination.total &#x3D; res.data.data.total;</span><br><span class="line">            this.dataList &#x3D; res.data.data.records;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>条件参数组织可以通过判定书写的更简洁</p>
</li>
<li><p>controller 接收参数</p>
<ul>
<li>```java<pre><code>@GetMapping(&quot;&#123;currentPage&#125;/&#123;pageSize&#125;&quot;)
public R getPage(@PathVariable int currentPage,@PathVariable int pageSize, Book book) &#123;
    System.out.println(book);
    IPage&lt;Book&gt; page = bookService.getPage(currentPage, pageSize, book);
</code></pre>
//        如果当前页码值大于总页码值，那么重新执行查询操作，使用最大页码值作为当前页码值<pre><code>    if(currentPage &gt; page.getPages()) &#123;
        page = bookService.getPage((int)page.getPages(), pageSize, book);
    &#125;

    return new R(page != null, page);
&#125;
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 运维实用篇</span><br><span class="line"></span><br><span class="line">## 工程打包与运行</span><br><span class="line"></span><br><span class="line">### SpringBoot 项目快速启动（Windows版）</span><br><span class="line"></span><br><span class="line">* 1.对 SpringBoot 项目打包（执行 maven 构建指令 package）</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;cmd</span><br><span class="line">    mvn package</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>2.运行项目（执行启动指令）</p>
<ul>
<li>```cmd<br>java -jar springboot.jar<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 注意事项</span><br><span class="line"></span><br><span class="line">  * jar 支持命令行启动需要依赖 maven 插件支持，请确认打包时是否具有 SpringBoot 对应的 maven 插件</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;xml</span><br><span class="line">    &lt;build&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-boot-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;&#x2F;plugin&gt;</span><br><span class="line">        &lt;&#x2F;plugins&gt;</span><br><span class="line">    &lt;&#x2F;build&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="jar-包描述文件（MANIFEST-MF）"><a href="#jar-包描述文件（MANIFEST-MF）" class="headerlink" title="jar 包描述文件（MANIFEST.MF）"></a>jar 包描述文件（MANIFEST.MF）</h4><ul>
<li><p>普通工程</p>
<ul>
<li>```mf<br>Manifest-Version: 1.0<br>Implementation-Title: springboot_08_ssmp<br>Implementation-Version: 0.0.1-SNAPSHOT<br>Build-Jdk-Spec: 1.8<br>Created-By: Maven JAR Plugin 3.2.2<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 基于 spring-boot-maven-plugin 打包的工程</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;mf</span><br><span class="line">    Manifest-Version: 1.0</span><br><span class="line">    Spring-Boot-Classpath-Index: BOOT-INF&#x2F;classpath.idx</span><br><span class="line">    Implementation-Title: springboot_08_ssmp</span><br><span class="line">    Implementation-Version: 0.0.1-SNAPSHOT</span><br><span class="line">    Spring-Boot-Layers-Index: BOOT-INF&#x2F;layers.idx</span><br><span class="line">    Start-Class: com.itheima.SSMPApplication</span><br><span class="line">    Spring-Boot-Classes: BOOT-INF&#x2F;classes&#x2F;</span><br><span class="line">    Spring-Boot-Lib: BOOT-INF&#x2F;lib&#x2F;</span><br><span class="line">    Build-Jdk-Spec: 1.8</span><br><span class="line">    Spring-Boot-Version: 2.7.2</span><br><span class="line">    Created-By: Maven JAR Plugin 3.2.2</span><br><span class="line">    Main-Class: org.springframework.boot.loader.JarLauncher</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="命令行启动常见问题及解决方案"><a href="#命令行启动常见问题及解决方案" class="headerlink" title="命令行启动常见问题及解决方案"></a>命令行启动常见问题及解决方案</h4><ul>
<li><p>Windows 端口被占用</p>
<ul>
<li>```cmd<h1 id="查询端口"><a href="#查询端口" class="headerlink" title="查询端口"></a>查询端口</h1>netstat -ano<h1 id="查询指定端口"><a href="#查询指定端口" class="headerlink" title="查询指定端口"></a>查询指定端口</h1>nestat -ano |findstr “端口号”<h1 id="根据进程-PID-查询进程名称"><a href="#根据进程-PID-查询进程名称" class="headerlink" title="根据进程 PID 查询进程名称"></a>根据进程 PID 查询进程名称</h1>tasklist |findstr “进程PID号”<h1 id="根据PID杀死任务"><a href="#根据PID杀死任务" class="headerlink" title="根据PID杀死任务"></a>根据PID杀死任务</h1>taskkill /F /PID “进程PID号”<h1 id="根据进程名称杀死任务"><a href="#根据进程名称杀死任务" class="headerlink" title="根据进程名称杀死任务"></a>根据进程名称杀死任务</h1>taskkill -f -t -im “进程名称”<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### SpringBoot 项目快速启动（Linux版）</span><br><span class="line"></span><br><span class="line">* 基于 Linux(CenterOS7)</span><br><span class="line">* 安装 JDK，且版本不低于打包时使用的 JDK 版本</span><br><span class="line">* 安装包保存在 &#x2F;usr&#x2F;local&#x2F; 自定义的目录中或 $HOME 下</span><br><span class="line">* 其他操作按照 Windows 版执行</span><br><span class="line"></span><br><span class="line">## 配置高级</span><br><span class="line"></span><br><span class="line">### 临时属性设置</span><br><span class="line"></span><br><span class="line">* 带参数启动 SpringBoot</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;cmd</span><br><span class="line">    java -jar springboot.jar --server.port&#x3D;80</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>携带多个属性启动 SpringBoot，属性间使用空格分隔</p>
</li>
</ul>
<h4 id="属性加载优先顺序"><a href="#属性加载优先顺序" class="headerlink" title="属性加载优先顺序"></a>属性加载优先顺序</h4><p>参看 <a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config">https://docs.spring.io/spring-boot/docs/current/reference/html/spring-boot-features.html#boot-features-external-config</a></p>
<h3 id="临时属性设置（开发环境）"><a href="#临时属性设置（开发环境）" class="headerlink" title="临时属性设置（开发环境）"></a>临时属性设置（开发环境）</h3><ul>
<li><p>通过编程形式带参数启动 SpringBoot 程序，为程序添加运行参数</p>
<ul>
<li>```java<br>@SpringBootApplication<br>public class SSMPApplication {<pre><code>public static void main(String[] args) &#123;
    String[] arg = new String[1];
    arg[0] = &quot;--server.port=8082&quot;;
    SpringApplication.run(SSMPApplication.class, arg);
&#125;
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 不带参数启动 SpringBoot 程序</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    @SpringBootApplication</span><br><span class="line">    public class SSMPApplication &#123;</span><br><span class="line">    </span><br><span class="line">        public static void main(String[] args) &#123;</span><br><span class="line">            SpringApplication.run(SSMPApplication.class);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="配置文件分类-1"><a href="#配置文件分类-1" class="headerlink" title="配置文件分类"></a>配置文件分类</h3><ul>
<li>1.SpringBoot 中 4 级配置文件<ul>
<li>1 级：file：config/application.yml <strong>最高</strong></li>
<li>2 级：file：application.yml</li>
<li>3 级：classpath：config/application.yml</li>
<li>4 级：classpath：application.yml <strong>最低</strong></li>
</ul>
</li>
<li>2.作用：<ul>
<li>1 级与 2 级留做系统打包后设置通用属性，1 级常用于运维经理进行线上整体项目部署方案调控</li>
<li>3 级与 4 级用于系统开发阶段设置通用属性，3 级常用于项目经理进行整体项目属性调控</li>
</ul>
</li>
</ul>
<h3 id="自定义配置文件"><a href="#自定义配置文件" class="headerlink" title="自定义配置文件"></a>自定义配置文件</h3><ul>
<li>通过启动参数加载指定文件路径下的配置文件时可以加载多个配置<ul>
<li><img src="C:\Users\15135\AppData\Roaming\Typora\typora-user-images\image-20220727113253685.png" alt="image-20220727113253685"></li>
</ul>
</li>
</ul>
<p><strong>注意事项：</strong>多配置文件常用于将配置进行分类，进行独立管理，或将可选配置单独制作便于上线更新维护</p>
<h4 id="自定义配置文件——重要说明"><a href="#自定义配置文件——重要说明" class="headerlink" title="自定义配置文件——重要说明"></a>自定义配置文件——重要说明</h4><ul>
<li>单服务器项目：使用自定义配置文件需求较低</li>
<li>多服务器项目：使用自定义配置文件需求较高，将所有配置放置在一个目录中，统一管理</li>
<li>基于 SpringCloud 技术，所有服务器将不再设置配置文件，而是通过配置中心进行设定，动态加载配置信息</li>
</ul>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li>1.SpringBoot 在开发和运行环境均支持使用临时参数修改工程配置</li>
<li>2.SpringBoot 支持 4 级配置文件，应用于开发与线上环境进行配置的灵活设置</li>
<li>3.SpringBoot 支持使用自定义配置文件的形式修改配置文件存储位置</li>
<li>4.基于微服务开发时配置文件将使用配置中心进行管理</li>
</ul>
<h3 id="多环境开发（YAML-版）"><a href="#多环境开发（YAML-版）" class="headerlink" title="多环境开发（YAML 版）"></a>多环境开发（YAML 版）</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 应用环境</span></span><br><span class="line"><span class="comment"># 启动指定环境</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">pro</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置环境</span></span><br><span class="line"><span class="comment"># 生产环境</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">pro</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 开发环境</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">81</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试环境</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">test</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">82</span></span><br></pre></td></tr></table></figure>

<h4 id="过时格式"><a href="#过时格式" class="headerlink" title="过时格式"></a>过时格式</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 应用环境</span></span><br><span class="line"><span class="comment"># 启动指定环境</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">pro</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置环境</span></span><br><span class="line"><span class="comment"># 生产环境</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">pro</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>

<h4 id="推荐格式"><a href="#推荐格式" class="headerlink" title="推荐格式"></a>推荐格式</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 应用环境</span></span><br><span class="line"><span class="comment"># 启动指定环境</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">pro</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置环境</span></span><br><span class="line"><span class="comment"># 生产环境</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">config:</span> </span><br><span class="line">    <span class="attr">activate:</span> </span><br><span class="line">      <span class="attr">on-profile:</span> <span class="string">pro</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>

<h3 id="多环境开发（YAML版）多配置文件格式"><a href="#多环境开发（YAML版）多配置文件格式" class="headerlink" title="多环境开发（YAML版）多配置文件格式"></a>多环境开发（YAML版）多配置文件格式</h3><ul>
<li><p>1.主启动配置文件 application.yml </p>
<ul>
<li>```yaml<h1 id="应用环境"><a href="#应用环境" class="headerlink" title="应用环境"></a>应用环境</h1>spring:<br>  profiles:<pre><code>active: dev
</code></pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 2.环境分类配置文件 application-pro.yml</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;yaml</span><br><span class="line">    server:</span><br><span class="line">      port: 8080</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>3.环境分类配置文件 application-dev.yml</p>
<ul>
<li>```yaml<br>server:<br>  port: 8081<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 4.环境分类配置文件 application-test.yml</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;yaml</span><br><span class="line">    server:</span><br><span class="line">      port: 8082</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="多环境开发配置文件书写技巧（一）"><a href="#多环境开发配置文件书写技巧（一）" class="headerlink" title="多环境开发配置文件书写技巧（一）"></a>多环境开发配置文件书写技巧（一）</h4><ul>
<li>主配置文件中设置公共配置（全局）</li>
<li>环境分类配置文件中常用于设置冲突属性（局部）</li>
</ul>
<h3 id="多环境开发（Properties版）多配置文件格式"><a href="#多环境开发（Properties版）多配置文件格式" class="headerlink" title="多环境开发（Properties版）多配置文件格式"></a>多环境开发（Properties版）多配置文件格式</h3><ul>
<li><p>1.主启动配置文件 application.properties</p>
<ul>
<li>```properties<br>spring.profiles.active=dev<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 2.环境分类配置文件 application-pro.properties</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;properties</span><br><span class="line">    server.port&#x3D;9081</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>3.环境分类配置文件 application-dev.properties</p>
<ul>
<li>```properties<br>server.port=9082<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 4.环境分类配置文件 application-test.properties</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;properties</span><br><span class="line">    server.port&#x3D;9080</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="多环境开发独立配置文件书写技巧（二）"><a href="#多环境开发独立配置文件书写技巧（二）" class="headerlink" title="多环境开发独立配置文件书写技巧（二）"></a>多环境开发独立配置文件书写技巧（二）</h4><ul>
<li><p>根据功能对配置文件中的信息进行拆分，并制作成独立的配置文件，命名规则如下：</p>
<ul>
<li>application-devDB.yml</li>
<li>application-devRedis.yml</li>
<li>application-devMVC.yml</li>
</ul>
</li>
<li><p>使用 include 属性在激活指定环境的情况下，同时对多个环境进行加载使其生效，多个环境间使用逗号分隔</p>
<ul>
<li>```yml<br>spring:<br>  profiles: <pre><code>active: dev
include: devDB,devRedis,decMVC
</code></pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**注意事项：**当主环境 dev 与其他环境有相同属性时，主环境属性生效，其他环境中有相同属性时，最后加载的环境属性生效</span><br><span class="line"></span><br><span class="line">----</span><br><span class="line"></span><br><span class="line">* 从 Spring Boot 2.4 版本开始使用 group 属性替代 include 属性，降低了配置书写量</span><br><span class="line"></span><br><span class="line">* 使用 group 属性定义多种主环境与子环境的包含关系</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;yml</span><br><span class="line">    spring: </span><br><span class="line">      profiles: </span><br><span class="line">        active: dev</span><br><span class="line">        groupd: </span><br><span class="line">          &quot;dev&quot;: devDB,devRedis,decMVC</span><br><span class="line">          &quot;pro&quot;: proDB,proRedis,proMVC</span><br><span class="line">          &quot;test&quot;: testDB,testRedis,testMVC</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="多环境开发控制"><a href="#多环境开发控制" class="headerlink" title="多环境开发控制"></a>多环境开发控制</h3><h4 id="Maven-与-SpringBoot-多环境兼容"><a href="#Maven-与-SpringBoot-多环境兼容" class="headerlink" title="Maven 与 SpringBoot 多环境兼容"></a>Maven 与 SpringBoot 多环境兼容</h4><ul>
<li><p>1.Maven 中设置多环境属性</p>
<ul>
<li>```xml<profiles>
    <profile>
        <id>dev_env</id>
        <properties>
            <profile.active>dev</profile.active>
        </properties>
        <activation>
            <activeByDefault>true</activeByDefault>
        </activation>
    </profile>
    <profile>
        <id>pro_env</id>
        <properties>
            <profile.active>pro</profile.active>
        </properties>
        <id>test_env</id>
        <properties>
            <profile.active>test</profile.active>
        </properties>
    </profile>
</profiles>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 2.SpringBoot 中引用 Maven 属性</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;yml</span><br><span class="line">    spring: </span><br><span class="line">      profiles: </span><br><span class="line">        active: @profile.active@</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>3.执行 Maven 打包指令，并在生成的 boot 打包文件 .jar 文件中查看对应信息</p>
</li>
</ul>
<h2 id="日志"><a href="#日志" class="headerlink" title="日志"></a>日志</h2><h3 id="日志基础"><a href="#日志基础" class="headerlink" title="日志基础"></a>日志基础</h3><h4 id="日志基础操作"><a href="#日志基础操作" class="headerlink" title="日志基础操作"></a>日志基础操作</h4><ul>
<li>日志（log）作用<ul>
<li>编译期调试代码</li>
<li>运营期记录信息<ul>
<li>记录日常运营重要信息（峰值流量、平均响应时长。。。）</li>
<li>记录应用报错信息（错误堆栈）</li>
<li>记录错误运维过程数据（扩容、宕机、报警。。。）</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="代码中使用日志工具记录日志"><a href="#代码中使用日志工具记录日志" class="headerlink" title="代码中使用日志工具记录日志"></a>代码中使用日志工具记录日志</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Rest 模式</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/books&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    创建记录日志的对象</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger log = LoggerFactory.getLogger(BookController.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getById</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;springboot is running&quot;</span>);</span><br><span class="line"></span><br><span class="line">        log.debug(<span class="string">&quot;debug...&quot;</span>);</span><br><span class="line">        log.info(<span class="string">&quot;info...&quot;</span>);</span><br><span class="line">        log.warn(<span class="string">&quot;warn...&quot;</span>);</span><br><span class="line">        log.error(<span class="string">&quot;error...&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;springboot is running&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="日志级别"><a href="#日志级别" class="headerlink" title="日志级别"></a>日志级别</h5><ul>
<li>TRACE：运行堆栈信息，使用率低</li>
<li>DEBUG：程序员调试代码使用</li>
<li>INFO：记录运维过程数据</li>
<li>WARN：记录运维过程报警数据</li>
<li>ERROR：记录错误堆栈信息</li>
<li>FATAL：灾难信息，合并计入 ERROR</li>
</ul>
<h5 id="设置日志输出级别"><a href="#设置日志输出级别" class="headerlink" title="设置日志输出级别"></a>设置日志输出级别</h5><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application.yml</span></span><br><span class="line"><span class="comment"># 开启 debug 模式，输出调试信息，常用于检查系统运行状况</span></span><br><span class="line"><span class="attr">debug:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置日志级别，root 表示根节点，即整体应用日志级别</span></span><br><span class="line"><span class="attr">loggin:</span> </span><br><span class="line">  <span class="attr">level:</span> </span><br><span class="line">    <span class="attr">root:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure>

<h5 id="设置日志组"><a href="#设置日志组" class="headerlink" title="设置日志组"></a>设置日志组</h5><p>设置日志组，控制包对应的日志输出级别也可以直接控制指定包对应的日志输出级别</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># application.yml</span></span><br><span class="line"><span class="attr">logging:</span> </span><br><span class="line">  <span class="comment"># 设置日志组</span></span><br><span class="line">  <span class="attr">group:</span> </span><br><span class="line">    <span class="comment"># 自定义组名，设置当前组中所包含的包</span></span><br><span class="line">    <span class="attr">ebank:</span> <span class="string">com.itheima.controller</span></span><br><span class="line">  <span class="attr">level:</span> </span><br><span class="line">    <span class="attr">root:</span> <span class="string">warn</span></span><br><span class="line">    <span class="comment"># 为对应的组设置日志级别</span></span><br><span class="line">    <span class="attr">ebank:</span> <span class="string">debug</span></span><br><span class="line">    <span class="comment"># 为对应的包设置日志级别</span></span><br><span class="line">    <span class="attr">com.itheima.controller:</span> <span class="string">debug</span></span><br></pre></td></tr></table></figure>

<h5 id="优化日志对象创建代码"><a href="#优化日志对象创建代码" class="headerlink" title="优化日志对象创建代码"></a>优化日志对象创建代码</h5><ul>
<li><p>使用 lombok 提供的注解 @Slf4j 简化开发，减少日志对象的声明操作</p>
<ul>
<li>```java<br>// Rest 模式<br>@Slf4j<br>@RestController<br>@RequestMapping(“/books”)<br>public class BookController {//    创建记录日志的对象<pre><code>private static final Logger log = LoggerFactory.getLogger(BookController.class);

@GetMapping
public String getById() &#123;
    System.out.println(&quot;springboot is running&quot;);

    log.debug(&quot;debug...&quot;);
    log.info(&quot;info...&quot;);
    log.warn(&quot;warn...&quot;);
    log.error(&quot;error...&quot;);

    return &quot;springboot is running&quot;;
&#125;
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 日志输出格式控制</span><br><span class="line"></span><br><span class="line">![image-20220729115500864](C:\Users\15135\AppData\Roaming\Typora\typora-user-images\image-20220729115500864.png)</span><br><span class="line"></span><br><span class="line">* 时间</span><br><span class="line">* 级别</span><br><span class="line">* PID：进程 ID，用于表明当前操作所处的进程，当多服务同时记录日志时，该值可用于协助程序员调试程序</span><br><span class="line">* 所属线程</span><br><span class="line">* 所属类&#x2F;接口名：当前显示信息为 SpringBoot 重写后的信息，名称过长时，简化包名书写为首字母，甚至直接删除</span><br><span class="line"></span><br><span class="line">#### 设置日志输出格式</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;yml</span><br><span class="line">logging: </span><br><span class="line">  pattern: </span><br><span class="line">    console: &quot;%d - %m%n&quot;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>%d：日期</p>
</li>
<li><p>%m：消息</p>
</li>
<li><p>%n：换行</p>
</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">pattern:</span></span><br><span class="line"><span class="comment">#    console: &quot;%d - %m%n&quot;</span></span><br><span class="line"><span class="comment">#    console: &quot;%d %clr(%5p) %n&quot;</span></span><br><span class="line">    <span class="attr">console:</span> <span class="string">&quot;%d %clr(%5p) --- [%16t] %clr(%-40.40c)&#123;cyan&#125; : %m %n&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="日志文件"><a href="#日志文件" class="headerlink" title="日志文件"></a>日志文件</h3><ul>
<li><p>设置日志文件</p>
<ul>
<li>```yaml<br>logging:<br>  file: <pre><code>name: server.log
</code></pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 日志文件详细配置</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;yaml</span><br><span class="line">    logging: </span><br><span class="line">      file: </span><br><span class="line">        name: server.log</span><br><span class="line">      logback: </span><br><span class="line">        rollingpolicy: </span><br><span class="line">          max-file-size: 3KB</span><br><span class="line">          file-name-pattern: server.%d&#123;yyyy-MM-dd&#125;.%i.log</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h1 id="开发实用篇"><a href="#开发实用篇" class="headerlink" title="开发实用篇"></a>开发实用篇</h1><h2 id="热部署"><a href="#热部署" class="headerlink" title="热部署"></a>热部署</h2><h3 id="启动热部署"><a href="#启动热部署" class="headerlink" title="启动热部署"></a>启动热部署</h3><ul>
<li>关于热部署<ul>
<li>重启（Restart）：自定义开发代码，包含类、页面、配置文件等，加载位置 restart 类加载器</li>
<li>重载（ReLoad）：jar 包，加载位置 base 类加载器</li>
</ul>
</li>
</ul>
<h4 id="手动启动热部署"><a href="#手动启动热部署" class="headerlink" title="手动启动热部署"></a>手动启动热部署</h4><ul>
<li><p>1.在 pom.xml 文件中引入坐标</p>
<ul>
<li>```xml<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-devtools</artifactId>
</dependency>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 2.点击 构建 -&gt; 构建项目或者 ctrl +f9</span><br><span class="line"></span><br><span class="line">#### 自动启动热部署</span><br><span class="line"></span><br><span class="line">* 设置自动构建项目</span><br><span class="line">  * ![image-20220729163858212](C:\Users\15135\AppData\Roaming\Typora\typora-user-images\image-20220729163858212.png)</span><br><span class="line">  * 在 controller 类中按 ctrl + shift + alt + &#x2F; 选择 registry</span><br><span class="line">  * 勾选 compiler.automake.allow.when.app.running</span><br><span class="line">* 激活方式：idea 失去焦点 5 秒后启动热部署</span><br><span class="line"></span><br><span class="line">### 热部署范围配置</span><br><span class="line"></span><br><span class="line">* 默认不触发重启的目录列表</span><br><span class="line"></span><br><span class="line">  * &#x2F;META-INF&#x2F;maven</span><br><span class="line">  * &#x2F;META-INF&#x2F;resources</span><br><span class="line">  * &#x2F;resources</span><br><span class="line">  * &#x2F;static</span><br><span class="line">  * &#x2F;public</span><br><span class="line">    * &#x2F;templates</span><br><span class="line"></span><br><span class="line">* 自定义不参与中期排除项</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;yaml</span><br><span class="line">    devtools: </span><br><span class="line">      restart: </span><br><span class="line">        exclude: public&#x2F;**,static&#x2F;**</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="关闭热部署"><a href="#关闭热部署" class="headerlink" title="关闭热部署"></a>关闭热部署</h3><ul>
<li><p>设置高优先级属性禁用热部署</p>
<ul>
<li><p>```java<br>@SpringBootApplication<br>public class SSMPApplication {</p>
<pre><code>public static void main(String[] args) &#123;
     System.setProperty(&quot;spring.devtools.restart.enabled&quot;, &quot;false&quot;);
    SpringApplication.run(SSMPApplication.class, args);
&#125;
</code></pre>
<p>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">## 配置高级</span><br><span class="line"></span><br><span class="line">### @ConfigurationProperties</span><br><span class="line"></span><br><span class="line">* 使用 @ConfigurationProperties 为第三方 bean 绑定属性</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    &#x2F;&#x2F; 启动类</span><br><span class="line">    @Bean</span><br><span class="line">    @ConfigurationProperties(prefix &#x3D; &quot;datasource&quot;)</span><br><span class="line">    public DruidDataSource dataSource() &#123;</span><br><span class="line">        DruidDataSource ds &#x3D; new DruidDataSource();</span><br><span class="line">        return ds;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>```yaml</p>
<h1 id="application-yml-2"><a href="#application-yml-2" class="headerlink" title="application.yml"></a>application.yml</h1><p>datasource:<br>  driverClassName: com.mysql.cj.jdbc.Driver</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 解除使用 @ConfigurationProperties 注释警告</span><br><span class="line"></span><br><span class="line">  * 在 pom.xml 中加入以下坐标</span><br><span class="line"></span><br><span class="line">    * &#96;&#96;&#96;xml</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;spring-boot-configuration-processor&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="EnableConfigurationProperties"><a href="#EnableConfigurationProperties" class="headerlink" title="@EnableConfigurationProperties"></a>@EnableConfigurationProperties</h4><ul>
<li><p>@EnableConfigurationProperties 注解可以将使用 @ConfigurationProperties 注解对应的类加入 Spring 容器</p>
<ul>
<li>```java<br>// demo.java<br>@SpringBootApplication<br>@EnableConfigurationProperties(ServerConfig.class)<br>public class DemoApplication {}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* &#96;&#96;&#96;java</span><br><span class="line">  &#x2F;&#x2F; ServerConfig.java</span><br><span class="line">  @Data</span><br><span class="line">  @ConfigurationProperties(prefix &#x3D; &quot;servers&quot;)</span><br><span class="line">  public class ServerConfig &#123;</span><br><span class="line">      </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<p><strong>注意事项：</strong>@EnableConfigurationProperties 与 @Component 不能同时使用 </p>
<h3 id="宽松绑定-松散绑定"><a href="#宽松绑定-松散绑定" class="headerlink" title="宽松绑定/松散绑定"></a>宽松绑定/松散绑定</h3><h4 id="宽松绑定"><a href="#宽松绑定" class="headerlink" title="宽松绑定"></a>宽松绑定</h4><ul>
<li><p>@ConfigurationProperties 绑定属性支持属性名宽松绑定</p>
<ul>
<li>```java<br>public class ServerConfig {<pre><code>private String ipAddress;
private int port;
private long timeout;
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 驼峰模式：ipAddress</span><br><span class="line"></span><br><span class="line">* 下划线模式：ip_address</span><br><span class="line"></span><br><span class="line">* 中划线模式（烤串模式）：ip-address</span><br><span class="line"></span><br><span class="line">* 常量模式：IP_ADDRESS</span><br><span class="line"></span><br><span class="line">* **注意事项：**宽松绑定不支持注解 @Value 引用单个属性的方式，绑定前缀名命名规范：仅能使用纯小写字母、数字、中划线作为合法的字符</span><br><span class="line"></span><br><span class="line">### 常用计量单位绑定</span><br><span class="line"></span><br><span class="line">* SpringBoot 支持 JDK8 提供的时间与空间计量单位</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    @Component</span><br><span class="line">    @Data</span><br><span class="line">    @ConfigurationProperties(prefix &#x3D; &quot;servers&quot;)</span><br><span class="line">    public class ServerConfig &#123;</span><br><span class="line">        private String ipAddress;</span><br><span class="line">        private int port;</span><br><span class="line">        private long timeout;</span><br><span class="line">        @DurationUnit(ChronoUnit.MINUTES)</span><br><span class="line">        private Duration serverTimeOut;</span><br><span class="line">        @DataSizeUnit(DataUnit.MEGABYTES)</span><br><span class="line">        private DataSize dataSize;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="数据校验"><a href="#数据校验" class="headerlink" title="数据校验"></a>数据校验</h3><ul>
<li>开启数据校验有助于系统安全性，J2EE 规范中 JSR303 规范定义了一组有关数据校验相关的 API</li>
</ul>
<h4 id="开启-Bean-数据校验"><a href="#开启-Bean-数据校验" class="headerlink" title="开启 Bean 数据校验"></a>开启 Bean 数据校验</h4><ul>
<li><p>1.添加 JSR303 规范坐标与 Hibernate 校验框架对应坐标</p>
<ul>
<li>```xml<!-- pom.xml -->
<!--        1.导入 JSR303 规范-->
<dependency>
    <groupId>javax.validation</groupId>
    <artifactId>validation-api</artifactId>
</dependency>

<!--        使用 hibernate 框架提供的校验器做实现类-->
<dependency>
    <groupId>org.hibernate.validator</groupId>
    <artifactId>hibernate-validator</artifactId>
</dependency>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 2.对 Bean 开启校验功能</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    &#x2F;&#x2F; ServerConfig.java</span><br><span class="line">    @Component</span><br><span class="line">    @Data</span><br><span class="line">    @ConfigurationProperties(prefix &#x3D; &quot;servers&quot;)</span><br><span class="line">    &#x2F;&#x2F; 2.开启对当前 bean 的属性注入校验</span><br><span class="line">    @Validated</span><br><span class="line">    public class ServerConfig &#123;</span><br><span class="line">        private String ipAddress;</span><br><span class="line">        @Max(value &#x3D; 8888, message &#x3D; &quot;最大值不能超过8888&quot;)</span><br><span class="line">        private int port;</span><br><span class="line">        private long timeout;</span><br><span class="line">        @DurationUnit(ChronoUnit.MINUTES)</span><br><span class="line">        private Duration serverTimeOut;</span><br><span class="line">        @DataSizeUnit(DataUnit.MEGABYTES)</span><br><span class="line">        private DataSize dataSize;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="进制转换规则"><a href="#进制转换规则" class="headerlink" title="进制转换规则"></a>进制转换规则</h4><p>数字记得加字符，否则可能会被误认为八进制或其他进制数</p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><h3 id="加载测试专用属性"><a href="#加载测试专用属性" class="headerlink" title="加载测试专用属性"></a>加载测试专用属性</h3><ul>
<li><p>在启动测试环境时可以通过 properties 参数设置测试环境专用的属性</p>
<ul>
<li>```java<br>// properties 属性可以为当前测试用例添加临时的属性配置<br>//@SpringBootTest(properties = {“test.prop=testValue1”})<br>// args 属性可以为当前测试用例添加临时的命令行参数<br>//@SpringBootTest(args = {“–test.prop=testValue2”})<br>@SpringBootTest(properties = {“test.prop=testValue1”}, args = {“–test.prop=testValue2”})<br>public class PropertiesAndArgsTest {<pre><code>@Value(&quot;$&#123;test.prop&#125;&quot;)
private String msg;

@Test
void testPorperties() &#123;
    System.out.println(msg);
&#125;
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  * 优势：比多环境开发中的测试环境影响范围更小，仅对当前测试类有效</span><br><span class="line"></span><br><span class="line">### 加载测试专用配置</span><br><span class="line"></span><br><span class="line">* 使用 @Import 注解加载当前测试类专用的配置</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    @SpringBootTest</span><br><span class="line">    @Import(&#123;MsgConfig.class&#125;)</span><br><span class="line">    public class ConfigurationTest &#123;</span><br><span class="line">    </span><br><span class="line">        @Autowired</span><br><span class="line">        private String msg;</span><br><span class="line">    </span><br><span class="line">        @Test</span><br><span class="line">        void testConfiguration() &#123;</span><br><span class="line">            System.out.println(msg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="web-环境模拟测试"><a href="#web-环境模拟测试" class="headerlink" title="web 环境模拟测试"></a>web 环境模拟测试</h3><ul>
<li><p>模拟端口</p>
<ul>
<li>```java<br>@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)<br>public class WebTest {<pre><code>@Test
void test() &#123;

&#125;
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 虚拟请求测试</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    @SpringBootTest(webEnvironment &#x3D; SpringBootTest.WebEnvironment.RANDOM_PORT)</span><br><span class="line">    &#x2F;&#x2F; 开启虚拟 MVC 的调用</span><br><span class="line">    @AutoConfigureMockMvc</span><br><span class="line">    public class WebTest &#123;</span><br><span class="line">        @Test</span><br><span class="line">        void testWeb(@Autowired MockMvc mvc) throws Exception &#123;</span><br><span class="line">    &#x2F;&#x2F;        创建虚拟请求</span><br><span class="line">            MockHttpServletRequestBuilder builder &#x3D; MockMvcRequestBuilders.get(&quot;&#x2F;books&quot;);</span><br><span class="line">    &#x2F;&#x2F;        执行对应请求</span><br><span class="line">            mvc.perform(builder);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>虚拟请求状态匹配</p>
<ul>
<li>```java<br>@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)<br>// 开启虚拟 MVC 的调用<br>@AutoConfigureMockMvc<br>public class WebTest {<pre><code>@Test
void testStatus(@Autowired MockMvc mvc) throws Exception &#123;
    MockHttpServletRequestBuilder builder = MockMvcRequestBuilders.get(&quot;/books&quot;);
    ResultActions actions = mvc.perform(builder);
</code></pre>
//        设定预期值，与真实值进行比较，成功测试通过，失败测试失败<br>//        定义本次调用的预期值<pre><code>    StatusResultMatchers status = MockMvcResultMatchers.status();
</code></pre>
//        预计本次调用时成功的：状态 200<pre><code>    ResultMatcher ok = status.isOk();
</code></pre>
//        添加预计值到本次调用过程中进行匹配<pre><code>    actions.andExpect(ok);

&#125;
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 虚拟请求体匹配</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    @SpringBootTest(webEnvironment &#x3D; SpringBootTest.WebEnvironment.RANDOM_PORT)</span><br><span class="line">    &#x2F;&#x2F; 开启虚拟 MVC 的调用</span><br><span class="line">    @AutoConfigureMockMvc</span><br><span class="line">    public class WebTest &#123;</span><br><span class="line">        @Test</span><br><span class="line">        void testBody(@Autowired MockMvc mvc) throws Exception &#123;</span><br><span class="line">            MockHttpServletRequestBuilder builder &#x3D; MockMvcRequestBuilders.get(&quot;&#x2F;books&quot;);</span><br><span class="line">            ResultActions actions &#x3D; mvc.perform(builder);</span><br><span class="line">    &#x2F;&#x2F;        设定预期值，与真实值进行比较，成功测试通过，失败测试失败</span><br><span class="line">    &#x2F;&#x2F;        定义本次调用的预期值</span><br><span class="line">            ContentResultMatchers content &#x3D; MockMvcResultMatchers.content();</span><br><span class="line">            ResultMatcher result &#x3D; content.string(&quot;springboot&quot;);</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F;        添加预计值到本次调用过程中进行匹配</span><br><span class="line">            actions.andExpect(result);</span><br><span class="line">    </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>虚拟请求体（json）匹配</p>
<ul>
<li>```java<br>@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)<br>// 开启虚拟 MVC 的调用<br>@AutoConfigureMockMvc<br>public class WebTest {<pre><code>@Test
void testJson(@Autowired MockMvc mvc) throws Exception &#123;
    MockHttpServletRequestBuilder builder = MockMvcRequestBuilders.get(&quot;/books&quot;);
    ResultActions actions = mvc.perform(builder);
</code></pre>
//        设定预期值，与真实值进行比较，成功测试通过，失败测试失败<br>//        定义本次调用的预期值<pre><code>    ContentResultMatchers content = MockMvcResultMatchers.content();
    ResultMatcher result = content.json(&quot;&#123;\&quot;id\&quot;:1,\&quot;name\&quot;:\&quot;springboot\&quot;,\&quot;type\&quot;:\&quot;springboot\&quot;,\&quot;description\&quot;:\&quot;springboot\&quot;&#125;&quot;);
</code></pre>
//        添加预计值到本次调用过程中进行匹配<pre><code>    actions.andExpect(result);

&#125;
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 虚拟请求头匹配</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    package com.itheima;</span><br><span class="line">    </span><br><span class="line">    import org.junit.jupiter.api.Test;</span><br><span class="line">    import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">    import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;</span><br><span class="line">    import org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line">    import org.springframework.test.web.servlet.MockMvc;</span><br><span class="line">    import org.springframework.test.web.servlet.RequestBuilder;</span><br><span class="line">    import org.springframework.test.web.servlet.ResultActions;</span><br><span class="line">    import org.springframework.test.web.servlet.ResultMatcher;</span><br><span class="line">    import org.springframework.test.web.servlet.request.MockHttpServletRequestBuilder;</span><br><span class="line">    import org.springframework.test.web.servlet.request.MockMvcRequestBuilders;</span><br><span class="line">    import org.springframework.test.web.servlet.result.ContentResultMatchers;</span><br><span class="line">    import org.springframework.test.web.servlet.result.HeaderResultMatchers;</span><br><span class="line">    import org.springframework.test.web.servlet.result.MockMvcResultMatchers;</span><br><span class="line">    import org.springframework.test.web.servlet.result.StatusResultMatchers;</span><br><span class="line">    </span><br><span class="line">    @SpringBootTest(webEnvironment &#x3D; SpringBootTest.WebEnvironment.RANDOM_PORT)</span><br><span class="line">    &#x2F;&#x2F; 开启虚拟 MVC 的调用</span><br><span class="line">    @AutoConfigureMockMvc</span><br><span class="line">    public class WebTest &#123;</span><br><span class="line">    </span><br><span class="line">        @Test</span><br><span class="line">        void testContentType(@Autowired MockMvc mvc) throws Exception &#123;</span><br><span class="line">            MockHttpServletRequestBuilder builder &#x3D; MockMvcRequestBuilders.get(&quot;&#x2F;books&quot;);</span><br><span class="line">            ResultActions actions &#x3D; mvc.perform(builder);</span><br><span class="line">    &#x2F;&#x2F;        设定预期值，与真实值进行比较，成功测试通过，失败测试失败</span><br><span class="line">    &#x2F;&#x2F;        定义本次调用的预期值</span><br><span class="line">            HeaderResultMatchers header &#x3D; MockMvcResultMatchers.header();</span><br><span class="line">            ResultMatcher result &#x3D; header.string(&quot;Content-Type&quot;, &quot;application&#x2F;json&quot;);</span><br><span class="line">    &#x2F;&#x2F;        添加预计值到本次调用过程中进行匹配</span><br><span class="line">            actions.andExpect(result);</span><br><span class="line">    </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<p><strong>注意：</strong>一般都把多个匹配测试写在一起，一个规则一个对象，精度更高</p>
<h3 id="数据层测试事务回滚"><a href="#数据层测试事务回滚" class="headerlink" title="数据层测试事务回滚"></a>数据层测试事务回滚</h3><ul>
<li><p>为测试用例添加事务，SpringBoot 会对测试用例对应的事务提交操作进行回滚</p>
<ul>
<li>```java<br>@SpringBootTest<br>@Transactional<br>public class DaoTest {<pre><code>@Autowired
private BookService bookService;

@Test
void testSave() &#123;
    bookService.save(new Book(2,&quot;springboot2&quot;,&quot;springboot&quot;,&quot;springboot&quot;));
&#125;
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 如果想在测试用例中提交事务，可以通过 @Rollback 注解设置</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    @SpringBootTest</span><br><span class="line">    @Transactional</span><br><span class="line">    @Rollback(false)</span><br><span class="line">    public class DaoTest &#123;</span><br><span class="line">    </span><br><span class="line">        @Autowired</span><br><span class="line">        private BookService bookService;</span><br><span class="line">    </span><br><span class="line">        @Test</span><br><span class="line">        void testSave() &#123;</span><br><span class="line">            bookService.save(new Book(2,&quot;springboot2&quot;,&quot;springboot&quot;,&quot;springboot&quot;));</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="测试用例数据设定"><a href="#测试用例数据设定" class="headerlink" title="测试用例数据设定"></a>测试用例数据设定</h3><ul>
<li><p>测试用例数据通常采用随机值进行测试，使用 SpringBoot 提供的随机数为其赋值</p>
<ul>
<li>```yaml<br>testcase:<br>  book:<pre><code>id: $&#123;random.int&#125;
name: $&#123;random.value&#125;
uuid: $&#123;random.uuid&#125;
publishTime: $&#123;random.long&#125;
</code></pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  * $&#123;random.int&#125; 表示随机数</span><br><span class="line"></span><br><span class="line">  * $&#123;random.int(10)&#125; 表示 10 以内的随机数</span><br><span class="line"></span><br><span class="line">  * $&#123;randmom.int(10,20)&#125; 表示 10 到 20 的随机数</span><br><span class="line"></span><br><span class="line">  * 其中 () 可以是任意字符，例如 [], !!, @@ 均可</span><br><span class="line"></span><br><span class="line">## 数据层解决方案</span><br><span class="line"></span><br><span class="line">### SQL</span><br><span class="line"></span><br><span class="line">* 现有数据层解决方案技术选型：Druid + MyBtais-Plus + MySQL</span><br><span class="line"></span><br><span class="line">  * 数据源：DruidDataSource</span><br><span class="line">  * 持久化技术：Mybatis-Plus&#x2F;Mybatis</span><br><span class="line">  * 数据库：MySQL</span><br><span class="line"></span><br><span class="line">* 格式一</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;yaml</span><br><span class="line">    spring:</span><br><span class="line">      datasource: </span><br><span class="line">        driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">        url: jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;ssm_db?serverTimezone&#x3D;UTC</span><br><span class="line">        username: root</span><br><span class="line">        password: root</span><br><span class="line">        type: com.alibaba.druid.pool.DruidDataSource</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>格式二</p>
<ul>
<li>```yaml<br>spring:<br>  datasource: <pre><code>druid: 
  driver-class-name: com.mysql.cj.jdbc.Driver
  url: jdbc:mysql://localhost:3306/ssm_db?serverTimezone=UTC
  username: root
  password: root
</code></pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 数据源配置</span><br><span class="line"></span><br><span class="line">* SpringBoot 提供了 3 种内嵌的数据源对象供开发者选择</span><br><span class="line"></span><br><span class="line">  * HikariCP：默认内置数据源对象</span><br><span class="line"></span><br><span class="line">  * Tomcat 提供 DataSource：HikariCP 不可用的情况下，且在 web 环境中，将使用 tomcat 服务器配置的数据源对象</span><br><span class="line"></span><br><span class="line">  * Commons DBCP：Hikari 不可用，tomcat 数据源也不可用，将使用 dbcp 数据源</span><br><span class="line"></span><br><span class="line">    * &#96;&#96;&#96;yaml</span><br><span class="line">      spring:</span><br><span class="line">        datasource:</span><br><span class="line">          url: jdbc:mysql:&#x2F;&#x2F;localhost:3306&#x2F;ssm_db?serverTimezone&#x3D;UTC</span><br><span class="line">          driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">          username: root</span><br><span class="line">          password: zt20020806</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>通用配置无法设置具体的数据源配置信息，仅提供基本的连接相关配置，如需配置，在下一级配置中设置具体设定</p>
<ul>
<li><p>```yaml<br>spring:<br>  datasource:</p>
<pre><code>url: jdbc:mysql://localhost:3306/ssm_db?serverTimezone=UTC
driver-class-name: com.mysql.cj.jdbc.Driver
username: root
password: zt20020806
hikari:
  maximum-pool-size: 50
</code></pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 内置持久化解决方案——JdbcTemplate</span><br><span class="line"></span><br><span class="line">  * pom.xml 导入坐标</span><br><span class="line"></span><br><span class="line">    * &#96;&#96;&#96;xml</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">      &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;spring-boot-starter-jdbc&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>```java<br>package com.itheima;</p>
<p>import com.itheima.dao.BookDao;<br>import com.itheima.domain.Book;<br>import org.junit.jupiter.api.Test;<br>import org.springframework.beans.factory.annotation.Autowired;<br>import org.springframework.boot.test.context.SpringBootTest;<br>import org.springframework.jdbc.core.JdbcTemplate;<br>import org.springframework.jdbc.core.RowMapper;</p>
<p>import java.sql.ResultSet;<br>import java.sql.SQLException;<br>import java.util.List;<br>import java.util.Map;</p>
<p>@SpringBootTest<br>class Springboot15SqlApplicationTests {</p>
<pre><code>@Test
void testJdbcTemplate(@Autowired JdbcTemplate jdbcTemplate) &#123;
    String sql = &quot;select * from tb_book&quot;;
</code></pre>
<p>//        List&lt;Map&lt;String, Object&gt;&gt; maps = jdbcTemplate.queryForList(sql);<br>//        System.out.println(maps);</p>
<pre><code>    RowMapper&lt;Book&gt; rm = new RowMapper&lt;Book&gt;() &#123;
        @Override
        public Book mapRow(ResultSet rs, int rowNum) throws SQLException &#123;

            Book temp = new Book();
            temp.setId(rs.getInt(&quot;id&quot;));
            temp.setName(rs.getString(&quot;name&quot;));
            temp.setType(rs.getString(&quot;type&quot;));
            temp.setDescription(rs.getString(&quot;description&quot;));
            return temp;
        &#125;
    &#125;;
    List&lt;Book&gt; bookList = jdbcTemplate.query(sql, rm);
    for (Book book : bookList) &#123;
        System.out.println(book);
    &#125;
&#125;
</code></pre>
<p>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* JdbTemplate 配置</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;yaml</span><br><span class="line">    spring: </span><br><span class="line">      jdbc: </span><br><span class="line">        template: </span><br><span class="line">          query-timeout: -1  # 查询超时时间</span><br><span class="line">          max-rows: 500      # 最大行数</span><br><span class="line">          fetch-size: -1     # 缓存行数</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="内嵌数据库"><a href="#内嵌数据库" class="headerlink" title="内嵌数据库"></a>内嵌数据库</h4><ul>
<li>SpringBoot 提供了 3 种内嵌数据库供开发者选择，提高开发测试效率<ul>
<li>H2</li>
<li>HSQL</li>
<li>Derby</li>
</ul>
</li>
</ul>
<h5 id="内嵌数据库（H2）"><a href="#内嵌数据库（H2）" class="headerlink" title="内嵌数据库（H2）"></a>内嵌数据库（H2）</h5><ul>
<li><p>导入 H2 相关坐标</p>
<ul>
<li><p>```xml</p>
<dependency>
    <groupId>com.h2database</groupId>
    <artifactId>h2</artifactId>
</dependency>

<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-jpa</artifactId>
</dependency>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 设置当前项目为 web 工程，并配置 H2 管理控制台参数</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;yaml</span><br><span class="line">    servrer: </span><br><span class="line">      port: 80</span><br><span class="line">    spring: </span><br><span class="line">      h2: </span><br><span class="line">        console: </span><br><span class="line">          path: &#x2F;h2</span><br><span class="line">          enabled: true</span><br></pre></td></tr></table></figure></li>
<li><p>访问用户名 sa，默认密码 123456</p>
</li>
</ul>
</li>
<li><p>设置访问数据源</p>
<ul>
<li>```yaml<br>server:<br>  port: 88<br>spring:<br>  h2:<pre><code>console:
  path: /h2
  enabled: true
</code></pre>
  datasource:<pre><code>url: jdbc:h2:~/test
driver-class-name: org.h2.Driver
username: sa
password: 123456
</code></pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* H2 数据库控制台仅用于开发阶段，线上项目请务必关闭控制台功能</span><br><span class="line"></span><br><span class="line">###### 数据库设定</span><br><span class="line"></span><br><span class="line">* SpringBoot 可以根据 url 地址自动识别数据库种类，在保障驱动类存在的情况下，可以省略配置</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;yaml</span><br><span class="line">    server:</span><br><span class="line">      port: 88</span><br><span class="line">    spring:</span><br><span class="line">      h2:</span><br><span class="line">        console:</span><br><span class="line">          path: &#x2F;h2</span><br><span class="line">          enabled: true</span><br><span class="line">    </span><br><span class="line">      datasource:</span><br><span class="line">        url: jdbc:h2:~&#x2F;test</span><br><span class="line">        # driver-class-name: org.h2.Driver</span><br><span class="line">        username: sa</span><br><span class="line">        password: 123456</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>现有数据层解决方案技术选型</p>
<ul>
<li>数据源：Druid、Hikari</li>
<li>持久化：MyBatis-Plus、MyBatis、JdbcTemplate</li>
<li>数据库：MySQL、H2</li>
</ul>
</li>
</ul>
<h3 id="NoSQL"><a href="#NoSQL" class="headerlink" title="NoSQL"></a>NoSQL</h3><ul>
<li>市面上常见的 NoSQL 解决方案<ul>
<li>Redis</li>
<li>Mongo</li>
<li>ES</li>
</ul>
</li>
<li>说明：上述技术通常在 Linux 系统中安装部署</li>
</ul>
<h4 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h4><ul>
<li><p>Redis 是一款 key-value 存储结构的内存级 NoSQL 数据库</p>
<ul>
<li>支持多种数据存储格式</li>
<li>支持持久化</li>
<li>支持集群</li>
</ul>
</li>
<li><p>Redis 安装与启动（Windows版）</p>
<ul>
<li><p>Windows 解压安装或一键式安装</p>
</li>
<li><p>服务器端启动命令</p>
<ul>
<li>```cmd<br>redis-server.exe redis.windows.conf<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 客户端启动命令</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;cmd</span><br><span class="line">    redis-cli.exe</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="SpringBoot-整合-Redis"><a href="#SpringBoot-整合-Redis" class="headerlink" title="SpringBoot 整合 Redis"></a>SpringBoot 整合 Redis</h5><ul>
<li><p>导入 SpringBoot 整合 Redis 坐标</p>
<ul>
<li><p>```xml</p>
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-redis</artifactId>
</dependency>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 配置 Redis（采用默认配置）</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;yaml</span><br><span class="line">    spring:</span><br><span class="line">      redis:</span><br><span class="line">        host: localhost</span><br><span class="line">        port: 6379</span><br></pre></td></tr></table></figure></li>
<li><p>主机：localhost（默认）</p>
</li>
<li><p>端口：6379（默认）</p>
</li>
</ul>
</li>
<li><p>RedisTemplate 提供操作各种数据存储类型的接口 API</p>
</li>
<li><p>客户端：</p>
<ul>
<li>```java<br>@SpringBootTest<br>class Springboot16RedisApplicationTests {<pre><code>@Autowired
private RedisTemplate redisTemplate;

@Test
void set() &#123;
    ValueOperations ops = redisTemplate.opsForValue();
    ops.set(&quot;age&quot;, 41);
&#125;

@Test
void get() &#123;
    ValueOperations ops = redisTemplate.opsForValue();
    System.out.println(ops.get(&quot;age&quot;));
&#125;

@Test
void hset() &#123;
    HashOperations ops = redisTemplate.opsForHash();
    ops.put(&quot;info&quot;,&quot;a&quot;,&quot;aa&quot;);
&#125;

@Test
void hget() &#123;
    HashOperations ops = redisTemplate.opsForHash();
    System.out.println(ops.get(&quot;info&quot;, &quot;a&quot;));
&#125;
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">**小结：**</span><br><span class="line"></span><br><span class="line">* SpringBoot 整合 Redis</span><br><span class="line">  * 导入 redis 对应的 starter</span><br><span class="line">  * 配置</span><br><span class="line">  * 提供操作 Redis 接口对象 RedisTemplate</span><br><span class="line">    * ops*：获取各种数据类型操作接口</span><br><span class="line"></span><br><span class="line">##### SpringBoot 读写 Redis 客户端</span><br><span class="line"></span><br><span class="line">* 客户端：RedisTemplate 以对象作为 key 和 value，内部对数据进行序列化</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    @SpringBootTest</span><br><span class="line">    class Springboot16RedisApplicationTests &#123;</span><br><span class="line">    </span><br><span class="line">        @Autowired</span><br><span class="line">        private RedisTemplate redisTemplate;</span><br><span class="line">    </span><br><span class="line">        @Test</span><br><span class="line">        void set() &#123;</span><br><span class="line">            ValueOperations ops &#x3D; redisTemplate.opsForValue();</span><br><span class="line">            ops.set(&quot;age&quot;, 41);</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        @Test</span><br><span class="line">        void get() &#123;</span><br><span class="line">            ValueOperations ops &#x3D; redisTemplate.opsForValue();</span><br><span class="line">            System.out.println(ops.get(&quot;age&quot;));</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        @Test</span><br><span class="line">        void hset() &#123;</span><br><span class="line">            HashOperations ops &#x3D; redisTemplate.opsForHash();</span><br><span class="line">            ops.put(&quot;info&quot;,&quot;a&quot;,&quot;aa&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        @Test</span><br><span class="line">        void hget() &#123;</span><br><span class="line">            HashOperations ops &#x3D; redisTemplate.opsForHash();</span><br><span class="line">            System.out.println(ops.get(&quot;info&quot;, &quot;a&quot;));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>客户端：StringRedisTemplate（常用） 以字符串作为 key 和 value，与 Redis 客户端操作等效</p>
<ul>
<li>```java<br>package com.itheima;import org.junit.jupiter.api.Test;<br>import org.springframework.beans.factory.annotation.Autowired;<br>import org.springframework.boot.test.context.SpringBootTest;<br>import org.springframework.data.redis.core.RedisTemplate;<br>import org.springframework.data.redis.core.StringRedisTemplate;<br>import org.springframework.data.redis.core.ValueOperations;@SpringBootTest<br>public class StringRedisTemplateTest {<pre><code>private RedisTemplate redisTemplate;
@Autowired
private StringRedisTemplate stringRedisTemplate;

@Test
void get() &#123;
    ValueOperations&lt;String, String&gt; ops = stringRedisTemplate.opsForValue();
    System.out.println(ops.get(&quot;name&quot;));
&#125;
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### SpringBoot 操作 Redis 客户端实现技术切换</span><br><span class="line"></span><br><span class="line">* 配置客户端</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;yaml</span><br><span class="line">      spring:</span><br><span class="line">        redis:</span><br><span class="line">          host: localhost</span><br><span class="line">          port: 6379</span><br><span class="line">          client-type: jedis</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>lettcus 与 jedis 区别</p>
<ul>
<li>jedis 连接 Redis 服务器是直连模式，当多线程模式下使用 jedis 会存在线程安全问题，解决方案可以通过配置连接池使每个连接专用，但这样整体性能就大受影响</li>
<li>lettcus 基于 Netty 框架进行与 Redis 服务器连接，底层设计中采用 StatefulRedisConnection。StatefulRedisConnection 自身是线程安全的，可以保障并发访问安全问题，所以一个连接可以被多线程复用。当然 lettcus 也支持多连接实例一起工作</li>
</ul>
</li>
</ul>
<h4 id="Mongodb"><a href="#Mongodb" class="headerlink" title="Mongodb"></a>Mongodb</h4><ul>
<li>MongoDB 是一个开源、高性能、无模式的文档型数据库。NoSQL 数据库产品中的一种，是最像关系型数据库的非关系型数据库</li>
</ul>
<h5 id="用例"><a href="#用例" class="headerlink" title="用例"></a>用例</h5><ul>
<li>淘宝用户数据<ul>
<li>存储位置：数据库</li>
<li>特征：永久性存储，修改频率极低</li>
</ul>
</li>
<li>游戏装备数据、游戏道具数据<ul>
<li>存储位置：数据库、Mongodb</li>
<li>特征：永久性存储与临时存储相结合、修改频率较高</li>
</ul>
</li>
<li>直播数据、打赏数据、粉丝数据<ul>
<li>存储位置：数据库、Mongodb</li>
<li>特征：永久性存储与临时存储相结合、修改频率极高</li>
</ul>
</li>
<li>物联网数据<ul>
<li>存储位置：Mongodb</li>
<li>特征：临时存储、修改频率飞速</li>
</ul>
</li>
</ul>
<h5 id="Mongodb-下载"><a href="#Mongodb-下载" class="headerlink" title="Mongodb 下载"></a>Mongodb 下载</h5><ul>
<li><p>Windows 版 Mongodb 下载</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.mongodb.com/try/download">https://www.mongodb.com/try/download</a></li>
</ul>
</li>
<li><p>Windows 版 Mongodb 安装</p>
<ul>
<li>解压缩后设置数据目录</li>
</ul>
</li>
<li><p>Windows 版 Mongodb 启动</p>
<ul>
<li><p>服务器启动</p>
<ul>
<li>```cmd<br>mongod –dbpath=..\data\db<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 客户端启动</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;cmd</span><br><span class="line">    mongo --host&#x3D;127.0.0.1 --port&#x3D;27017</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li><p>Windows 版 Mongo 安装问题及解决方案</p>
<ul>
<li><p>”找不到 VCRUNTIME140_1.dll，无法继续执行代码，重新安装程序可能会解决此问题“</p>
<ul>
<li><p>步骤一：下载对应的 dll 文件（通过浏览器搜索即可）</p>
</li>
<li><p>步骤二：拷贝到 windows 安装路径下的 system32 目录中</p>
</li>
<li><p>步骤三：执行命令注册对应 dll 文件</p>
<ul>
<li>```cmd<br>regsvr32 vcruntime140_1.dll<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 可视化客户端——Robo 3T、Studio 3T</span><br><span class="line"></span><br><span class="line">##### 常用操作</span><br><span class="line"></span><br><span class="line">* 新增</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;mongo</span><br><span class="line">    db.集合名称.insert&#x2F;save&#x2F;insertOne(文档)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>修改</p>
<ul>
<li>```mongo<br>db.集合名称.update(条件, {操作种类: {文档})<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 删除</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;mongo</span><br><span class="line">    db.集合名称.remove(条件)</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>查询</p>
<ul>
<li>1.基础查询<ul>
<li>查询全部：db.集合.find()</li>
<li>查第一条：db.集合.findOne()</li>
<li>查询指定数量文档：db.集合.find().limit(10)    // 查 10 条文档</li>
<li>跳过指定数量文档：db.集合.find().skip(20)    // 跳过 20 条文档</li>
<li>统计：db.集合.count()                                      </li>
<li>排序：db.集合.sort({age:1})                             // 按 age 升序排序</li>
<li>投影：db.集合.sort.find(条件,{name:1,age:1}) // 仅保留 name 和 age 域</li>
</ul>
</li>
<li>2.条件查询<ul>
<li>基本格式：db.集合.find({条件})                      </li>
<li>模糊查询：db.集合.find({域名:/正则表达式/})   // 等同 SQL 中的 like，比 like 强大，可以执行正则所有规则</li>
<li>条件比较运算：db.集合.find({域名:{$gt:值}})    // 等同 SQL 中的数值比较操作，例如：name &gt; 18</li>
<li>包含查询：db.集合.find({域名:{$in:[值1, 值2]}})  // 等同于 SQL 中的 in</li>
<li>条件连接查询： db.集合.find({$and:[{条件1},{条件2}]})  // 等同于 SQL 中的 and、or </li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="SpringBoot-整合-Mongodb"><a href="#SpringBoot-整合-Mongodb" class="headerlink" title="SpringBoot 整合 Mongodb"></a>SpringBoot 整合 Mongodb</h5><ul>
<li><p>导入 对应坐标</p>
<ul>
<li>```xml<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-mongodb</artifactId>
</dependency>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 配置 mongodb 访问 uri</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;yaml</span><br><span class="line">    spring:</span><br><span class="line">      data:</span><br><span class="line">        mongodb:</span><br><span class="line">          uri: mongodb:&#x2F;&#x2F;localhost&#x2F;itheima</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>客户端读写 Mongodb</p>
<ul>
<li>```java<br>@SpringBootTest<br>class Springboot17MongodbApplicationTests {<pre><code>@Autowired
private MongoTemplate mongoTemplate;

@Test
void save() &#123;
    Book book = new Book();
    book.setId(2);
    book.setName(&quot;springboot&quot;);
    book.setType(&quot;springboot&quot;);
    book.setDescription(&quot;springboot&quot;);
    mongoTemplate.save(book);
&#125;

@Test
void find() &#123;
    List&lt;Book&gt; all = mongoTemplate.findAll(Book.class);
    System.out.println(all);
&#125;
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#### Elasticsearch(ES)</span><br><span class="line"></span><br><span class="line">* ES 是一个分布式全文搜索引擎</span><br><span class="line"></span><br><span class="line">##### ES 下载安装</span><br><span class="line"></span><br><span class="line">* Windows 版 ES 下载</span><br><span class="line">  * https:&#x2F;&#x2F;www.elastic.co&#x2F;cn&#x2F;downloads&#x2F;elasticsearch</span><br><span class="line">* 运行 elasticsearch.bat</span><br><span class="line"></span><br><span class="line">##### ES 使用</span><br><span class="line"></span><br><span class="line">* PUT		http:&#x2F;&#x2F;lcoalhost:9200&#x2F;books</span><br><span class="line">* GET        http:&#x2F;&#x2F;lcoalhost:9200&#x2F;books</span><br><span class="line">* DELETE  http:&#x2F;&#x2F;lcoalhost:9200&#x2F;books</span><br><span class="line"></span><br><span class="line">##### IK 分词器</span><br><span class="line"></span><br><span class="line">下载地址：https:&#x2F;&#x2F;github.com&#x2F;medcl&#x2F;elasticearch-analusis-ik&#x2F;releases</span><br><span class="line"></span><br><span class="line">版本跟 ES 版本同步</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">创建索引并指定规则</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;json</span><br><span class="line">&#123;</span><br><span class="line">    &quot;mapping&quot;: &#123;</span><br><span class="line">        &quot;properties&quot;: &#123;</span><br><span class="line">            &quot;id&quot;: &#123;</span><br><span class="line">                &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;name&quot;: &#123;</span><br><span class="line">                &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">                &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span><br><span class="line">                &quot;copy_to&quot;: &quot;all&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;type&quot;: &#123;</span><br><span class="line">                &quot;type&quot;: &quot;keyword&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;description&quot;: &#123;</span><br><span class="line">                &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">                &quot;analyzer&quot;: &quot;ik_max_word&quot;,</span><br><span class="line">                &quot;copy_to&quot;: &quot;all&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;all&quot;: &#123;</span><br><span class="line">                &quot;type&quot;: &quot;text&quot;,</span><br><span class="line">                &quot;analyzer&quot;: &quot;ik_max_word&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>创建文档</p>
<ul>
<li>POST        <a target="_blank" rel="noopener" href="http://localhost:9200/books/_doc">http://localhost:9200/books/_doc</a>            # 使用系统生成 id</li>
<li>POST        <a target="_blank" rel="noopener" href="http://localhost:9200/books/_create/1">http://localhost:9200/books/_create/1</a>   # 使用指定 id</li>
<li>POST        <a target="_blank" rel="noopener" href="http://localhost:9200/books/_doc/1">http://localhost:9200/books/_doc/1</a>        # 使用指定 id，不存在创建，存在更新（版本递增）</li>
</ul>
</li>
<li><p>查询文档</p>
<ul>
<li>GET          <a target="_blank" rel="noopener" href="http://localhost:9200/books/_doc/1">http://localhost:9200/books/_doc/1</a>         # 查询单个文档</li>
<li>GET          <a target="_blank" rel="noopener" href="http://localhost:9200/books/_search">http://localhost:9200/books/_search</a>       # 查询全部文档</li>
</ul>
</li>
<li><p>条件查询</p>
<ul>
<li>GET          <a target="_blank" rel="noopener" href="http://localhost:9200/books/_search?q=name:springboot">http://localhost:9200/books/_search?q=name:springboot</a></li>
</ul>
</li>
<li><p>删除文档</p>
<ul>
<li>DELETE   <a target="_blank" rel="noopener" href="http://localhost:9200/books/_doc/1">http://localhost:9200/books/_doc/1</a></li>
</ul>
</li>
<li><p>修改文档（全量修改）</p>
<ul>
<li>PUT         <a target="_blank" rel="noopener" href="http://localhost:9200/books/_doc/1">http://localhost:9200/books/_doc/1</a></li>
</ul>
</li>
<li><p>修改文档（部分修改）</p>
<ul>
<li>POST       <a target="_blank" rel="noopener" href="http://localhost:9200/books/_update/1">http://localhost:9200/books/_update/1</a></li>
</ul>
</li>
</ul>
<h5 id="springboot-整合-es"><a href="#springboot-整合-es" class="headerlink" title="springboot 整合 es"></a>springboot 整合 es</h5><ul>
<li><p>导入坐标</p>
<ul>
<li>```xml<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-elasticsearch</artifactId>
</dependency>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 配置</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;yaml</span><br><span class="line">    spring:</span><br><span class="line">      elasticsearch:</span><br><span class="line">        rest:</span><br><span class="line">          uris: http:&#x2F;&#x2F;localhost:9200</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>客户端</p>
<ul>
<li>```java<br>@Autowired<br>private ElasticsearchRestTemplate template;<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### springboot 整合 high level es</span><br><span class="line"></span><br><span class="line">* springboot 平台并没有跟随 ES 的更新进行同步更新，ES 提供了 High Level Client 操作 ES</span><br><span class="line"></span><br><span class="line">* 导入坐标</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;xml</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.elasticsearch.client&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;elasticsearch-rest-high-level-client&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>配置（无）</p>
</li>
<li><p>客户端</p>
<ul>
<li>```java<br>package com.itheima;import com.itheima.dao.BookDao;<br>import org.apache.http.HttpHost;<br>import org.elasticsearch.action.admin.indices.create.CreateIndexRequest;<br>import org.elasticsearch.client.RequestOptions;<br>import org.elasticsearch.client.RestClient;<br>import org.elasticsearch.client.RestClientBuilder;<br>import org.elasticsearch.client.RestHighLevelClient;<br>import org.junit.jupiter.api.AfterEach;<br>import org.junit.jupiter.api.BeforeEach;<br>import org.junit.jupiter.api.Test;<br>import org.springframework.beans.factory.annotation.Autowired;<br>import org.springframework.boot.test.context.SpringBootTest;import java.io.IOException;@SpringBootTest<br>class Springboot18EsApplicationTests {<pre><code>@Autowired
private RestHighLevelClient client;


@Test
void testCreateIndex() throws IOException &#123;
    HttpHost host = HttpHost.create(&quot;http://localhost:9200&quot;);
    RestClientBuilder builder = RestClient.builder(host);
    client = new RestHighLevelClient(builder);

    CreateIndexRequest request = new CreateIndexRequest(&quot;books&quot;);
    client.indices().create(request, RequestOptions.DEFAULT);

    client.close();
&#125;
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 客户端简化</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    @BeforeEach</span><br><span class="line">    void setUp() &#123;</span><br><span class="line">        HttpHost host &#x3D; HttpHost.create(&quot;http:&#x2F;&#x2F;localhost:9200&quot;);</span><br><span class="line">        RestClientBuilder builder &#x3D; RestClient.builder(host);</span><br><span class="line">        client &#x3D; new RestHighLevelClient(builder);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @AfterEach</span><br><span class="line">    void tearDown() throws IOException &#123;</span><br><span class="line">        client.close();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @Test</span><br><span class="line">    void testCreateIndex() throws IOException &#123;</span><br><span class="line">        CreateIndexRequest request &#x3D; new CreateIndexRequest(&quot;books&quot;);</span><br><span class="line">        client.indices().create(request, RequestOptions.DEFAULT);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>创建索引</p>
<ul>
<li>```java<br>@Test<br>void testCreateIndexByIK() throws IOException {<pre><code>// 客户端操作
CreateIndexRequest request = new CreateIndexRequest(&quot;books&quot;);
// 设置要执行的操作
String json = &quot;&#123;\n&quot; +
    &quot;    \&quot;mapping\&quot;: &#123;\n&quot; +
    &quot;        \&quot;properties\&quot;: &#123;\n&quot; +
    &quot;            \&quot;id\&quot;: &#123;\n&quot; +
    &quot;                \&quot;type\&quot;: \&quot;keyword\&quot;\n&quot; +
    &quot;            &#125;,\n&quot; +
    &quot;            \&quot;name\&quot;: &#123;\n&quot; +
    &quot;                \&quot;type\&quot;: \&quot;text\&quot;,\n&quot; +
    &quot;                \&quot;analyzer\&quot;: \&quot;ik_max_word\&quot;,\n&quot; +
    &quot;                \&quot;copy_to\&quot;: \&quot;all\&quot;\n&quot; +
    &quot;            &#125;,\n&quot; +
    &quot;            \&quot;type\&quot;: &#123;\n&quot; +
    &quot;                \&quot;type\&quot;: \&quot;keyword\&quot;\n&quot; +
    &quot;            &#125;,\n&quot; +
    &quot;            \&quot;description\&quot;: &#123;\n&quot; +
    &quot;                \&quot;type\&quot;: \&quot;text\&quot;,\n&quot; +
    &quot;                \&quot;analyzer\&quot;: \&quot;ik_max_word\&quot;,\n&quot; +
    &quot;                \&quot;copy_to\&quot;: \&quot;all\&quot;\n&quot; +
    &quot;            &#125;,\n&quot; +
    &quot;            \&quot;all\&quot;: &#123;\n&quot; +
    &quot;                \&quot;type\&quot;: \&quot;text\&quot;,\n&quot; +
    &quot;                \&quot;analyzer\&quot;: \&quot;ik_max_word\&quot;\n&quot; +
    &quot;            &#125;\n&quot; +
    &quot;        &#125;\n&quot; +
    &quot;    &#125;\n&quot; +
    &quot;&#125;&quot;;
//        设置请求中的参数，参数类型为 JSON
request.source(json, XContentType.JSON);
client.indices().create(request, RequestOptions.DEFAULT);
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 添加文档</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    &#x2F;&#x2F;    添加文档</span><br><span class="line">    @Test</span><br><span class="line">    void testCreateDoc() throws IOException &#123;</span><br><span class="line">        Book book &#x3D; bookDao.selectById(1);</span><br><span class="line">    </span><br><span class="line">        IndexRequest request &#x3D; new IndexRequest(&quot;books&quot;).id(book.getId().toString());</span><br><span class="line">        String json &#x3D; JSON.toJSONString(book);</span><br><span class="line">    </span><br><span class="line">        request.source(json, XContentType.JSON);</span><br><span class="line">        client.index(request, RequestOptions.DEFAULT);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>批量添加文档</p>
<ul>
<li>```java<br>//    批量添加文档<br>@Test<br>void testCreateDoc() throws IOException {<pre><code>List&lt;Book&gt; bookList = bookDao.selectList(null);

BulkRequest bulk = new BulkRequest();

for (Book book : bookList) &#123;
    IndexRequest request = new IndexRequest(&quot;books&quot;).id(book.getId().toString());
    String json = JSON.toJSONString(book);

    request.source(json, XContentType.JSON);

    bulk.add(request);
&#125;

client.bulk(bulk, RequestOptions.DEFAULT);
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 按 id 查询</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    &#x2F;&#x2F;    按 id 查询</span><br><span class="line">    @Test</span><br><span class="line">    void testGet() throws IOException &#123;</span><br><span class="line">        GetRequest request &#x3D; new GetRequest(&quot;books&quot;,&quot;1&quot;);</span><br><span class="line">        GetResponse response &#x3D; client.get(request, RequestOptions.DEFAULT);</span><br><span class="line">        String json &#x3D; response.getSourceAsString();</span><br><span class="line">        System.out.println(json);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>按条件查询文档</p>
<ul>
<li>```java<br>//    按条件查询<br>@Test<br>void testSearch() throws IOException {<pre><code>SearchRequest request = new SearchRequest(&quot;books&quot;);

SearchSourceBuilder builder = new SearchSourceBuilder();
builder.query(QueryBuilders.termQuery(&quot;name&quot;,&quot;springboot&quot;));
request.source(builder);

SearchResponse response = client.search(request, RequestOptions.DEFAULT);
SearchHits hits = response.getHits();
for (SearchHit hit : hits) &#123;
    System.out.println(hit.getSourceAsString());
&#125;
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">## 整合第三方技术</span><br><span class="line"></span><br><span class="line">### 缓存</span><br><span class="line"></span><br><span class="line">* 缓存是一种介于数据永久存储介质与数据应用之间的数据临时存储介质</span><br><span class="line">* 使用缓存可以有效的减少低速数据读取过程的次数（例如磁盘 IO），提高系统性能</span><br><span class="line">* 缓存不仅可以用于提高永久性存储介质的数据读取效率，还可以提供临时的数据存储空间</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">* SpringBoot 提供了缓存技术，方便缓存使用</span><br><span class="line"></span><br><span class="line">#### 缓存的使用</span><br><span class="line"></span><br><span class="line">* 启用缓存</span><br><span class="line">* 设置进入缓存的数据</span><br><span class="line">* 设置读取缓存的数据</span><br><span class="line"></span><br><span class="line">##### 缓存使用的具体步骤</span><br><span class="line"></span><br><span class="line">* 1.导入缓存技术对应的 starter</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;xml</span><br><span class="line">    &lt;!--   cache   --&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-cache&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>2.启用缓存</p>
<ul>
<li>```java<br>// main.java<br>@SpringBootApplication<br>// 开启缓存功能<br>@EnableCaching<br>public class Springboot19CacheApplication {<pre><code>public static void main(String[] args) &#123;
    SpringApplication.run(Springboot19CacheApplication.class, args);
&#125;
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 3.设置当前操作的结果数据进入缓存</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    @Override</span><br><span class="line">    @Cacheable(value &#x3D; &quot;cacheSpace&quot;, key &#x3D; &quot;#id&quot;)</span><br><span class="line">    public Book getById(Integer id) &#123;</span><br><span class="line">    </span><br><span class="line">        return bookDao.selectById(id);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>SpringBoot 提供的缓存技术除了提供默认的缓存方案，还可以对其他缓存技术进行整合，统一接口，方便缓存技术的开发与管理<ul>
<li>Generic</li>
<li>JCache</li>
<li>Ehcache</li>
<li>Hazelcast</li>
<li>Infinispan</li>
<li>Couchbase</li>
<li>Redis</li>
<li>Caffenine</li>
<li>Simple（默认）</li>
<li>memcached</li>
</ul>
</li>
</ul>
<h5 id="缓存使用案例——手机验证码"><a href="#缓存使用案例——手机验证码" class="headerlink" title="缓存使用案例——手机验证码"></a>缓存使用案例——手机验证码</h5><ul>
<li>需求<ul>
<li>输入手机号获取验证码，组织文档以短信形式发送给用户（页面模拟）</li>
<li>输入手机号和验证码验证结果</li>
</ul>
</li>
<li>需求分析<ul>
<li>提供 controller，传入手机号，业务层通过手机号计算出独有的 6 位验证码数据，存储缓存后返回此数据</li>
<li>提供 controller，传入手机号和验证码，业务层通过手机号从缓存中读取验证码与输入验证码进行比对，返回比对结果</li>
</ul>
</li>
</ul>
<h5 id="缓存供应商变更：Ehcache"><a href="#缓存供应商变更：Ehcache" class="headerlink" title="缓存供应商变更：Ehcache"></a>缓存供应商变更：Ehcache</h5><ul>
<li><p>加入 Ehcache 坐标（缓存供应商实现）</p>
<ul>
<li>```xml<dependency>
    <groupId>net.sf.ehcache</groupId>
    <artifactId>ehcache</artifactId>
</dependency>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 缓存设定为使用 Ehcache </span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;yaml</span><br><span class="line">    spring: </span><br><span class="line">      cache:</span><br><span class="line">        type: ehcache</span><br><span class="line">        ehcache:</span><br><span class="line">          config: classpath:ehcache.xml</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>提供 ehcache 配置文件 ehcache.xml</p>
<ul>
<li>```xml<?xml version="1.0" encoding="UTF-8"?>
&lt;ehcache xmlns:xsi=”<a target="_blank" rel="noopener" href="http://www.w3.org/2001/XMLSchema-instance&quot;">http://www.w3.org/2001/XMLSchema-instance&quot;</a><pre><code>   xsi:noNamespaceSchemaLocation=&quot;http://ehcache.org/ehcache.xsd&quot;
    updateCheck=&quot;false&quot;&gt;
&lt;diskStore path=&quot;D:\ehcache&quot; /&gt;

&lt;!-- eternal：是否永久存在，设置为 true 则不会被清除，此时与 timeout 冲突，通常设置为 false --&gt;
&lt;!-- diskPersistent：是否启用磁盘持久化   --&gt;
&lt;!-- maxElementsInMemory：最大缓存数量   --&gt;
&lt;!-- overflowToDisk：超过最大缓存数量是否继续持久化到磁盘   --&gt;
&lt;!-- timeToIdleSeconds：最大活动间隔，设置过长缓存容易溢出，设置过短无效果，可用于记录时效性数据，例如验证码   --&gt;
&lt;!-- timeToLiveSeconds：最大存活时间   --&gt;
&lt;!-- memoryStoreEvictionPolicy：缓存清理策略   --&gt;

&lt;defaultCache
        eternal=&quot;false&quot;
        diskPersistent=&quot;false&quot;
        maxElementsInMemory=&quot;1000&quot;
        overflowToDisk=&quot;false&quot;
        timeToIdleSeconds=&quot;60&quot;
        timeToLiveSeconds=&quot;60&quot;
        memoryStoreEvictionPolicy=&quot;LRU&quot;
&gt;&lt;/defaultCache&gt;

&lt;cache
        name=&quot;smsCode&quot;
        eternal=&quot;false&quot;
        diskPersistent=&quot;false&quot;
        maxElementsInMemory=&quot;1000&quot;
        overflowToDisk=&quot;false&quot;
        timeToIdleSeconds=&quot;60&quot;
        timeToLiveSeconds=&quot;60&quot;
        memoryStoreEvictionPolicy=&quot;LRU&quot;
&gt;&lt;/cache&gt;
</code></pre>
</ehcache>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### 缓存供应商变更：Redis</span><br><span class="line"></span><br><span class="line">* 导坐标</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;xml</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-data-redis&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>设置 Redis 相关配置</p>
<ul>
<li>```yaml<br>spring:<br>  cache:<pre><code>type: redis
redis:
  use-key-prefix: true      # 是否使用前缀名（系统定义前缀名）
  cache-null-values: false  # 追加自定义前缀名
  key-prefix: aa            # 有效时长     
  time-to-live: 10          # 是否允许存储空值
</code></pre>
  redis:<pre><code>host: localhost
port: 6379
</code></pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### 缓存供应商变更：memcached</span><br><span class="line"></span><br><span class="line">* 下载 memcached</span><br><span class="line">  * 地址：https:&#x2F;&#x2F;&#x2F;www.runoob.com&#x2F;memcached&#x2F;window-install-memcached.html</span><br><span class="line">* 安装 memcached</span><br><span class="line">  * 使用管理员身份运行 cmd 指令</span><br><span class="line">  * 安装：memcached.exe -d install</span><br><span class="line">* 运行 memcached</span><br><span class="line">  * 启动服务：memcached.exe -d start</span><br><span class="line">  * 停止服务：memcached.exe -d stop</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">* memcached 客户端选择</span><br><span class="line">  * Memcached Client for Java：最早期客户端，稳定可靠，用户群广</span><br><span class="line">  * SpyMemcached：效率更高</span><br><span class="line">  * Xmemcached：并发处理更好</span><br><span class="line">* SpringBoot 未提供对 memcached 的整合，需要使用硬编码方式实现客户端初始化管理</span><br><span class="line"></span><br><span class="line">###### 具体步骤</span><br><span class="line"></span><br><span class="line">* 加入 Xmemcache 坐标（缓存供应商实现）</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;xml</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;com.googlecode.xmemcached&lt;&#x2F;groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;xmemcached&lt;&#x2F;artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.4.7&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>配置 memcached 服务器必要属性</p>
<ul>
<li>```yaml<br>memcached:<h1 id="memcached-服务器地址"><a href="#memcached-服务器地址" class="headerlink" title="memcached 服务器地址"></a>memcached 服务器地址</h1>  servers: localhost:11211<h1 id="连接池的数量"><a href="#连接池的数量" class="headerlink" title="连接池的数量"></a>连接池的数量</h1>  poolSize: 10<h1 id="设置默认操作超时时间"><a href="#设置默认操作超时时间" class="headerlink" title="设置默认操作超时时间"></a>设置默认操作超时时间</h1>  opTimeout: 3000<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 创建读取属性配置信息类，加载配置</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    @Component</span><br><span class="line">    @ConfigurationProperties(prefix &#x3D; &quot;memcached&quot;)</span><br><span class="line">    @Data</span><br><span class="line">    public class XMemcachedProperties &#123;</span><br><span class="line">        private String servers;</span><br><span class="line">        private int poolSize;</span><br><span class="line">        private long opTimeout;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>创建客户端配置类</p>
<ul>
<li>```java<br>@Configuration<br>public class XMemcachedConfig {<pre><code>@Autowired
private XMemcachedProperties xMemcachedProperties;

@Bean
public MemcachedClient getMemcachedClient() throws IOException &#123;
    MemcachedClientBuilder memcachedClientBuilder = new XMemcachedClientBuilder(xMemcachedProperties.getServers());
    memcachedClientBuilder.setConnectionPoolSize(xMemcachedProperties.getPoolSize());
    memcachedClientBuilder.setOpTimeout(xMemcachedProperties.getOpTimeout());
    MemcachedClient memcachedClient = memcachedClientBuilder.build();
    return memcachedClient;
&#125;
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 配置 memcached 属性</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    package com.itheima.service.impl;</span><br><span class="line">    </span><br><span class="line">    import com.itheima.domain.SMSCode;</span><br><span class="line">    import com.itheima.service.SMSCodeService;</span><br><span class="line">    import com.itheima.utils.CodeUtils;</span><br><span class="line">    import net.rubyeye.xmemcached.MemcachedClient;</span><br><span class="line">    import net.rubyeye.xmemcached.exception.MemcachedException;</span><br><span class="line">    import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">    import org.springframework.cache.annotation.CachePut;</span><br><span class="line">    import org.springframework.cache.annotation.Cacheable;</span><br><span class="line">    import org.springframework.stereotype.Service;</span><br><span class="line">    </span><br><span class="line">    import java.util.concurrent.TimeoutException;</span><br><span class="line">    </span><br><span class="line">    @Service</span><br><span class="line">    public class SMSCodeServiceImpl implements SMSCodeService &#123;</span><br><span class="line">    </span><br><span class="line">        @Autowired</span><br><span class="line">        private CodeUtils codeUtils;</span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F;    以下是 springboot 中使用 xmemcached</span><br><span class="line">    </span><br><span class="line">        @Autowired</span><br><span class="line">        private MemcachedClient memcachedClient;</span><br><span class="line">    </span><br><span class="line">        @Override</span><br><span class="line">        public String sendCodeToSMS(String tele) &#123;</span><br><span class="line">            String code &#x3D; codeUtils.generator(tele);</span><br><span class="line">            try &#123;</span><br><span class="line">                memcachedClient.set(tele, 0, code);</span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            return code;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        @Override</span><br><span class="line">        public boolean checkCode(SMSCode smsCode) &#123;</span><br><span class="line">            String code &#x3D; null;</span><br><span class="line">            try &#123;</span><br><span class="line">                code &#x3D; memcachedClient.get(smsCode.getTele()).toString();</span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            return smsCode.getCode().equals(code);</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="缓存供应商变更：jetcache"><a href="#缓存供应商变更：jetcache" class="headerlink" title="缓存供应商变更：jetcache"></a>缓存供应商变更：jetcache</h4><ul>
<li>jetcache 对 SpringCache 进行了封装，在原有功能基础上实现了多级缓存、缓存统计、自动刷新、异步调用、数据报表等功能</li>
<li>jetcache 设定了本地缓存与远程缓存的多级缓存解决方案<ul>
<li>本地缓存（local）<ul>
<li>LinkedHashMap</li>
<li>Caffine</li>
</ul>
</li>
<li>远程缓存（remote）<ul>
<li>Redis</li>
<li>Tair</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h5 id="具体步骤"><a href="#具体步骤" class="headerlink" title="具体步骤"></a>具体步骤</h5><ul>
<li><p>加入 jetcache 坐标</p>
<ul>
<li>```xml<dependency>
    <groupId>com.alicp.jetcache</groupId>
    <artifactId>jetcache-starter-redis</artifactId>
    <version>2.6.7</version>
</dependency>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 配置远程缓存必要属性</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;yaml</span><br><span class="line">    jetcache:</span><br><span class="line">      # 本地方案</span><br><span class="line">      local:</span><br><span class="line">        default:</span><br><span class="line">          type: linkedhashmap</span><br><span class="line">          keyConvertor: fastjson</span><br><span class="line">      # 远程方案</span><br><span class="line">      remote:</span><br><span class="line">        default:</span><br><span class="line">          type: redis</span><br><span class="line">          host: localhost</span><br><span class="line">          port: 6379</span><br><span class="line">          poolConfig:</span><br><span class="line">            maxTotal: 50</span><br><span class="line">        sms:</span><br><span class="line">          type: redis</span><br><span class="line">          host: localhost</span><br><span class="line">          port: 6379</span><br><span class="line">          poolConfig:</span><br><span class="line">            maxTotal: 50</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>配置属性说明</p>
<ul>
<li><img src="C:\Users\15135\AppData\Roaming\Typora\typora-user-images\image-20220804171947266.png" alt="image-20220804171947266"></li>
</ul>
</li>
<li><p>开启 jetcache 注解支持</p>
<ul>
<li>```java<br>@SpringBootApplication<br>// jetcache 启用缓存的主开关<br>@EnableCreateCacheAnnotation<br>public class Springboot20JetcacheApplication {<pre><code>public static void main(String[] args) &#123;
    SpringApplication.run(Springboot20JetcacheApplication.class, args);
&#125;
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 声明缓存对象</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    @Service</span><br><span class="line">    public class SMSCodeServiceImpl implements SMSCodeService &#123;</span><br><span class="line">    </span><br><span class="line">        @Autowired</span><br><span class="line">        private CodeUtils codeUtils;</span><br><span class="line">    </span><br><span class="line">        @CreateCache(name &#x3D; &quot;jetCache&quot;, expire &#x3D; 3600, timeUnit &#x3D; TimeUnit.SECONDS, cacheType &#x3D; CacheType.LOCAL)</span><br><span class="line">        private Cache&lt;String, String&gt; jetCache;</span><br><span class="line">    </span><br><span class="line">        @CreateCache(area &#x3D; &quot;sms&quot;, name &#x3D; &quot;jetCache&quot;, expire &#x3D; 3600, timeUnit &#x3D; TimeUnit.SECONDS)</span><br><span class="line">        private Cache&lt;String, String&gt; jetCache2;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>操作缓存</p>
<ul>
<li>```java<br>package com.itheima.service.impl;import com.alicp.jetcache.Cache;<br>import com.alicp.jetcache.anno.CacheType;<br>import com.alicp.jetcache.anno.CreateCache;<br>import com.itheima.domain.SMSCode;<br>import com.itheima.service.SMSCodeService;<br>import com.itheima.utils.CodeUtils;<br>import org.springframework.beans.factory.annotation.Autowired;<br>import org.springframework.stereotype.Service;import java.util.concurrent.TimeUnit;@Service<br>public class SMSCodeServiceImpl implements SMSCodeService {<pre><code>@Autowired
private CodeUtils codeUtils;

@CreateCache(name = &quot;jetCache&quot;, expire = 3600, timeUnit = TimeUnit.SECONDS, cacheType = CacheType.LOCAL)
private Cache&lt;String, String&gt; jetCache;

@CreateCache(area = &quot;sms&quot;, name = &quot;jetCache&quot;, expire = 3600, timeUnit = TimeUnit.SECONDS)
private Cache&lt;String, String&gt; jetCache2;

@Override
public String sendCodeToSMS(String tele) &#123;
    String code = codeUtils.generator(tele);
    jetCache.put(tele, code);
    return code;
&#125;

@Override
public boolean checkCode(SMSCode smsCode) &#123;
    String code = jetCache.get(smsCode.getTele());
    return smsCode.getCode().equals(code);
&#125;
</code></pre>
}<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">##### 启用方法注解</span><br><span class="line"></span><br><span class="line">* 启用方法注解</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    @SpringBootApplication</span><br><span class="line">    &#x2F;&#x2F; jetcache 启用缓存的主开关</span><br><span class="line">    @EnableCreateCacheAnnotation</span><br><span class="line">    &#x2F;&#x2F; 开启方法注解缓存</span><br><span class="line">    @EnableMethodCache(basePackages &#x3D; &quot;com.itheima&quot;)</span><br><span class="line">    public class Springboot20JetcacheApplication &#123;</span><br><span class="line">    </span><br><span class="line">        public static void main(String[] args) &#123;</span><br><span class="line">            SpringApplication.run(Springboot20JetcacheApplication.class, args);</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>使用方法注解操作缓存</p>
<ul>
<li><p>```java<br>@Service<br>public class BookServiceImpl implements BookService {</p>
<pre><code>@Autowired
private BookDao bookDao;

@Override
@Cached(name = &quot;book_&quot;, key = &quot;#id&quot;, expire = 3600, cacheType = CacheType.LOCAL)
</code></pre>
<p>//    @CacheRefresh(refresh = 10)</p>
<pre><code>public Book getById(Integer id) &#123;

    return bookDao.selectById(id);
&#125;

    @Override
@CacheUpdate(name = &quot;book_&quot;, key = &quot;#book.id&quot;, value = &quot;#book&quot;)
public boolean update(Book book) &#123;
    return bookDao.updateById(book) &gt; 0;
&#125;

@Override
@CacheInvalidate(name = &quot;book_&quot;, key = &quot;#id&quot;)
public boolean delete(Integer id) &#123;
    return bookDao.deleteById(id) &gt; 0;
&#125;
</code></pre>
<p>}</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 缓存对象必须保障可序列化</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    &#x2F;&#x2F; lombok</span><br><span class="line">    @Data</span><br><span class="line">    @NoArgsConstructor</span><br><span class="line">    @AllArgsConstructor</span><br><span class="line">    public class Book implements Serializable &#123;</span><br><span class="line">        private Integer id;</span><br><span class="line">        private String type;</span><br><span class="line">        private String name;</span><br><span class="line">        private String description;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li>
<li><p>```yaml</p>
<h1 id="application-yml-3"><a href="#application-yml-3" class="headerlink" title="application.yml"></a>application.yml</h1><p>mybatis-plus:<br>  global-config:</p>
<pre><code>db-config:
  table-prefix: tb_
  id-type: auto
</code></pre>
<p>  configuration:</p>
<pre><code>log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
</code></pre>
<h1 id=""><a href="#" class="headerlink" title=""></a></h1><p>spring:<br>  datasource:</p>
<pre><code>druid:
  driver-class-name: com.mysql.cj.jdbc.Driver
  url: jdbc:mysql://localhost:3306/ssm_db?serverTimezone=GMT
  username: root
  password: zt20020806
</code></pre>
<p>jetcache:<br>  remote:</p>
<pre><code>default:
  type: redis
  keyConvertor: fastjson
  valueEcode: java
  valueDcode: java
</code></pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 查看缓存统计报告</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    jetcache:</span><br><span class="line">      statIntervalMinutes: 1</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="缓存供应商变更：j2cache"><a href="#缓存供应商变更：j2cache" class="headerlink" title="缓存供应商变更：j2cache"></a>缓存供应商变更：j2cache</h4><ul>
<li>j2cache 是一个缓存整合框架，可以提供缓存的整合方案，使各种缓存搭配使用，自身不提供缓存功能</li>
<li>基于 ehcache + redis 进行整合</li>
</ul>
<hr>
<h5 id="具体步骤-1"><a href="#具体步骤-1" class="headerlink" title="具体步骤"></a>具体步骤</h5><ul>
<li><p>加入 j2cache 坐标，加入整合缓存的坐标</p>
<ul>
<li>```java<dependency>
    <groupId>net.sf.ehcache</groupId>
    <artifactId>ehcache</artifactId>
    </dependency>

<pre><code>&lt;!-- https://mvnrepository.com/artifact/net.oschina.j2cache/j2cache-spring-boot2-starter --&gt;
</code></pre>
<dependency>
    <groupId>net.oschina.j2cache</groupId>
    <artifactId>j2cache-spring-boot2-starter</artifactId>
    <version>2.8.0-release</version>
    </dependency>

<pre><code>&lt;!-- https://mvnrepository.com/artifact/net.oschina.j2cache/j2cache-core --&gt;
</code></pre>
<dependency>
    <groupId>net.oschina.j2cache</groupId>
    <artifactId>j2cache-core</artifactId>
    <version>2.8.4-release</version>
    <exclusions>
    <exclusion>
    <groupId>org.slf4j</groupId>
    <artifactId>slf4j-simple</artifactId>
    </exclusion>
    </exclusions>
    </dependency>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 配置使用 j2cache（application.yml）</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;yaml</span><br><span class="line">    server:</span><br><span class="line">      port: 8080</span><br><span class="line">    j2cache:</span><br><span class="line">      config-location: j2cache.properties</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>配置一级缓存与二级缓存以及一级缓存数据到二级缓存的发送方式（j2cache.properties）</p>
<ul>
<li>```properties<h1 id="1-级缓存"><a href="#1-级缓存" class="headerlink" title="1 级缓存"></a>1 级缓存</h1>j2cache.L1.provider_class = ehcache<br>ehcache.configXml = ehcache.xml<h1 id="设置是否启用二级缓存"><a href="#设置是否启用二级缓存" class="headerlink" title="设置是否启用二级缓存"></a>设置是否启用二级缓存</h1>j2cache.l2-cache-open = false<h1 id="2-级缓存"><a href="#2-级缓存" class="headerlink" title="2 级缓存"></a>2 级缓存</h1>j2cache.L2.provider_class = net.oschina.j2cache.cache.support.redis.SpringRedisProvider<br>j2cache.L2.config_section = redis<br>redis.host = localhost:6379<h1 id="1-级缓存中的数据如何到达二级缓存"><a href="#1-级缓存中的数据如何到达二级缓存" class="headerlink" title="1 级缓存中的数据如何到达二级缓存"></a>1 级缓存中的数据如何到达二级缓存</h1><h1 id="可以使用-redis-提供的消息订阅模式，也可以使用-jgroups-多播实现"><a href="#可以使用-redis-提供的消息订阅模式，也可以使用-jgroups-多播实现" class="headerlink" title="可以使用 redis 提供的消息订阅模式，也可以使用 jgroups 多播实现"></a>可以使用 redis 提供的消息订阅模式，也可以使用 jgroups 多播实现</h1>j2cache.broadcast = net.oschina.j2cache.cache.support.redis.SpringRedisPubSubPolicyredis.mode = single<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">* 设置使用缓存</span><br><span class="line"></span><br><span class="line">  * &#96;&#96;&#96;java</span><br><span class="line">    @Service</span><br><span class="line">    public class SMSCodeServiceImpl implements SMSCodeService &#123;</span><br><span class="line">    </span><br><span class="line">        @Autowired</span><br><span class="line">        private CodeUtils codeUtils;</span><br><span class="line">    </span><br><span class="line">        @Autowired</span><br><span class="line">        private CacheChannel cacheChannel;</span><br><span class="line">    </span><br><span class="line">        @Override</span><br><span class="line">        public String sendCodeToSMS(String tele) &#123;</span><br><span class="line">            String code &#x3D; codeUtils.generator(tele);</span><br><span class="line">            cacheChannel.set(&quot;sms&quot;, tele, code);</span><br><span class="line">            return code;</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        @Override</span><br><span class="line">        public boolean checkCode(SMSCode smsCode) &#123;</span><br><span class="line">            String code &#x3D; cacheChannel.get(&quot;sms&quot;,smsCode.getTele()).asString();</span><br><span class="line">            return smsCode.getCode().equals(code);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="数据淘汰策略"><a href="#数据淘汰策略" class="headerlink" title="数据淘汰策略"></a>数据淘汰策略</h4><h5 id="影响数据淘汰的相关配置"><a href="#影响数据淘汰的相关配置" class="headerlink" title="影响数据淘汰的相关配置"></a>影响数据淘汰的相关配置</h5><ul>
<li>检测易失数据（可能会过期的数据集 server.db[i].expires）<ul>
<li>1.volatile-lru：挑选最近使用时间最少的数据淘汰</li>
<li>2.volatile-lfu：挑选最近使用次数最少的数据淘汰</li>
<li>3.volatile-ttl：挑选将要过期的数据淘汰</li>
<li>4.volatile-random：任意选择数据淘汰</li>
</ul>
</li>
</ul>
<h3 id="任务"><a href="#任务" class="headerlink" title="任务"></a>任务</h3><ul>
<li>定时任务是企业级应用中的常见操作<ul>
<li>年度报表</li>
<li>缓存统计报告</li>
<li>……</li>
</ul>
</li>
<li>市面上流行的定时任务技术<ul>
<li>Quartz</li>
<li>Spring Task</li>
</ul>
</li>
<li>相关概念<ul>
<li>工作（Job）：用于定义具体执行的工作</li>
<li>工作明细（JobDetail）：用于描述定时工作相关的信息</li>
<li>触发器（Trigger）：用于描述触发工作的规则，通常使用 cron 表达式定义调度规则</li>
<li>调度器（Scheduler）：描述了工作明细与触发器的对应关系</li>
</ul>
</li>
</ul>
<h4 id="SpringBoot-整合-Quartz"><a href="#SpringBoot-整合-Quartz" class="headerlink" title="SpringBoot 整合 Quartz"></a>SpringBoot 整合 Quartz</h4><ul>
<li>导入 SpringBoot 整合 quartz 的坐标</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-quartz<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>定义具体要执行的任务，继承 QuartzJobBean</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyQuartz</span> <span class="keyword">extends</span> <span class="title">QuartzJobBean</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">executeInternal</span><span class="params">(JobExecutionContext context)</span> <span class="keyword">throws</span> JobExecutionException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;quartz task run ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>定义工作明细与触发器，并绑定对应关系</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">QuartzConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JobDetail <span class="title">printJobDetail</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//        绑定具体的工作</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> JobBuilder.newJob(MyQuartz.class).storeDurably().build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Trigger <span class="title">printTrigger</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//        绑定具体的工作明细</span></span><br><span class="line">        ScheduleBuilder scheduleBuilder = CronScheduleBuilder.cronSchedule(<span class="string">&quot;0/5 * * * * ?&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> TriggerBuilder.newTrigger().forJob(printJobDetail()).withSchedule(scheduleBuilder).build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Spring-Task"><a href="#Spring-Task" class="headerlink" title="Spring Task"></a>Spring Task</h4><ul>
<li>开启定时器</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="comment">// 开启定时任务功能</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Springboot22TaskApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(Springboot22TaskApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>设置定时执行的任务，并设定执行周期</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0/1 * * * * ?&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;task running ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>定时任务相关配置</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span> </span><br><span class="line">  <span class="attr">task:</span> </span><br><span class="line">    <span class="attr">scheduling:</span> </span><br><span class="line">      <span class="comment"># 任务调度线程池大小 默认 1</span></span><br><span class="line">      <span class="attr">pool:</span> </span><br><span class="line">        <span class="attr">size:</span> <span class="number">1</span></span><br><span class="line">      <span class="comment"># 调度线程名称前缀 默认 scheduling-</span></span><br><span class="line">      <span class="attr">thread-name-prefix:</span> <span class="string">ssm_</span></span><br><span class="line">      <span class="attr">shutdown:</span> </span><br><span class="line">        <span class="comment"># 线程池关闭时等待所有任务完成</span></span><br><span class="line">        <span class="attr">await-termination:</span> <span class="literal">false</span></span><br><span class="line">        <span class="comment"># 调度线程关闭最大等待时间，确保最后一定关闭</span></span><br><span class="line">        <span class="attr">await-termination-period:</span> <span class="string">10s</span></span><br></pre></td></tr></table></figure>

<h3 id="邮件"><a href="#邮件" class="headerlink" title="邮件"></a>邮件</h3><ul>
<li>SMTP（Simple Mail Transfer Protocol）：简单邮件传输协议，用于发送电子邮件的传输协议</li>
<li>POP3（Post Office Protocol - Version 3）：用于接收电子邮件的标准协议</li>
<li>IMAP（Internet Mail Access Protocol）：互联网消息协议，是 POP3 的替代协议</li>
</ul>
<h4 id="Spring-Boot-整合-JavaMail"><a href="#Spring-Boot-整合-JavaMail" class="headerlink" title="Spring Boot 整合 JavaMail"></a>Spring Boot 整合 JavaMail</h4><ul>
<li>配置 JavaMail</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">mail:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">smtp.qq.com</span> <span class="comment"># smtp + xx.com</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">xxx@qq.com</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">ysbjqrserkiwfhfg</span> <span class="comment"># password 在对应邮箱设置 -&gt; 账户 获取</span></span><br></pre></td></tr></table></figure>

<ul>
<li>对应业务层</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.itheima.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.service.SendMailService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.mail.SimpleMailMessage;</span><br><span class="line"><span class="keyword">import</span> org.springframework.mail.javamail.JavaMailSender;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SendMailServiceImpl</span> <span class="keyword">implements</span> <span class="title">SendMailService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JavaMailSender javaMailSender;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    发送人</span></span><br><span class="line">    <span class="keyword">private</span> String from = <span class="string">&quot;xxx@qq.com&quot;</span>;</span><br><span class="line"><span class="comment">//    接收人</span></span><br><span class="line">    <span class="keyword">private</span> String to = <span class="string">&quot;xxx@qq.com&quot;</span>;</span><br><span class="line"><span class="comment">//    标题</span></span><br><span class="line">    <span class="keyword">private</span> String subject = <span class="string">&quot;测试邮件&quot;</span>;</span><br><span class="line"><span class="comment">//    正文</span></span><br><span class="line">    <span class="keyword">private</span> String context = <span class="string">&quot;测试邮件正文内容&quot;</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SimpleMailMessage message = <span class="keyword">new</span> SimpleMailMessage();</span><br><span class="line">        message.setFrom(from + <span class="string">&quot;(大甜甜)&quot;</span>);</span><br><span class="line">        message.setTo(to);</span><br><span class="line">        message.setSubject(subject);</span><br><span class="line">        message.setText(context);</span><br><span class="line">        javaMailSender.send(message);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>发送附件</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.itheima.service.SendMailService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.mail.SimpleMailMessage;</span><br><span class="line"><span class="keyword">import</span> org.springframework.mail.javamail.JavaMailSender;</span><br><span class="line"><span class="keyword">import</span> org.springframework.mail.javamail.MimeMessageHelper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.mail.MessagingException;</span><br><span class="line"><span class="keyword">import</span> javax.mail.internet.MimeMessage;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SendMailServiceImpl2</span> <span class="keyword">implements</span> <span class="title">SendMailService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JavaMailSender javaMailSender;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    发送人</span></span><br><span class="line">    <span class="keyword">private</span> String from = <span class="string">&quot;1513591616@qq.com&quot;</span>;</span><br><span class="line"><span class="comment">//    接收人</span></span><br><span class="line">    <span class="keyword">private</span> String to = <span class="string">&quot;2906050148@qq.com&quot;</span>;</span><br><span class="line"><span class="comment">//    标题</span></span><br><span class="line">    <span class="keyword">private</span> String subject = <span class="string">&quot;测试邮件&quot;</span>;</span><br><span class="line"><span class="comment">//    正文</span></span><br><span class="line">    <span class="keyword">private</span> String context = <span class="string">&quot;&lt;a href=&#x27;https://www.bilibili.com/video/BV11E411C7N9?spm_id_from=333.337.search-card.all.click&amp;vd_source=19d2b6b549b6d961b6aabb1b1e1ed551&amp;t=0.9&#x27;&gt;点开有惊喜&lt;/a&gt;&quot;</span>;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        MimeMessage message = javaMailSender.createMimeMessage();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            MimeMessageHelper helper = <span class="keyword">new</span> MimeMessageHelper(message, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">            helper.setFrom(from + <span class="string">&quot;(大甜甜)&quot;</span>);</span><br><span class="line">            helper.setTo(to);</span><br><span class="line">            helper.setSubject(subject);</span><br><span class="line">            helper.setText(context, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//            添加附件</span></span><br><span class="line">            File f1 = <span class="keyword">new</span> File(<span class="string">&quot;D:\\springboot\\demo\\springboot_23_mail\\target\\springboot_23_mail-0.0.1-SNAPSHOT.jar&quot;</span>);</span><br><span class="line">            File f2 = <span class="keyword">new</span> File(<span class="string">&quot;D:\\springboot\\demo\\springboot_23_mail\\src\\main\\resources\\66807h669p0.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">            helper.addAttachment(f1.getName(), f1);</span><br><span class="line">            helper.addAttachment(<span class="string">&quot;好康的.png&quot;</span>, f2);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        javaMailSender.send(message);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="消息"><a href="#消息" class="headerlink" title="消息"></a>消息</h3><ul>
<li>消息发送方<ul>
<li>生产者</li>
</ul>
</li>
<li>消息接收方<ul>
<li>消费者</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>同步消息</li>
<li>异步消息</li>
</ul>
<hr>
<ul>
<li>企业级应用中广泛使用的三种异步消息传递技术<ul>
<li>JMS</li>
<li>AMQP</li>
<li>MQTT</li>
</ul>
</li>
</ul>
<h4 id="JMS"><a href="#JMS" class="headerlink" title="JMS"></a>JMS</h4><ul>
<li>JMS（Java Message Service）：一个规范，等同于 JDBC 规范，提供了与消息服务相关的 API 接口</li>
<li>JMS 消息模型<ul>
<li>peer-2-peer：点对点模型，消息发送到一个队列中，队列保存消息。队列的消息只能被一个消费者消费，或超时</li>
<li>publish-subscribe：发布订阅模型，消息可以被多个消费者消费，生产者和消费者完全独立，不需要感知对方的存在</li>
</ul>
</li>
<li>JMS 消息种类<ul>
<li>TextMessage</li>
<li>MapMessage</li>
<li>BytesMessage</li>
<li>StreamMessage</li>
<li>ObjectMessage</li>
<li>Message（只有消息头和属性）</li>
</ul>
</li>
<li>JMS 实现：ActiveMQ、Reids、HornetMQ、RabbitMQ、RocketMQ（没有完全遵守 JMS 规范）</li>
</ul>
<h4 id="AMQP"><a href="#AMQP" class="headerlink" title="AMQP"></a>AMQP</h4><ul>
<li>AMQP（advanced message queuing protocol）：一种协议（高级消息队列协议，也就是消息代理规范），规范了网络交换的数据格式，兼容 JMS</li>
<li>优点：具有跨平台性，服务器供应商，生产者，消费者可以使用不同的语言来实现</li>
<li>AMQP 消息模型<ul>
<li>direct exchange</li>
<li>fanout exchange</li>
<li>topic exchange</li>
<li>headers exchange</li>
<li>system exchange</li>
</ul>
</li>
<li>AMQP 消息种类：byte[]</li>
<li>AMQP 实现：RabbitMQ、StormMQ、RocketMQ</li>
</ul>
<h4 id="MQTT"><a href="#MQTT" class="headerlink" title="MQTT"></a>MQTT</h4><ul>
<li>MQTT（Message Queueing Telemetry Transoprt）消息队列遥测传输，专为小设备设计，是物联网（IOT）生态系统中主要成分之一</li>
</ul>
<h4 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h4><ul>
<li>Kafka，一种高吞吐量的分布式发布订阅消息系统，提供实时消息功能</li>
</ul>
<h4 id="ActiveMQ"><a href="#ActiveMQ" class="headerlink" title="ActiveMQ"></a>ActiveMQ</h4><ul>
<li>下载地址：<a target="_blank" rel="noopener" href="https://activemq.apache.org/components/classic/download/">https://activemq.apache.org/components/classic/download/</a></li>
<li>启动服务：activemq.bat</li>
<li>访问服务器：<a target="_blank" rel="noopener" href="http://127.0.0.1:8161/">http://127.0.0.1:8161</a><ul>
<li>服务端口：61616，管理后台端口：8161</li>
<li>用户名&amp;密码：admin</li>
</ul>
</li>
</ul>
<h5 id="Spring-Boot-整合-ActiveMQ"><a href="#Spring-Boot-整合-ActiveMQ" class="headerlink" title="Spring Boot 整合 ActiveMQ"></a>Spring Boot 整合 ActiveMQ</h5><ul>
<li>导入 SpringBoot 整合 ActiveMQ 坐标</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-activemq<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>配置 ActiveMQ（采用默认配置）</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">activemq:</span></span><br><span class="line">    <span class="attr">broker-url:</span> <span class="string">tcp://localhost:61616</span></span><br><span class="line">  <span class="attr">jms:</span></span><br><span class="line">    <span class="attr">template:</span></span><br><span class="line">      <span class="attr">default-destination:</span> <span class="string">itheima</span></span><br><span class="line">    <span class="attr">pub-sub-domain:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<ul>
<li>生产与消费消息（使用默认消息存储队列）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageServiceActivemqImpl</span> <span class="keyword">implements</span> <span class="title">MessageService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JmsMessagingTemplate messagingTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;待发送短信的订单已纳入处理队列，id：&quot;</span> + id);</span><br><span class="line">        messagingTemplate.convertAndSend(<span class="string">&quot;order.queue.id&quot;</span>,id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">doMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String id = messagingTemplate.receiveAndConvert(<span class="string">&quot;order.queue.id&quot;</span>, String.class);</span><br><span class="line">        System.out.println(<span class="string">&quot;已完成短信发送业务，id：&quot;</span> + id);</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用消息监听器对消息队列监听</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JmsListener(destination = &quot;order.queue.id&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">receive</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;已完成短信发送业务，id：&quot;</span> + id);</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>流程性业务消息消费完转入下一个消息队列</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JmsListener(destination = &quot;order.queue.id&quot;)</span></span><br><span class="line">    <span class="meta">@SendTo(&quot;order.other.queue.id&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">receive</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;已完成短信发送业务，id：&quot;</span> + id);</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="RabbitMQ"><a href="#RabbitMQ" class="headerlink" title="RabbitMQ"></a>RabbitMQ</h4><ul>
<li>RabbitMQ 基于 Erlang 语言编写，需要安装 Erlang</li>
<li>Erlang<ul>
<li>下载地址：<a target="_blank" rel="noopener" href="https://www.erlang.org/downloads">https://www.erlang.org/downloads</a></li>
<li>安装：一键傻瓜式安装，安装完毕需重启，需要依赖 Windows 组件</li>
<li>环境变量配置<ul>
<li>ERLANG_HOME</li>
<li>PATH</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="RabbitMQ-下载"><a href="#RabbitMQ-下载" class="headerlink" title="RabbitMQ 下载"></a>RabbitMQ 下载</h5><ul>
<li>下载地址：<a target="_blank" rel="noopener" href="https://rabbitmq.com/install-windows.html">https://rabbitmq.com/install-windows.html</a></li>
</ul>
<h5 id="SpringBoot-整合-RabbitMQ"><a href="#SpringBoot-整合-RabbitMQ" class="headerlink" title="SpringBoot 整合 RabbitMQ"></a>SpringBoot 整合 RabbitMQ</h5><ul>
<li>导坐标</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--        rabbitmq--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>配置 application.yml</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">rabbitmq:</span></span><br><span class="line">    <span class="attr">host:</span> <span class="string">localhost</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">5672</span></span><br></pre></td></tr></table></figure>

<ul>
<li>定义消息队列（direct）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RabbitConfigDirect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">directQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// durable：是否持久化，默认 false</span></span><br><span class="line">        <span class="comment">// exclusive：是否当前连接专用，默认 false，连接关闭后队列即被删除</span></span><br><span class="line">        <span class="comment">// autoDelete：是否自动删除，当生产者或消费者不再使用此队列，自动删除</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;direct_queue&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DirectExchange <span class="title">directExchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DirectExchange(<span class="string">&quot;directExchange&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">bindingDirect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(directQueue()).to(directExchange()).with(<span class="string">&quot;direct&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>生产消息与消费消息（direct）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageServiceRabbitmqDirectImpl</span> <span class="keyword">implements</span> <span class="title">MessageService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AmqpTemplate amqpTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;待发送短信的订单已纳入处理队列（rabbitmq direct），id：&quot;</span> + id);</span><br><span class="line">        amqpTemplate.convertAndSend(<span class="string">&quot;directExchange&quot;</span>,<span class="string">&quot;direct&quot;</span>,id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用消息监听器对消息队列监听（direct）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;direct_queue&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;已完成短信发送业务（rabbitmq direct），id：&quot;</span> + id);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用多消息监听器对消息队列监听进行消息轮循处理（direct）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageListener2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;direct_queue&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;已完成短信发送业务（rabbitmq direct two），id：&quot;</span> + id);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>定义消息队列（topic）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.service.impl.rabbitmq.topic.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.core.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RabbitConfigTopic</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">topicQueue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;topic_queue&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TopicExchange <span class="title">topicExchange</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TopicExchange(<span class="string">&quot;topicExchange&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">bindingTopic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(topicQueue()).to(topicExchange()).with(<span class="string">&quot;topic.order.id&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Queue <span class="title">topicQueue2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Queue(<span class="string">&quot;topic_queue2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TopicExchange <span class="title">topicExchange2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> TopicExchange(<span class="string">&quot;topicExchange&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Binding <span class="title">bindingTopic2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> BindingBuilder.bind(topicQueue()).to(topicExchange()).with(<span class="string">&quot;topic.*.#&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>绑定键匹配规则<ul>
<li>*（星号）：用来表示一个单词，且该单词是必须出现的</li>
<li>#（井号）：用来表示任意数量，例如（topic.order.id 可以通过 topic.#）</li>
</ul>
</li>
<li>生产与消费消息（topic）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MessageServiceRabbitmqDirectImpl</span> <span class="keyword">implements</span> <span class="title">MessageService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AmqpTemplate amqpTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;待发送短信的订单已纳入处理队列（rabbitmq topic），id：&quot;</span> + id);</span><br><span class="line">        amqpTemplate.convertAndSend(<span class="string">&quot;topicExchange&quot;</span>,<span class="string">&quot;topic.order.id&quot;</span>,id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">doMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="RocketMQ"><a href="#RocketMQ" class="headerlink" title="RocketMQ"></a>RocketMQ</h4><ul>
<li>下载地址：<a target="_blank" rel="noopener" href="https://rocketmq.apache.org/">https://rocketmq.apache.org/</a></li>
<li>安装：解压缩<ul>
<li>默认服务端口：9876</li>
</ul>
</li>
<li>环境变量配置<ul>
<li>ROCKETMQ_HOME</li>
<li>PATH</li>
<li>NAME_ADDR（建议）：127.0.0.1:9876</li>
</ul>
</li>
<li>命名服务器与 broker<ul>
<li>启动命名服务器：mqnamesrv</li>
<li>启动 broker：mqbroker</li>
</ul>
</li>
<li>服务器功能测试：生产者</li>
</ul>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tools org.apache.rocketmq.example.quickstart.Producer</span><br></pre></td></tr></table></figure>

<ul>
<li>服务器功能测试：消费者</li>
</ul>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tools org.apache.rocketmq.example.quickstart.Consumer</span><br></pre></td></tr></table></figure>



<h2 id="监控"><a href="#监控" class="headerlink" title="监控"></a>监控</h2><h3 id="监控的意义"><a href="#监控的意义" class="headerlink" title="监控的意义"></a>监控的意义</h3><ul>
<li>监控服务状态是否宕机</li>
<li>监控服务运行指标（内存、虚拟机、线程、请求等）</li>
<li>监控日志</li>
<li>管理服务（服务下线）</li>
</ul>
<h3 id="监控的实施方式"><a href="#监控的实施方式" class="headerlink" title="监控的实施方式"></a>监控的实施方式</h3><ul>
<li>显示监控信息的服务器：用于获取服务信息，并显示对应的信息</li>
<li>运行时的服务：启动时主动上报，告知监控服务器子级需要</li>
<li>受到监控</li>
</ul>
<h3 id="可视化监控平台"><a href="#可视化监控平台" class="headerlink" title="可视化监控平台"></a>可视化监控平台</h3><ul>
<li>Spring Boot Admin，开源社区项目，用于管理和监控 SpringBoot 应用程序。客户端注册到服务端后，通过 HTTP 请求方式，服务端定期从客户端获取对应的信息，并通过 UI 界面展示对应信息。</li>
</ul>
<h4 id="具体步骤-2"><a href="#具体步骤-2" class="headerlink" title="具体步骤"></a>具体步骤</h4><ul>
<li>Admin 服务端<ul>
<li>坐标</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>de.codecentric<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-admin-starter-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li>配置</li>
</ul>
</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li>启动类</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableAdminServer</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Springboot25AdminServerApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(Springboot25AdminServerApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>Admin 客户端</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>de.codecentric<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-admin-starter-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><ul>
<li>配置</li>
</ul>
</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">boot:</span></span><br><span class="line">    <span class="attr">admin:</span></span><br><span class="line">      <span class="attr">client:</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">http://localhost:8080</span></span><br><span class="line"><span class="attr">management:</span></span><br><span class="line">  <span class="attr">endpoint:</span></span><br><span class="line">    <span class="attr">health:</span></span><br><span class="line">      <span class="attr">show-details:</span> <span class="string">always</span></span><br><span class="line">  <span class="attr">endpoints:</span></span><br><span class="line">    <span class="attr">web:</span></span><br><span class="line">      <span class="attr">exposure:</span></span><br><span class="line">        <span class="attr">include:</span> <span class="string">&quot;*&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>详情观看：<a target="_blank" rel="noopener" href="https://github.com/codecentric/spring-boot-admin">https://github.com/codecentric/spring-boot-admin</a></li>
</ul>
<h3 id="监控原理"><a href="#监控原理" class="headerlink" title="监控原理"></a>监控原理</h3><ul>
<li>actuator 提供了 SpringBoot 生产就绪功能，通过端点的配置与访问，获取端点信息</li>
<li>端点描述了一组监控信息，SpringBoot 提供了多个内置端点，也可以根据需要自定义端点信息</li>
<li>访问当前应用所有端点信息：/actuator</li>
<li>访问端点详情信息：/actuator/端点名称</li>
</ul>
<hr>
<ul>
<li>启用指定端点</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span> </span><br><span class="line">  <span class="attr">endpoint:</span> </span><br><span class="line">    <span class="attr">health:</span> <span class="comment"># 端点名称</span></span><br><span class="line">	  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">	  <span class="attr">show-details:</span> <span class="string">always</span></span><br><span class="line">	<span class="attr">beans:</span> <span class="comment"># 端点名称</span></span><br><span class="line">	  <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<ul>
<li>启用所有端点</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span> </span><br><span class="line">  <span class="attr">endpoints:</span> </span><br><span class="line">    <span class="attr">enabled-by-default:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<ul>
<li>暴露端点功能<ul>
<li>端点中包含的信息存在敏感信息，需要对外暴露端点功能时手动设定指定端点信息</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>属性</th>
<th>默认</th>
</tr>
</thead>
<tbody><tr>
<td>management.endpoints.jmx.exposure.exclude</td>
<td></td>
</tr>
<tr>
<td>management.endpoints.jmx.exposure.include</td>
<td>*</td>
</tr>
<tr>
<td>management.endpoints.web.exposure.exclude</td>
<td></td>
</tr>
<tr>
<td>management.endpoints.web.exposure.include</td>
<td>info,health</td>
</tr>
</tbody></table>
<h4 id="info-端点指标控制"><a href="#info-端点指标控制" class="headerlink" title="info 端点指标控制"></a>info 端点指标控制</h4><ul>
<li>为 info 端点添加自定义指标</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">info:</span></span><br><span class="line">  <span class="attr">appName:</span> <span class="string">@project.artifactId@</span></span><br><span class="line">  <span class="attr">author:</span> <span class="string">water_monster</span></span><br></pre></td></tr></table></figure>

<ul>
<li>通过编程的形式添加自定义指标</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">InfoConfig</span> <span class="keyword">implements</span> <span class="title">InfoContributor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contribute</span><span class="params">(Info.Builder builder)</span> </span>&#123;</span><br><span class="line">        builder.withDetail(<span class="string">&quot;runTime&quot;</span>,System.currentTimeMillis());</span><br><span class="line">        Map mapInfo = <span class="keyword">new</span> HashMap();</span><br><span class="line">        mapInfo.put(<span class="string">&quot;buildTime&quot;</span>,<span class="string">&quot;2022&quot;</span>);</span><br><span class="line">        builder.withDetails(mapInfo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>info不显示的加上这一段，原因可能是 springboot 版本过高</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">management:</span> </span><br><span class="line">  <span class="attr">info:</span></span><br><span class="line">    <span class="attr">env:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure>

<h4 id="health-端点指标控制"><a href="#health-端点指标控制" class="headerlink" title="health 端点指标控制"></a>health 端点指标控制</h4><ul>
<li>为 Health 端点添加自定义指标</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HealthConfig</span> <span class="keyword">extends</span> <span class="title">AbstractHealthIndicator</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doHealthCheck</span><span class="params">(Health.Builder builder)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        builder.withDetail(<span class="string">&quot;runTime&quot;</span>,System.currentTimeMillis());</span><br><span class="line">        Map mapInfo = <span class="keyword">new</span> HashMap();</span><br><span class="line">        mapInfo.put(<span class="string">&quot;buildTime&quot;</span>,<span class="string">&quot;2022&quot;</span>);</span><br><span class="line">        builder.withDetails(mapInfo);</span><br><span class="line">        builder.up(); <span class="comment">// builder.status(Status.UP)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Metrics-端点添加自定义指标"><a href="#Metrics-端点添加自定义指标" class="headerlink" title="Metrics 端点添加自定义指标"></a>Metrics 端点添加自定义指标</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">BookDao</span>, <span class="title">Book</span>&gt; <span class="keyword">implements</span> <span class="title">IBookService</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@AutoWired</span></span><br><span class="line">    <span class="keyword">private</span> BookDao bookDao;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Counter counter;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BookServiceImpl</span><span class="params">(MeterRegistry meterRegistry)</span> </span>&#123;</span><br><span class="line">        counter = meterRegistry.counter(<span class="string">&quot;用户付费操作次数：&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">delete</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        counter.increment();</span><br><span class="line">        <span class="keyword">return</span> bookDao.deleteById(id) &gt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="自定义端点"><a href="#自定义端点" class="headerlink" title="自定义端点"></a>自定义端点</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Endpoint(id = &quot;pay&quot;, enableByDefault = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PayEndpoint</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ReadOperation</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getPay</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Map payMap = <span class="keyword">new</span> HashMap();</span><br><span class="line">        payMap.put(<span class="string">&quot;level1&quot;</span>,<span class="string">&quot;300&quot;</span>);</span><br><span class="line">        payMap.put(<span class="string">&quot;level2&quot;</span>,<span class="string">&quot;400&quot;</span>);</span><br><span class="line">        payMap.put(<span class="string">&quot;level3&quot;</span>,<span class="string">&quot;500&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> payMap;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="原理篇"><a href="#原理篇" class="headerlink" title="原理篇"></a>原理篇</h1><h2 id="自动装配"><a href="#自动装配" class="headerlink" title="自动装配"></a>自动装配</h2><h3 id="bean-的加载方式"><a href="#bean-的加载方式" class="headerlink" title="bean 的加载方式"></a>bean 的加载方式</h3><ul>
<li>1.XML 方式声明 bean</li>
<li>2.注解 + XML 方式声明 bean<ul>
<li>&lt;context:component-scan base-package=”com.itheima.bean” /&gt; 扫描指定加载 bean 的包，类上记得加注解（@Component、@Service、@Controller、@Repository之类）</li>
<li>加载第三方 bean</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@Component</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DbConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DruidDataSource <span class="title">dataSource</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        DruidDataSource ds = <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">        <span class="keyword">return</span> ds;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>3.注解方式声明配置类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(&quot;com.itheima&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>4.使用 @Import 注解导入要注入的 bean 对应的字节码</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Import(Dog.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfig</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>被导入的 bean 无需声明为 bean<ul>
<li>此形式可以有效的降低源代码与 Spring 技术的耦合度，在 spring 技术底层及诸多框架的整合中大量使用</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span></span>&#123;&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>5.使用上下文对象在容器初始化完毕后注入 bean</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppImport</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        AnnotationConfigApplicationContext ctx = <span class="keyword">new</span> AnnotationConfigApplicationContext(SpringConfig.class);</span><br><span class="line">        ctx.register(Cat.class);</span><br><span class="line">        String[] names = ctx.getBeanDefinitionNames();</span><br><span class="line">        <span class="keyword">for</span>(String name : names) &#123;</span><br><span class="line">            System.out.println(name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>6.导入实现了 ImportSelector 接口的类，实现对导入源的编程式处理，再通过 @Import 导入该类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyImportSelector</span> <span class="keyword">implements</span> <span class="title">ImportSelector</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String[] selectImports(AnnotationMetadata metadata) &#123;</span><br><span class="line">        <span class="keyword">boolean</span> flag = metadata.hasAnnotation(<span class="string">&quot;org.springframework.context.annotation.Import&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span>(flag) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> String[]&#123;<span class="string">&quot;com.itheima.domain.Dog&quot;</span>&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> String[]&#123;<span class="string">&quot;com.itheima.domain.Cat&quot;</span>&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>7.导入实现了 ImportBeanDefinitionRegistrar 接口的类，通过 BeanDefinition 的注册器注册实名 bean，实现对容器中 bean 的裁定，例如对现有 bean 的覆盖，进而达成不修改源码的情况下实现更换实现的效果，同样通过 @Import 导入该类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyImportBeanDefinitionRegistrar</span> <span class="keyword">implements</span> <span class="title">ImportBeanDefinitionRegistrar</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">registerBeanDefinitions</span><span class="params">(AnnotationMetadata importingClassMetadata, BeanDefinitionRegistry registry)</span> </span>&#123;</span><br><span class="line">        BeanDefinition beanDefinition = BeanDefinitionBuilder.rootBeanDefinition(BookServiceImpl.class).getBeanDefinition();</span><br><span class="line">        registry.registerBeanDefinition(<span class="string">&quot;bookService&quot;</span>, beanDefinition);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>8.导入实现了 BeanDefinitionRegistryPostProcessor 接口的类，通过 BeanDefinition 的注册器注册实名 bean，实现对容器中 bean 的最终裁定，可以覆盖重复的 bean</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyPostProcessor</span> <span class="keyword">implements</span> <span class="title">BeanDefinitionRegistryPostProcessor</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postProcessBeanDefinitionRegistry</span><span class="params">(BeanDefinitionRegistry registry)</span> </span>&#123;</span><br><span class="line">        BeanDefinition beanDefinition = BeanDefinitionBuilder.rootBeanDefinition(BookServiceImpl.class).getBeanDefinition();</span><br><span class="line">        registry.registerBeanDefinition(<span class="string">&quot;bookService&quot;</span>, beanDefinition);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<ul>
<li>初始化实现 FactoryBean 接口的类，实现对 bean 加载到容器之前的批处理操作</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookFactoryBean</span> <span class="keyword">implements</span> <span class="title">FactoryBean</span>&lt;<span class="title">Book</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Book book = <span class="keyword">new</span> Book();</span><br><span class="line">        <span class="comment">// 进行 book 对象相关的初始化工作</span></span><br><span class="line">        <span class="keyword">return</span> book;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">		<span class="keyword">return</span> Book.class;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BookFactoryBean <span class="title">book</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BookFactoryBean();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>加载配置类并加载配置文件（系统迁移）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.itheima&quot;)</span></span><br><span class="line"><span class="meta">@ImportResource(&quot;applicationContext-config.xml&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfig</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用 proxyBeanMethods=true 可以保障调用此方法得到的对象是从容器中获取的而不是重新创建的</li>
</ul>
<h5 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h5><ul>
<li>1.xml + &lt;bean /&gt;</li>
<li>2.xml:context + 注解（@Component + 4 个 @Bean）</li>
<li>3.配置类 + 扫描 + 注解（@Component + 4 个 @Bean）<ul>
<li>@Bean 定义 FactoryBean 接口</li>
<li>@ImportResource</li>
<li>@Configuration 注解的 proxyBeanMethods 属性</li>
</ul>
</li>
<li>4.@Import 导入 bean 的类<ul>
<li>@Import 导入配置类</li>
</ul>
</li>
<li>5.AnnotationConfigApplicationContext 调用 register 方法</li>
<li>6.@Import 导入 ImportSelector 接口</li>
<li>7.@Import 导入 ImportBeanDefinitionRegistara 接口</li>
<li>8.@Import 导入 BeanDefinitionRegistryPostProcessor 接口</li>
</ul>
<h3 id="bean-的加载控制（编程式）"><a href="#bean-的加载控制（编程式）" class="headerlink" title="bean 的加载控制（编程式）"></a>bean 的加载控制（编程式）</h3><ul>
<li>bean 的加载控制指根据特定情况对 bean 进行选择性加载以达到适用于项目的目标</li>
</ul>
<hr>
<ul>
<li>根据任意条件确认是否加载 bean</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyImportSelector</span> <span class="keyword">implements</span> <span class="title">ImportSelector</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String[] selectImports(AnnotationMetadata importingClassMetadata) &#123;</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">            Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;com.itheima.bean.Mouse&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span>(clazz != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> String[]&#123;<span class="string">&quot;com.itheima.bean.Cat&quot;</span>&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> String[<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="bean-的加载控制（注解式）"><a href="#bean-的加载控制（注解式）" class="headerlink" title="bean 的加载控制（注解式）"></a>bean 的加载控制（注解式）</h3><ul>
<li>匹配指定类（@ConditionalOnClass）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnClass(Mouse.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Cat <span class="title">tom</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Cat();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>未匹配指定类（@ConditionalOnMissingClass）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingClass(Mouse.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Cat <span class="title">tom</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Cat();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>匹配指定名称的 bean （@ConditionalOnBean）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnBean(name = &quot;com.itheima.bean.Mouse&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Cat <span class="title">tom</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Cat();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>匹配指定类型的 bean</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnBean(Mouse.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Cat <span class="title">tom</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Cat();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>匹配指定环境</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnClass(Mouse.class)</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingClass(&quot;com.itheima.bean.wolf&quot;)</span></span><br><span class="line">    <span class="meta">@ConditionalOnNotWebApplication</span> <span class="comment">// 是否为 web 程序</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Cat <span class="title">tom</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Cat();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="bean-依赖的属性配置"><a href="#bean-依赖的属性配置" class="headerlink" title="bean 依赖的属性配置"></a>bean 依赖的属性配置</h3><ul>
<li>将业务功能 bean 运行需要的资源抽取成独立的属性类（***Properties，设置读取配置文件信息）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;cartoon&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CartoonProperties</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Cat cat;</span><br><span class="line">    <span class="keyword">private</span> Mouse mouse;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>配置文件中使用固定格式为属性类注入数据</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cartoon:</span> </span><br><span class="line">  <span class="attr">cat:</span> </span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;图多盖洛&quot;</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">5</span></span><br><span class="line">  <span class="attr">mouse:</span> </span><br><span class="line">    <span class="attr">name:</span> <span class="string">&quot;泰菲&quot;</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<ul>
<li>定义业务功能 bean，通常使用 @Import 导入，解耦强制加载 bean</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CartoonCatAndMouse</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Cat cat;</span><br><span class="line">    <span class="keyword">private</span> Mouse mouse;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(cat.getAge() + <span class="string">&quot;岁的&quot;</span> + cat.getName() + <span class="string">&quot;与&quot;</span> + mouse.getAge() + <span class="string">&quot;岁的&quot;</span> + mouse.getName() + <span class="string">&quot;打起来了&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用 @EnableConfigurationProperties 注解设定使用属性类时加载 bean</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(CartoonProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CartoonCatAndMouse</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> CartoonProperties cartoonProperties;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CartoonCatAndMouse</span><span class="params">(CartoonProperties cartoonProperties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cartoonProperties = cartoonProperties;</span><br><span class="line">        cat = <span class="keyword">new</span> cat();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自动装配原理"><a href="#自动装配原理" class="headerlink" title="自动装配原理"></a>自动装配原理</h3><h4 id="自动装配思想"><a href="#自动装配思想" class="headerlink" title="自动装配思想"></a>自动装配思想</h4><p>1.收集 Spring 开发者的编程习惯，整理开发过程使用的常用技术列表（<strong>技术集 A</strong>）</p>
<p>2.收集常用技术（技术集 A）的使用参数，整理开发过程中每个技术的常用设置列表（<strong>设置集 B</strong>）</p>
<p>3.初始化 SpringBoot 基础环境，加载用户自定义的 bean 和导入其他的坐标，形成<strong>初始化环境</strong></p>
<p>4.将<strong>技术集 A</strong>包含的技术都定义出来，在 Spring/SpringBoot 启动时默认全部加载</p>
<p>5.将<strong>技术集 A</strong>中具有使用条件的技术约束出来，设置成按条件加载，由开发者决定是否使用该技术（与初始化环境对比）</p>
<p>6.将<strong>设置集 B</strong>作为默认配置加载（约定大于配置），减少开发者配置工作量</p>
<p>7.开放<strong>设置集 B</strong>的配置覆盖接口，由开发者根据自身需要决定是否覆盖默认配置    </p>
<h4 id="变更自动配置"><a href="#变更自动配置" class="headerlink" title="变更自动配置"></a>变更自动配置</h4><ul>
<li>自定义自动配置（META-INF/spring.factories）</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Auto Configure</span></span><br><span class="line"><span class="string">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span></span><br><span class="line"><span class="string">com.itheima.bean.CartoonCatAndMouse</span></span><br></pre></td></tr></table></figure>

<ul>
<li>控制 SpringBoot 内置自动配置类加载</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span> </span><br><span class="line">  <span class="attr">autoconfigure:</span></span><br><span class="line">    <span class="attr">exclude:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="string">org.springframework.boot.autoconfigure.task.TaskExecutionAutoConfiguration</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">org.springframework.boot.autoconfigure.context.LifecycleAutoConfiguraion</span></span><br></pre></td></tr></table></figure>

<h2 id="自定义-starter"><a href="#自定义-starter" class="headerlink" title="自定义 starter"></a>自定义 starter</h2><h3 id="案例：记录系统访客独立-IP-访问次数"><a href="#案例：记录系统访客独立-IP-访问次数" class="headerlink" title="案例：记录系统访客独立 IP 访问次数"></a>案例：记录系统访客独立 IP 访问次数</h3><p>1.每次访问网站行为均进行统计</p>
<p>2.后台每 10 秒输出依次监控信息（格式：IP + 访问次数）</p>
<h4 id="需求分析"><a href="#需求分析" class="headerlink" title="需求分析"></a>需求分析</h4><ul>
<li><p>1.数据记录位置：Map/Redis</p>
</li>
<li><p>2.功能触发位置：每次 web 请求（拦截器）</p>
<ul>
<li>步骤一：降低难度，主动调用，仅统计单一操作访问次数（例如查询）</li>
<li>步骤二：开发拦截器</li>
</ul>
</li>
<li><p>3.业务参数（配置项）</p>
<ul>
<li>1.输出频率：默认 10 秒</li>
<li>2.数据特征：累计数据/阶段数据，默认累计数据</li>
<li>3.输出格式：详细模式/极简模式</li>
</ul>
</li>
</ul>
<h4 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h4><ul>
<li>导入坐标</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>业务功能开发</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IpCountService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Integer&gt; ipCountMap = <span class="keyword">new</span> HashMap&lt;String, Integer&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line"><span class="comment">//    当前的 request 对象的注入工作由使用当前 starter 的工程提供自动装配</span></span><br><span class="line">    <span class="keyword">private</span> HttpServletRequest httpServletRequest;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">count</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//        每次调用当前操作，就记录当前访问的 IP，然后累加访问次数</span></span><br><span class="line"><span class="comment">//        1.获取当前操作的 IP 地址</span></span><br><span class="line">        String ip = httpServletRequest.getRemoteAddr();</span><br><span class="line">        System.out.println(<span class="string">&quot;------------------&quot;</span> + ip);</span><br><span class="line"><span class="comment">//        2.根据 IP 地址从 Map 取值，并递增</span></span><br><span class="line">        Integer count = ipCountMap.get(ip);</span><br><span class="line">        <span class="keyword">if</span>(count == <span class="keyword">null</span>) &#123;</span><br><span class="line">            ipCountMap.put(ip, <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ipCountMap.put(ip, ipCountMap.get(ip) + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>自动配置类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.autoconfig;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.itcast.service.IpCountService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IpAutoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IpCountService <span class="title">ipCountService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> IpCountService();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>配置，在 resource 文件夹下创建一个 META-INF 文件夹，在里面创建 spring.factories 文件，其他模块调用 stater 之后会自动加载这个文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># Auto configure</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration&#x3D;\</span><br><span class="line">  cn.itcast.autoconfig.IpAutoConfiguration</span><br></pre></td></tr></table></figure>

<ul>
<li>模拟调用（非最终版本）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.controller;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.itcast.service.IpCountService;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.core.metadata.IPage;</span><br><span class="line"><span class="keyword">import</span> com.itheima.controller.utils.R;</span><br><span class="line"><span class="keyword">import</span> com.itheima.domain.Book;</span><br><span class="line"><span class="keyword">import</span> com.itheima.service.IBookService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/books&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IBookService bookService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IpCountService ipCountService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;&#123;currentPage&#125;/&#123;pageSize&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">getPage</span><span class="params">(<span class="meta">@PathVariable</span> <span class="keyword">int</span> currentPage,<span class="meta">@PathVariable</span> <span class="keyword">int</span> pageSize, Book book)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        ipCountService.count();</span><br><span class="line"></span><br><span class="line">        IPage&lt;Book&gt; page = bookService.getPage(currentPage, pageSize, book);</span><br><span class="line"><span class="comment">//        如果当前页码值大于总页码值，那么重新执行查询操作，使用最大页码值作为当前页码值</span></span><br><span class="line">        <span class="keyword">if</span>(currentPage &gt; page.getPages()) &#123;</span><br><span class="line">            page = bookService.getPage((<span class="keyword">int</span>)page.getPages(), pageSize, book);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> R(<span class="keyword">true</span>, page);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="开启定时任务"><a href="#开启定时任务" class="headerlink" title="开启定时任务"></a>开启定时任务</h5><ul>
<li>开启定时任务功能</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IpAutoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IpCountService <span class="title">ipCountService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> IpCountService();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>设置定时任务</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IpCountService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Integer&gt; ipCountMap = <span class="keyword">new</span> HashMap&lt;String, Integer&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line"><span class="comment">//    当前的 request 对象的注入工作由使用当前 starter 的工程提供自动装配</span></span><br><span class="line">    <span class="keyword">private</span> HttpServletRequest httpServletRequest;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">count</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//        每次调用当前操作，就记录当前访问的 IP，然后累加访问次数</span></span><br><span class="line"><span class="comment">//        1.获取当前操作的 IP 地址</span></span><br><span class="line">        String ip = httpServletRequest.getRemoteAddr();</span><br><span class="line">        System.out.println(<span class="string">&quot;------------------&quot;</span> + ip);</span><br><span class="line"><span class="comment">//        2.根据 IP 地址从 Map 取值，并递增</span></span><br><span class="line">        Integer count = ipCountMap.get(ip);</span><br><span class="line">        <span class="keyword">if</span>(count == <span class="keyword">null</span>) &#123;</span><br><span class="line">            ipCountMap.put(ip, <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ipCountMap.put(ip, ipCountMap.get(ip) + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0/5 * * * * ?&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;        IP 访问监控&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;+-----ip-address-----+--num--+&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Integer&gt; entry : ipCountMap.entrySet()) &#123;</span><br><span class="line">            String key = entry.getKey();</span><br><span class="line">            Integer value = entry.getValue();</span><br><span class="line">            System.out.println(String.format(<span class="string">&quot;|%18s  |%5d  |&quot;</span>, key, value));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;+--------------------+-------+&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="设置自定义属性"><a href="#设置自定义属性" class="headerlink" title="设置自定义属性"></a>设置自定义属性</h5><ul>
<li>自定义属性类，加载对应属性</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;tools.ip&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IpProperties</span> </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 日志显示周期</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long cycle = <span class="number">5L</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 是否周期内重置数据</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> cycleReset = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * 日志输出模式    detail：详细模式     simple：极简模式</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String model = LogModel.DETAIL.value;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">LogModel</span> </span>&#123;</span><br><span class="line">        DETAIL(<span class="string">&quot;detail&quot;</span>),</span><br><span class="line">        SIMPLE(<span class="string">&quot;simple&quot;</span>);</span><br><span class="line">        <span class="keyword">private</span> String value;</span><br><span class="line">        LogModel(String value) &#123;</span><br><span class="line">            <span class="keyword">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getValue</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getCycle</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cycle;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCycle</span><span class="params">(Long cycle)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cycle = cycle;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">getCycleReset</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cycleReset;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setCycleReset</span><span class="params">(<span class="keyword">boolean</span> cycleReset)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.cycleReset = cycleReset;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getModel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> model;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setModel</span><span class="params">(String model)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.model = model;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>设置加载 Properties 类为 bean</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(IpProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IpAutoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IpCountService <span class="title">ipCountService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> IpCountService();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>根据配置切换设置</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cn.itcast.properties.IpProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Scheduled;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IpCountService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Integer&gt; ipCountMap = <span class="keyword">new</span> HashMap&lt;String, Integer&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line"><span class="comment">//    当前的 request 对象的注入工作由使用当前 starter 的工程提供自动装配</span></span><br><span class="line">    <span class="keyword">private</span> HttpServletRequest httpServletRequest;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IpProperties ipProperties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled(cron = &quot;0/5 * * * * ?&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(ipProperties.getModel().equals(IpProperties.LogModel.DETAIL.getValue())) &#123;</span><br><span class="line">            <span class="comment">//  明细模式</span></span><br><span class="line">            System.out.println(<span class="string">&quot;        IP 访问监控&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;+-----ip-address-----+--num--+&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (Map.Entry&lt;String, Integer&gt; entry : ipCountMap.entrySet()) &#123;</span><br><span class="line">                String key = entry.getKey();</span><br><span class="line">                Integer value = entry.getValue();</span><br><span class="line">                System.out.println(String.format(<span class="string">&quot;|%18s  |%5d  |&quot;</span>, key, value));</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;+--------------------+-------+&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(ipProperties.getModel().equals(IpProperties.LogModel.SIMPLE.getValue())) &#123;</span><br><span class="line">            <span class="comment">//  极简模式</span></span><br><span class="line">            System.out.println(<span class="string">&quot;    IP 访问监控&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;+-----ip-address-----+&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (String key : ipCountMap.keySet()) &#123;</span><br><span class="line">                System.out.println(String.format(<span class="string">&quot;|%18s  |&quot;</span>, key));</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;+--------------------+&quot;</span>);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(ipProperties.getCycleReset()) &#123;</span><br><span class="line">            ipCountMap.clear();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>配置信息</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tools:</span></span><br><span class="line">  <span class="attr">ip:</span></span><br><span class="line">    <span class="attr">cycle:</span> <span class="number">10</span></span><br><span class="line">    <span class="attr">cycle-reset:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">model:</span> <span class="string">&quot;detail&quot;</span></span><br></pre></td></tr></table></figure>

<h5 id="设置自定义属性（补充）"><a href="#设置自定义属性（补充）" class="headerlink" title="设置自定义属性（补充）"></a>设置自定义属性（补充）</h5><ul>
<li>自定义 bean 名称</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component(&quot;ipProperties&quot;)</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;tools.ip&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IpProperties</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>放弃配置属性创建 bean 方式，改为手工控制</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="comment">//@EnableConfigurationProperties(IpProperties.class)</span></span><br><span class="line"><span class="meta">@Import(IpProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IpAutoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IpCountService <span class="title">ipCountService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> IpCountService();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用 #{beanName.attrName} 读取 bean 的属性</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Scheduled(cron = &quot;0/#&#123;ipProperties.cycle&#125; * * * * ?&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="自定义拦截器"><a href="#自定义拦截器" class="headerlink" title="自定义拦截器"></a>自定义拦截器</h5><ul>
<li>自定义拦截器</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">IpCountInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> IpCountService ipCountService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ipCountService.count();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>设置核心配置类，加载拦截器</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringMvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addInterceptors</span><span class="params">(InterceptorRegistry registry)</span> </span>&#123;</span><br><span class="line">        registry.addInterceptor(ipCountInterceptor()).addPathPatterns(<span class="string">&quot;/**&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IpCountInterceptor <span class="title">ipCountInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> IpCountInterceptor();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="辅助功能开发"><a href="#辅助功能开发" class="headerlink" title="辅助功能开发"></a>辅助功能开发</h5><ul>
<li>导入配置处理器坐标</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>进行自定义提示功能开发（在 META-INF 中添加一个 spring-configuration-metadata.json 文件）</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 提示功能</span></span><br><span class="line">  <span class="attr">&quot;hints&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;tools.ip.model&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;values&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;value&quot;</span>: <span class="string">&quot;detail&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;详细模式.&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;value&quot;</span>: <span class="string">&quot;simple&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;简洁模式.&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h5 id="小结-2"><a href="#小结-2" class="headerlink" title="小结"></a>小结</h5><ul>
<li>1.使用自动配置加载业务功能</li>
<li>2.切记使用之前先 clean 后 install 安装到 maven 仓库，确保资源更新</li>
</ul>
<h2 id="核心原理"><a href="#核心原理" class="headerlink" title="核心原理"></a>核心原理</h2><h3 id="SpringBoot-启动流程"><a href="#SpringBoot-启动流程" class="headerlink" title="SpringBoot 启动流程"></a>SpringBoot 启动流程</h3><ul>
<li>1.初始化各种属性，加载成对象<ul>
<li>读取环境属性（Environment）</li>
<li>系统配置（spring.factories）</li>
<li>参数（Arguments、application.properties）</li>
</ul>
</li>
<li>2.创建 Spring 容器对象 ApplicationContext，加载各种配置</li>
<li>3.在容器创建前，通过监听器机制，应对不同阶段加载数据、更新数据的需求</li>
<li>4.容器初始化过程中追加各种功能，例如统计时间、输出日志等</li>
</ul>
<h4 id="监听器类型"><a href="#监听器类型" class="headerlink" title="监听器类型"></a>监听器类型</h4><ul>
<li>1.在应用运行但未进行任何处理时，将发送 ApplicationStartingEvent</li>
<li>2.当 Environment 被使用，且上下文创建之前，将发送 ApplicationEnvironmentPreparedEvent</li>
<li>3.在开始刷新之前，bean 定义被加载之后发送 ApplicationPreparedEvent;</li>
<li>4.在上下文刷新之后且所有的应用和命令运行器被调用之前发送 ApplicationStartedEvent</li>
<li>5.在应用程序和命令行运行器被调用之后，将发出 ApplicationReadyEvent，用于通知应用已经准备处理请求</li>
<li>6.启动时发生异常，将发送 ApplicationFailedEvent</li>
</ul>

                
            </div>
            <hr/>

            

    <div class="reprint" id="reprint-statement">
        
            <div class="reprint__author">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-user">
                        文章作者:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="/about" rel="external nofollow noreferrer">Water monster</a>
                </span>
            </div>
            <div class="reprint__type">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-link">
                        文章链接:
                    </i>
                </span>
                <span class="reprint-info">
                    <a href="https://manongtaoye.github.io/2022/05/03/spring-boot/">https://manongtaoye.github.io/2022/05/03/spring-boot/</a>
                </span>
            </div>
            <div class="reprint__notice">
                <span class="reprint-meta" style="font-weight: bold;">
                    <i class="fas fa-copyright">
                        版权声明:
                    </i>
                </span>
                <span class="reprint-info">
                    本博客所有文章除特別声明外，均采用
                    <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a>
                    许可协议。转载请注明来源
                    <a href="/about" target="_blank">Water monster</a>
                    !
                </span>
            </div>
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>



            <div class="tag_share" style="display: block;">
                <div class="post-meta__tag-list" style="display: inline-block;">
                    
                        <div class="article-tag">
                            
                                <a href="/tags/note/">
                                    <span class="chip bg-color">note</span>
                                </a>
                            
                        </div>
                    
                </div>
                <div class="post_share" style="zoom: 80%; width: fit-content; display: inline-block; float: right; margin: -0.15rem 0;">
                    <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">
<div id="article-share">

    
    <div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div>
    <script src="/libs/share/js/social-share.min.js"></script>
    

    

</div>

                </div>
            </div>
            
                <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.4rem;
        line-height: 38px;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fas fa-times"></i></a>
            <h4 class="reward-title">你的赏识是我前进的动力</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>

            
        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments textarea {
        box-sizing: border-box;
        background: url("/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #4cbf30;
        font-weight: 500;
        text-decoration: none;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div class="comment_headling" style="font-size: 20px; font-weight: 700; position: relative; padding-left: 20px; top: 15px; padding-bottom: 5px;">
        <i class="fas fa-comments fa-fw" aria-hidden="true"></i>
        <span>评论</span>
    </div>
    <div id="vcomments" class="card-content" style="display: grid">
    </div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<script>
    new Valine({
        el: '#vcomments',
        appId: 'vdbExxBqH65oAeGcqAM3nHBC-gzGzoHsz',
        appKey: 'A7qpmJgGSTmQjMgR6sKlDHE3',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'true' === 'true',
        avatar: 'mm',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: 'just go go'
    });
</script>

<!--酷Q推送-->


    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fas fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2022/05/03/Mybatis-plus/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/12.jpg" class="responsive-img" alt="Mybatis-plus">
                        
                        <span class="card-title">Mybatis-plus</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="far fa-clock fa-fw icon-date"></i>2022-05-03
                        </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            Water monster
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/note/">
                        <span class="chip bg-color">note</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fas fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2022/04/13/ssm%E9%9B%86%E6%88%90/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/15.jpg" class="responsive-img" alt="ssm集成">
                        
                        <span class="card-title">ssm集成</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="far fa-clock fa-fw icon-date"></i>2022-04-13
                            </span>
                        <span class="publish-author">
                            
                            <i class="fas fa-user fa-fw"></i>
                            Water monster
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/note/">
                        <span class="chip bg-color">note</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>

</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('10')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 水兽的Blog<br />'
            + '文章作者: Water monster<br />'
            + '文章链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>


<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget card" style="background-color: white;">
            <div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fas fa-list-ul"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>

    

</main>




    <footer class="page-footer bg-color">
    
        <link rel="stylesheet" href="/libs/aplayer/APlayer.min.css">
<style>
    .aplayer .aplayer-lrc p {
        
        display: none;
        
        font-size: 12px;
        font-weight: 700;
        line-height: 16px !important;
    }

    .aplayer .aplayer-lrc p.aplayer-lrc-current {
        
        display: none;
        
        font-size: 15px;
        color: #42b983;
    }

    
    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body {
        left: -66px !important;
    }

    .aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover {
        left: 0px !important;
    }

    
</style>
<div class="">
    
    <div class="row">
        <meting-js class="col l8 offset-l2 m10 offset-m1 s12"
                   server="netease"
                   type="playlist"
                   id="503838841"
                   fixed='true'
                   autoplay='true'
                   theme='#42b983'
                   loop='all'
                   order='random'
                   preload='auto'
                   volume='0.7'
                   list-folded='true'
        >
        </meting-js>
    </div>
</div>

<script src="/libs/aplayer/APlayer.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script>

    
    <div class="container row center-align" style="margin-bottom: 0px !important;">
        <div class="col s12 m8 l8 copy-right">
            Copyright&nbsp;&copy;
            
                <span id="year">2021-2022</span>
            
            <span id="year">2021</span>
            <a href="/about" target="_blank">Water monster</a>
            |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a>
            |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a>
            <br>
            
            &nbsp;<i class="fas fa-chart-area"></i>&nbsp;站点总字数:&nbsp;<span
                class="white-color">89.2k</span>&nbsp;字
            
            
            
            
            
            
            <span id="busuanzi_container_site_pv">
                |&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv"
                    class="white-color"></span>&nbsp;次
            </span>
            
            
            <span id="busuanzi_container_site_uv">
                |&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv"
                    class="white-color"></span>&nbsp;人
            </span>
            
            <br>
            
            <br>
            
        </div>
        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/manongtaoye" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fab fa-github"></i>
    </a>



    <a href="mailto:1513591616@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fas fa-envelope-open"></i>
    </a>







    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1513591616" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1513591616" data-position="top" data-delay="50">
        <i class="fab fa-qq"></i>
    </a>







</div>
    </div>
</footer>

<div class="progress-bar"></div>


    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fas fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script type="text/javascript">
$(function () {
    var searchFunc = function (path, search_id, content_id) {
        'use strict';
        $.ajax({
            url: path,
            dataType: "xml",
            success: function (xmlResponse) {
                // get the contents from search data
                var datas = $("entry", xmlResponse).map(function () {
                    return {
                        title: $("title", this).text(),
                        content: $("content", this).text(),
                        url: $("url", this).text()
                    };
                }).get();
                var $input = document.getElementById(search_id);
                var $resultContent = document.getElementById(content_id);
                $input.addEventListener('input', function () {
                    var str = '<ul class=\"search-result-list\">';
                    var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                    $resultContent.innerHTML = "";
                    if (this.value.trim().length <= 0) {
                        return;
                    }
                    // perform local searching
                    datas.forEach(function (data) {
                        var isMatch = true;
                        var data_title = data.title.trim().toLowerCase();
                        var data_content = data.content.trim().replace(/<[^>]+>/g, "").toLowerCase();
                        var data_url = data.url;
                        data_url = data_url.indexOf('/') === 0 ? data.url : '/' + data_url;
                        var index_title = -1;
                        var index_content = -1;
                        var first_occur = -1;
                        // only match artiles with not empty titles and contents
                        if (data_title !== '' && data_content !== '') {
                            keywords.forEach(function (keyword, i) {
                                index_title = data_title.indexOf(keyword);
                                index_content = data_content.indexOf(keyword);
                                if (index_title < 0 && index_content < 0) {
                                    isMatch = false;
                                } else {
                                    if (index_content < 0) {
                                        index_content = 0;
                                    }
                                    if (i === 0) {
                                        first_occur = index_content;
                                    }
                                }
                            });
                        }
                        // show search results
                        if (isMatch) {
                            str += "<li><a href='" + data_url + "' class='search-result-title'>" + data_title + "</a>";
                            var content = data.content.trim().replace(/<[^>]+>/g, "");
                            if (first_occur >= 0) {
                                // cut out 100 characters
                                var start = first_occur - 20;
                                var end = first_occur + 80;
                                if (start < 0) {
                                    start = 0;
                                }
                                if (start === 0) {
                                    end = 100;
                                }
                                if (end > content.length) {
                                    end = content.length;
                                }
                                var match_content = content.substr(start, end);
                                // highlight all keywords
                                keywords.forEach(function (keyword) {
                                    var regS = new RegExp(keyword, "gi");
                                    match_content = match_content.replace(regS, "<em class=\"search-keyword\">" + keyword + "</em>");
                                });

                                str += "<p class=\"search-result\">" + match_content + "...</p>"
                            }
                            str += "</li>";
                        }
                    });
                    str += "</ul>";
                    $resultContent.innerHTML = str;
                });
            }
        });
    };

    searchFunc('/search.xml', 'searchInput', 'searchResult');
});
</script>

    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fas fa-arrow-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <!-- Baidu Analytics -->

    <!-- Baidu Push -->

<script>
    (function () {
        var bp = document.createElement('script');
        var curProtocol = window.location.protocol.split(':')[0];
        if (curProtocol === 'https') {
            bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
        } else {
            bp.src = 'http://push.zhanzhang.baidu.com/push.js';
        }
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(bp, s);
    })();
</script>

    
    <script src="/libs/others/clicklove.js" async="async"></script>
    
    
    <script async src="/libs/others/busuanzi.pure.mini.js"></script>
    

    

    

    <!--腾讯兔小巢-->
    
    
    <script type="text/javascript" color="0,0,255"
        pointColor="0,0,255" opacity='0.7'
        zIndex="-1" count="99"
        src="/libs/background/canvas-nest.js"></script>
    

    
    
    <script type="text/javascript" size="150" alpha='0.6'
        zIndex="-1" src="/libs/background/ribbon-refresh.min.js" async="async"></script>
    

    
    <script type="text/javascript" src="/libs/background/ribbon-dynamic.js" async="async"></script>
    

    
    <script src="/libs/instantpage/instantpage.js" type="module"></script>
    

</body>

</html>
